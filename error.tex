\chapter{Verfeinerung und Error-Freiheit}

\section{Präkongruenz für Error}

Da es in dieser Arbeit vor allem um die Erreichbarkeit und die Kommunikation
zwischen \EIO{}s geht, wurden die nächsten beiden Definitionen explizit
getrennt und erweitert im Vergleich zu denen in~\cite{Vogler2014EIO}. Ebenfalls
wurde die Parallelkomposition geändert, wie in~\cite{Schlosser2012BA}.

\begin{Def}[error-freie Kommunikation]
  Ein Error ist \emph{lokal erreichbar} in einem \EIO{} $S$, wenn $\exists w\in O^*: q_0
  \overset{w}{\Rightarrow} q\in E$.\\
  Zwei \EIO{}s $S_1$ und $S_2$ \emph{kommunizieren error-frei}, wenn in ihrer
  Parallelkomposition $S_1\| S_2$ keine Errors lokal erreicht werden können.
\end{Def}

Mittels der lokalen Erreichbarkeit von Errors kann ein
Verfeinerungsrelation definiert werden. Zusätzlich wird bereits die
gröbste Präkongruenz definiert, die gesucht werden soll.

\begin{Def}[Error-Verfeinerungs-Basisrelation]
  \label{DefErrorBasisrel}
  Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird
  $S_1\EBRel S_2$ geschrieben, wenn ein Error in $S_1$ nur dann lokal erreichbar ist, wenn er
  auch in $S_2$ lokal erreichbar ist. Es handelt sich dabei um eine
  \emph{Basisrelation} für die \emph{Verfeinerung} im Bezug auf \emph{Errors}.\\
  \ECRel{} bezeichnet die \emph{vollständig abstrakte Präkongruenz} von \EBRel{}
  bezüglich $\cdot\|\cdot$, d.h.\ die gröbste Präkongruenz bezüglich
  $\cdot\|\cdot$, die in \EBRel{} enthalten ist.
\end{Def}

Um sich näher mit den Präkongruenzen auseinandersetzen zu können, müssen bestimmte Traces
aus der Struktur hervor gehoben werden. Die strikten Errortraces entsprechen Wegen, die
direkt vom Startzustand zu einem Zustand in der Menge $E$ führen. Da Outputs Aktionen
sind, die von außen nicht verhindert werden können, wird auch noch die
Menge der Traces benötigt, die zu einem Zustand führen können, von dem aus mit lokalen Aktionen
ein Error erreicht werden kann. Zusätzlich ist auch noch die Menge der Traces
interessant, für die es einen Input $a\in I$ gibt, durch den sie möglicherweise nicht
fortgesetzt werden können. Diese führen zwar nicht direkt zu einem Error,
jedoch in Komposition mit einem anderen Transitionssystem sind
dies gefährdete Stellen. Sie führen zu einem neuen Error, sobald dieser Input
für die Synchronisation fehlt.

\begin{Def}[Errortraces]
  \label{DefErrortraces}
  Für ein \EIO{} $S$ wird definiert:
  \begin{itemize}
    \item \emph{strikte Errortraces}: $\StET{}(S)=\{w\in\Sigma
      ^*\mid q_0\overset{w}{\Rightarrow}q\in E\}$,
    \item \emph{gekürzte Errortraces}: $\PrET{}(S)=\{\prune{}(w)\mid w\in \StET{}(S)\}$,
    \item \emph{Input-kritische Traces}: $\MIT{}(S)=\{wa\in\Sigma ^*\mid
      q_0\overset{w}{\Rightarrow}q\wedge a\in I\wedge
    q\overset{a}{\not{\hspace{-0.1cm}\rightarrow}}\}$.
  \end{itemize}
\end{Def}

In der folgenden Definition wird festgehalten, was als Errortraces auffasst
wird. Diese Menge ist dadurch, dass sie die fortgesetzten Traces aus $\PrET{}$
enthält, deutlich allgemeiner als die Menge $\StET{}$. Zusätzlich wird auch noch
die geflutete Sprache definiert, in der die Informationen aus der Sprache und den
Errortraces vereint werden und somit bei der Inklusion nicht mehr explizit
unterscheiden werden.

\begin{Def}[Error-Semantik]
  \label{DefETEL}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Errortraces} von $S$ ist $\ET{}(S):=\cont{}(\PrET{}(S))\cup
      \cont{}(\MIT{}(S))$.
    \item Die \emph{error-geflutete Sprache} von $S$ ist $\EL{}(S):=L(S)\cup \ET{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur wird
  $S_1\ERel S_2$ geschrieben, wenn $\ET{}(S_1)\subseteq \ET{}(S_2)$ und
  $\EL{}(S_1)\subseteq \EL{}(S_2)$ gilt.
\end{Def}

Der folgende Satz wurde in~\cite{Vogler2014EIO} nur für die Parallelkomposition
mit verborgenen synchronisierten Aktionen formuliert, jedoch entspricht er dem
analogen Satz aus~\cite{Schlosser2012BA}. Da der Beweis jedoch ohne Beachtung
von~\cite{Schlosser2012BA} neu geführt wurde, wird hier eher auf die
Erwähnung der Unterschiede zu~\cite{Vogler2014EIO} Wert gelegt.

\begin{satz}[Error-Semanik für Parallelkompositionen]
  \label{satzErrorSemanik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition
  $S_{12}=S_1\|S_2$, gilt:
  \begin{enumerate}
    \item $\ET{}_{12}=\cont{}(\prune{}((\ET{}_1\|\EL{}_2)\cup(\EL{}_1\|\ET{}_2)))$
    \item $\EL{}_{12}=(\EL{}_1\|\EL{}_2)\cup \ET{}_{12}$
  \end{enumerate}
\end{satz}

\begin{proof}
  ~
  \begin{enumerate}
    \item \glqq $\subseteq$\grqq :
  \end{enumerate}
  \vspace{-0.3cm}
  Da beide Seiten der Gleichung unter der Fortsetzung $\cont{}$ abgeschlossen sind, genügt es ein
  präfix-minimales Element $w$ von $\ET{}_{12}$ zu betrachten. Dieses Element ist
  aufgrund der Definition der Menge der Errortraces entweder in $\MIT{}_{12}$ oder in
  $\PrET{}_{12}$ enthalten.\\
  \begin{itemize}
    \item Fall 1 ($w\in \MIT{}_{12}$): Aus der Definition von $MIT$ folgt, dass es eine
  Aufteilung $w=xa$ gibt mit $(q_{01},q_{02})
  \overset{x}{\Rightarrow}(q_1,q_2)\wedge a\in I_{12}\wedge (q_1,q_2)
  \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$. Da $I_{12}
  \overset{\ref{DefParallelkomposition}}{=}(I_1\backslash O_2)\cup
  (I_2\backslash O_1)=(I_1\cup I_2)\backslash (O_1\cup O_2)$ ist $a\in (I_1\cup
  I_2)$ und $a\notin (O_1\cup O_2)$. Es wird unterscheiden, ob $a\in (I_1\cap I_2)$
  oder $a\in (I_1\cup I_2)\backslash (I_1\cap I_2)$ ist. Diese Unterscheidung
  ist in~\cite{Vogler2014EIO} nicht nötig, da dort $I_1\cap I_2=\emptyset$
  gilt, somit gibt es dort nur den Fall 1b).
  \begin{itemize}
    \item Fall 1a) ($a\in (I_1\cap I_2)$): Nun kann den Ablauf der
      Komposition auf die Transitionssysteme projiziert werden und man erhält dann \oBdA{}
      $q_{01}\overset{x_1}{\Rightarrow} q_1
      \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ und
      $q_{02}\overset{x_2}{\Rightarrow} q_2
      \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ oder
      $q_{02}\overset{x_2}{\Rightarrow} q_2 \overset{a}{\rightarrow}$ mit $x\in
      x_1\|x_2$. Daraus kann $x_1a\in \cont{}(\MIT{}_1)\subseteq \ET{}_1\subseteq
      \EL{}_1$ und $x_2a\in \EL{}_2$ ($x_2a\in \MIT{}_2$ oder $x_2a\in L_2$)
      gefolgert werden. Damit folgt $w\in (x_1\|x_2)\cdot\{a\}\subseteq
      (x_1a)\|(x_2a)\subseteq \ET{}_1\|\EL{}_2$, und somit ist $w$ in der
      rechten Seite der Gleichung enthalten.
  \item Fall 1b) ($a\in (I_1\cup I_2)\backslash(I_1\cap I_2)$): \OBdA{} gilt
      $a\in I_1$. Durch Projektion erhält man:
      $q_{01}\overset{x_1}{\Rightarrow} q_1
      \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ und
      $q_{02}\overset{x_2}{\Rightarrow} q_2$ mit $x\in x_1\|x_2$. Daraus folgt
      $x_1a\in \cont{}(\MIT{}_1)\subseteq \ET{}_1$ und $x_2\in L_2\subseteq \EL{}_2$. Somit
      gilt $w\in (x_1\| x_2)\cdot\{a\}\subseteq (x_1a)\|x_2\subseteq \ET{}_1\|\EL{}_2$.
      Dies ist eine Teilmenge der rechten Seite der Gleichung.
  \end{itemize}
    \item Fall 2 ($w\in \PrET{}_{12}$): Durch die Definitionen von $\PrET{}$
      und $\prune{}$ weiß man, dass es ein $v\in O_{12}^*$ gibt, so dass
      $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)
      \overset{v}{\Rightarrow} (q_1',q_2')$ gilt mit $(q_1',q_2')\in E_{12}$
      und $w=\prune{}(wv)$. Durch Projektion erhält man $q_{01}
      \overset{w_1}{\Rightarrow} q_1 \overset{v_1}{\Rightarrow} q_1'$ und
      $q_{02} \overset{w_2}{\Rightarrow} q_2 \overset{v_2}{\Rightarrow} q_2'$
      mit $w\in w_1\|w_2$ und $v\in v_1\|v_2$. Aus $(q_1',q_2')\in E_{12}$
      folgt, dass es sich entweder um einen geerbten oder einen neuen Error
      handelt. Bei einem geerbten wäre bereits einer der beiden Zustände $q_1$
      bzw. $q_2$ ein Error-Zustand gewesen. Der neue Error hingegen wäre durch
      die fehlende Möglichkeit entstanden, eine synchronisierte Aktion
      auszuführen.
      \begin{itemize}
        \item Fall 2a) (geerbter Error): \OBdA{} $q_1'\in E_1$. Daraus folgt
          $w_1v_1\in \StET{}_1\subseteq \cont{}(\PrET{}_1)\subseteq \ET{}_1$. Da gilt
          $q_{02}\overset{w_2v_2}{\Rightarrow}$, erhält man $w_2v_2\in
          L_2\subseteq \EL{}_2$. Dadurch ergibt sich $wv\in \ET{}_1\|\EL{}_2$ mit
          $w=\prune{}(wv)$ und somit ist $w$ in der rechten Seite der Gleichung
          enthalten.
        \item Fall 2b) (neuer Error): \OBdA{} $a\in I_1\cap O_2$ mit
          $q_1'\overset{a}{\not{\hspace{-0.1cm}\rightarrow}} \wedge \; q_2'
          \overset{a}{\rightarrow}$. Daraus folgt $w_1v_1a\in \MIT{}_1\subseteq
          \ET{}_1$ und $w_2v_2a\in L_2\subseteq \EL{}_2$. Damit ergibt sich $wva\in
          \ET{}_1\|\EL{}_2$, da $a\in O_2\subseteq O_{12}$ gilt $w=\prune{}(wva)$ und
          somit ist $w$ in der rechten Seite der Gleichung enthalten.
      \end{itemize}
  \end{itemize}

  1. \glqq $\supseteq$\grqq :\\
  Wegen der Abgeschlossenheit beider Seiten der Gleichung gegenüber $\cont{}$
  wird auch in diesem Fall nur ein präfix-minimales Element $x\in
  \prune{}((\ET{}_1\|\EL{}_2)\cup (\EL{}_1\|\ET{}_2))$ bedachtet. Da $x$ durch die Anwendung der
  $\prune{}$-Funktion entstanden ist, existiert ein $y\in O_{12}^*$ mit
  $xy\in(\ET{}_1\|\EL{}_2)\cup (\EL{}_1\|\ET{}_2)$. \OBdA{} wird davon
  ausgegangen, dass
  $xy\in \ET{}_1\|\EL{}_2$ gilt, d.h.\ es gibt $w_1\in \ET{}_1$ und $w_2\in \EL{}_2$ mit
  $xy\in w_1\|w_2$. In dem Punkt, dass das präfix-minimale Element noch mit
  Outputs fortsetzt werden kann, unterscheidet sich dieser Beweis von dem
  in~\cite{Schlosser2012BA}. In dieser Quelle wird nicht weiter darauf eingegangen, dass
  die $\prune{}$-Funktion an dieser Stelle noch zur Anwendung kommt. Da jedoch später nur
  Präfixe von $x$ betrachtet werden, ist dieser Unterschied irrelevant.\\
  Im Folgenden wird für alle Fälle von $xy$ gezeigt, dass es ein $v\in
  \PrET{}(S_1\|S_2)\cup \MIT{}(S_1\|S_2)$ gibt, das ein Präfix von $xy$ ist und $v$
  entweder auf einen Input aus $I_{12}$ endet oder $v = \varepsilon$. Da $v$
  entweder leer ist oder auf einen Input endet, muss $v$ ein Präfix von $x$
  sein. $\varepsilon$ ist Präfix von jedem Wort und sobald $v$ mindestens einen
  Buchstaben enthält, muss das Ende von $v$ vor dem Anfang von $y\in O_{12}^*$
  liegen. Dadurch hat $x$ ein Präfix in $\PrET{}(S_1\|S_2)\cup
  \MIT{}(S_1\|S_2)$, damit ist $x$ in
  der Fortsetzung dieser Menge enthalten und somit gilt $x\in \ET{}_{12}$.\\
  Sei $v_1$ das kürzeste Präfix von $w_1$ in $\PrET{}_1\cup \MIT{}_1$. Falls
  $w_2\in L_2$, so sei $v_2=w_2$, sonst soll $v_2$ das kürzeste Präfix von
  $w_2$ in $\PrET{}_2\cup \MIT{}_2$ sein. Jede Aktion in $v_1$ und $v_2$ hängt mit
  einer aus $xy$ zusammen. Es wird nun davon ausgegangen, dass entweder
  $v_2=w_2\in L_2$ gilt oder die letzte Aktion von $v_1$ vor oder
  gleichzeitig mit der letzten Aktion von $v_2$ statt findet. Ansonsten endet
  $v_2\in \PrET{}_2\cup \MIT{}_2$ vor $v_1$ und somit ist dieser Fall analog zu $v_1$
  endet vor $v_2$.
  \begin{itemize}
    \item Fall 1 ($v_1=\varepsilon$): Da $\varepsilon\in \PrET{}_1\cup
      \MIT{}_1$, ist bereits in $S_1$ ein Error lokal erreichbar. $\varepsilon\in
      \MIT{}_1$ ist nicht möglich, da jedes Element aus $MIT$ nach Definition
      mindestens die Länge $1$ haben muss. Mit der Wahl
      $v_2'=v'=\varepsilon$ ist $v_2'$ ein Präfix von $v_2$.
    \item Fall 2 ($v_1\neq\varepsilon$): Aufgrund der Definitionen von $\PrET{}$
      und $MIT$ endet $v_1$ auf ein $a\in I_1$, d.h.\ $v_1=v_1’a$. $v'$ sei das
      Präfix von $xy$, das mit der letzten Aktion von $v_1$ endet, d.h.\ mit
      $a$ und $v_2'=v'|_{\Sigma _{2}}$. Falls $v_2 = w_2\in L_2$, dann ist
      $v_2'$ ein Präfix von $v_2$. Falls $v_2\in
      \PrET{}_2\cup \MIT{}_2$ gilt, dann ist durch die Annahme, dass $v_2$ nicht vor
      $v_1$ endet, $v_2'$ ein Präfix von $v_2$. Im Fall $v_2\in \MIT{}_2$ kann
      durch die gleiche Argumentation ebenfalls geschlossen, dass $v_2'$ ein
      Präfix von $v_2$ ist. Zusätzlich weiß man, dass $v_2$ auf $b\in
      I_2$ endet, jedoch muss nicht mehr wie in~\cite{Vogler2014EIO} $b\neq a$
      gelten. Es kann also keine Aussage mehr darüber getroffen, ob es sich um
      ein echtes Präfix handelt.
  \end{itemize}
  In allen Fällen erhält man: $v_2'=v'|_{\Sigma _2}$ ist ein Präfix von $v_2$
  und $v'\in v_1\| v_2'$ ist ein Präfix von $xy$. Da nicht mehr $b\neq a$
  gelten muss, kann nicht mehr für alle Fälle $q_{02}
  \overset{v_2'}{\Rightarrow}$ gefolgert werden, wie das
  in~\cite{Vogler2014EIO} möglich war, sondern nur wenn $a\notin I_2$ gilt.
  \begin{itemize}
    \item Fall I ($v_1\in \MIT{}_1$ und $v_1\neq\varepsilon$): Es gibt $q_{01}
      \overset{v_1'}{\Rightarrow}q_1
      \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ und sei $v'=v''a$. Bei der
      folgenden Fallunterscheidung müssen bezüglich~\cite{Vogler2014EIO}
      zwei weitere Fälle (Ib) und Ic)) einfügt werden, da es zulässig ist, dass $a$
      sowohl in $I_1$ wie auch in $I_2$ enthalten ist.
      \begin{itemize}
        \item Fall Ia) ($a\notin\Sigma _2$): Es gilt $q_{02}
          \overset{v_2'}{\Rightarrow} q_2$ mit $v''\in v_1'\|v_2'$. Dadurch erhält man
          $(q_{01},q_{02}) \overset{v''}{\Rightarrow} (q_1,q_2)
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ mit $a\in I_{12}$.
          Somit wird $v:=v''a=v'\in \MIT{}_{12}$ gewählt.
        \item Fall Ib) ($a\in I_2$ und $v_2'\in \MIT{}_2$): Es gilt $v_2'=v_2''a$
          mit $q_{02} \overset{v_2''}{\Rightarrow} q_2
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ und $v''\in
          v_1'\|v_2''$. $a$ ist  für $S_2$, ebenso wie für $S_1$, ein fehlender
          Input. Daraus folgt, dass $(q_1,q_2)
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ gilt. Es wird
          $v:=v''a=v'\in \MIT{}_{12}$ gewählt.
        \item Fall Ic) ($a\in I_2$ und $v_2'\in L_2$): Es gilt $q_{02}
          \overset{v_2''}{\Rightarrow} q_2 \overset{a}{\rightarrow}$ mit
          $v_2'=v_2''a$. Da jedoch $a$ in $Synch(S_1,S_2)$ liegt, wurde die Menge
          der synchronisierten Aktionen bezüglich~\cite{Vogler2014EIO}
          erweitert, somit reicht schon, dass $q_1
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$ gilt, um Folgendes
          schließen zu können $(q_1,q_2)
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}}$. Somit kann hier
          $v:=v''a=v'\in \MIT{}_{12}$ gewählt werden. %TODO zu diesem Fall
          %Korrektur kapieren und einarbeiten
        \item Fall Id) ($a\in O_2$): Es gilt $v_2'=v_2''a$ und $q_{02}
          \overset{v_2'}{\Rightarrow}$. Man erhält also $q_{02}
          \overset{v_2''}{\Rightarrow} q_2 \overset{a}{\rightarrow}$ mit
          $v''\in v_1'\|v_2''$. Daraus ergibt sich $(q_{01},q_{02})
          \overset{v''}{\Rightarrow} (q_1,q_2)$ mit $q_1
          \overset{a}{\not{\hspace{-0.1cm}\rightarrow}},a\in I_1, q_2
          \overset{a}{\rightarrow},a\in O_2$, somit gilt $(q_1,q_2)\in
          E_{12}$. Es wird $v:=\prune{}(v'')\in \PrET{}_{12}$ gewählt.
      \end{itemize}
  \item Fall II ($v_1\in \PrET{}_1$): $\exists u_1\in O_1^*:q_{01}
    \overset{v_1}{\Rightarrow} q_1 \overset{u_1}{\Rightarrow} q_1'$ mit
    $q_1'\in E_1$. Da es hier keine disjunkten Inputmengen wie
    in~\cite{Vogler2014EIO} gibt kann das $a$, auf das $v_1$ im Fall $v_1\neq
    \varepsilon$ endet, ebenfalls der letzte Buchstabe von $v_2$
    sein. Im Fall von $v_2\in \MIT{}_2$ kann somit $a=b$ gelten und somit wäre
    $v_2=v_2'$. Dieser Fall verläuft jedoch analog zu Fall Ic) und wird somit
    hier nicht weiter betrachtet. Es gilt somit für
    alle anderen Fälle hier $q_{02} \overset{v_2'}{\Rightarrow}q_2$ mit
    $(q_{01},q_{02}) \overset{v'}{\Rightarrow}(q_1,q_2)$.
    \begin{itemize}
      \item Fall IIa) ($u_2\in (O_1\cap I_2)^*, c\in (O_1\cap I_2)$, sodass
        $u_2c$ Präfix von $u_1|_{I_2}$ mit $q_2 \overset{u_2}{\Rightarrow} q_2'
        \overset{c}{\not{\hspace{-0.1cm}\rightarrow}}$): Für das Präfix $u_1'c$
        von $u_1$ mit $u_1'c|_{I_2}=u_2c$ weiß man, dass $q_1
        \overset{u_1'}{\Rightarrow} q_1'' \overset{c}{\rightarrow}$. Somit gilt
        $u_1'\in u_1'\|u_2$ und $(q_1,q_2) \overset{u_1'}{\Rightarrow}
        (q_1'',q_2')\in E_{12}$, da für $S_2$ der entsprechende Input fehlt,
        der mit dem $c$ Output von $S_1$ zu koppeln wäre. Es handelt sich also
        um einen neuen Error. Es wird $v:=\prune{}(v'u_1')\in \PrET{}(S_1\|
        S_2)$ gewählt,
        dies ist ein Präfix von $v'$, da $u_1\in O_1^*$.
      \item Fall IIb) ($q_2 \overset{u_2}{\Rightarrow} q_2'$ mit
        $u_2=u_1|_{I_2}$): Somit ist $u_1\in u_1\|u_2$ und $(q_1,q_2)
        \overset{u_1}{\Rightarrow} (q_1',q_2')\in E_{12}$, da $q_1'\in E_1$ und
        somit handelt es sich um einen geerbten Error. Es wird nun $v:=\prune{}
        (v'u_1)\in \PrET{}(S_1\|S_2)$ gewählt, das wiederum ein Präfix von $v'$ ist.
    \end{itemize}
  \end{itemize}

  2.:\\
  Der Beweis für diesen Punkt konnte bezüglich~\cite{Vogler2014EIO} fast
  unverändert übernommen werden, bis auf die Ersetzung der Zeichen der Parallelkomposition.\\
  Es ist durch die Definition klar, dass gilt $L_i\subseteq \EL{}_i$ und
  $\ET{}_i\subseteq \EL{}_i$. Die Argumentation wird von der rechten
  Seite der Gleichung aus begonnen:
  \begin{align*}
    &(\EL{}_1\| \EL{}_2)\cup \ET{}_{12}\\
    &\overset{\ref{DefETEL}}{=}(L_1\cup \ET{}_1)\|(L_2\cup \ET{}_2)\cup \ET{}_{12}\\
    &=\underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\EL{}_1\|\ET{}_2)}{\underbrace{(L_1\|\ET{}_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\ET{}_1\|\EL{}_2)}{\underbrace{(\ET{}_1\|L_2)}}} \cup
    (L_1\|L_2) \cup \underset{\overset{1.}{\subseteq}
    \ET{}_{12}}{\underset{\subseteq (\EL{}_1\|\ET{}_2)}{\underbrace{(\ET{}_1\|\ET{}_2)}}} \cup
    \ET{}_{12}\\
    &=(L_1\|L_2) \cup \ET{}_{12}\\
    &\overset{\ref{LemmaSprache}}{=}L_{12}\cup \ET{}_{12}\\
    &\overset{\ref{DefETEL}}{=}\EL{}_{12}
  \end{align*}
\end{proof}

Die folgende Proposition wurde hier noch explizit mit Beweis eingefügt im
Gegensatz zu den Ausführungen in~\cite{Vogler2014EIO}, in denen diese
Präkongruenz nur als Folgerung aus dem letzten Satz erwähnt wird. Die
Feststellung, dass es sich um eine Präkongruenz handelt, ist wichtig, da
dann die erste Eigenschaft erfüllt ist, um eine operationale Beschreibung der
vollständig abstrakten Präkongruenz \ECRel{} zu erhalten.

\begin{prop}[Präkongruenz]
  \label{propPraekongruenz}
  \ERel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{prop}

\begin{proof}
  Es muss gezeigt werden: Wenn $S_1\ERel S_2$ gilt, dann für jedes
  komponierbare $S_3$ auch $S_3\|S_1\ERel S_3\|S_1$. D.h.\ es ist zu zeigen,
  dass aus $\ET{}_1\subseteq \ET{}_2$ und $\EL{}_1\subseteq \EL{}_2$ folgt,
  $\ET{}(S_3\|S_1)\subseteq \ET{}(S_3\|S_2)$ und $\EL{}(S_3\|S_1)\subseteq
  \EL{}(S_3\|S_2)$. Dies ergibt sich aus der Monotonie von \cont{}, \prune{}
  und $\cdot \|\cdot$ auf Sprachen wie folgt:\\
  \begin{itemize}
    \item $\begin{aligned}[t]
        \ET{}(S_3\|S_1) &\overset{\ref{satzErrorSemanik}~1.}{=}
      \cont{}(\prune{}((\ET{}_3\|\EL{}_1)\cup (\EL{}_3\|\ET{}_1)))\\
      &\hspace{-0.3cm}\overset{\ET{}_1\subseteq
    \ET{}_2}{\overset{\mathrm{und}}{\overset{\EL{}_1\subseteq \EL{}_2}{\subseteq}}}
    \cont{}(\prune{}((\ET{}_3\|\EL{}_2)\cup (\EL{}_3\|\ET{}_2)))\\
      &\overset{\ref{satzErrorSemanik}~1.}{=} \ET{}(S_3\|S_2)
    \end{aligned}$
    \item $\begin{aligned}[t]
        \EL{}(S_3\|S_1) &\overset{\ref{satzErrorSemanik}~2.}{=} (\EL{}_3\|\EL{}_1)\cup
        E_{31}\\
        &\hspace{-0.4cm}\overset{\EL{}_1\subseteq
      \EL{}_2}{\overset{\mathrm{und}}{\overset{\ET{}_{31}\subseteq
      \ET{}_{32}}{\subseteq}}} (\EL{}_3\|\EL{}_2)\cup \ET{}_{32}\\
      &\overset{\ref{satzErrorSemanik}~2.}{=} \EL{}(S_3\|S_2)
    \end{aligned}$
  \end{itemize}
\end{proof}

In~\cite{Vogler2014EIO} wurde auch die Verfeinerung von \EIO{}s als Relation betrachtet
mit Spezifikation und Implementierung. Hier soll ebenfalls eine
Verfeinerungsrelation über \EIO{}s betrachtet werden, jedoch sollen die
synchronisierten Aktionen nicht verborgen werden. Dadurch ändern sich natürlich
auch Teile des Beweises, vor allem muss statt mit $\StET{}$ mit der Menge
$\PrET{}$ argumentiert werden. Dieses Lemma existiert in dieser Form nicht
in~\cite{Schlosser2012BA}, da es dort mit der Aussage von
Satz~\ref{satzFullAbstractness} kombiniert wurde. Jedoch ist die Aussage dieses
Lemmas trotzdem Teil dessen, was gezeigt wird und somit finden sich die Teile
dieses Beweises auch dort wieder.

%TODO "gut kommunizieren" als Interpretation in Text-Form, Definition nur mit
%Verfeinerung (siehe dazu Korrektur)

\begin{lem}[Verfeinerung mit Errors]
  \label{lemVerfeinerung}
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  alle Partner \EIO{}s $U$, die mit $S_2$ gut kommunizieren, auch mit $S_1$ gut
  kommunizieren, dann verfeinert $S_1$ das \EIO{} $S_2$. Diese Verfeinerung
  entspricht der Relation \ERel{} von oben: Wenn $U\|S_1 \EBRel U\|S_2$ für
  alle Partner $U$, dann gilt $S_1\ERel S_2$.
\end{lem}

\begin{proof}
  Da $S_1$ und $S_2$ die gleichen Signaturen haben wird
  $I:=I_1=I_2$ und $O:=O_1=O_2$ definiert. Für jeden der Partner $U$ gilt $I_U=O$ und
  $O_U=I$.\\
  Um $S_1\ERel S_2$ zu zeigen, wird nachgeprüft, ob folgendes gilt:
  \begin{itemize}
    \item $\ET{}(S_1)\subseteq \ET{}(S_2)$,
    \item $\EL{}(S_1)\subseteq \EL{}(S_2)$.
  \end{itemize}
  Für ein gewähltes präfix-minimales Element $w\in \ET{}(S_1)$ wird gezeigt,
  dass dieses $w$ oder eines seiner Präfixe in $\ET{}(S_2)$ enthalten ist.
  Dies ist möglich, da beide Mengen durch $\cont{}$ abgeschlossen sind.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Error in $S_1$.
      Für $U$ wird ein Transitionssystem verwendet, das nur aus dem Startzustand und
      einer Schleife für alle Inputs $x\in I_U$ besteht. Somit kann $S_1$ die gleichen
      Error-Zustände lokal erreichen wie $U\|S_1$. Daraus folgt, dass auch
      $U\|S_2$ einen lokal erreichbaren Error-Zustand haben muss. Durch die
      Definition von $U$ kann dieser Error nur von $S_2$ geerbt sein. Es
      muss also in $S_2$ ein Error-Zustand durch interne Aktionen und Outputs
      erreichbar sein, d.h.\ es gilt $\varepsilon\in \PrET{}(S_2)$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgenden Partner $U$ bedachtet (siehe auch
      Abbildung~\ref{UohneE}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_{n+1}\}$
        \item $q_{0U}=q_0$
        \item $E_U=\emptyset$
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i\leq n\}\\
                      &\cup\{(q_i,x,q_{n+1})\mid  x\in I_U\backslash\{x_{i+1}\},
          0\leq i\leq n\}\\
          &\cup\{(q_{n+1},x,q_{n+1})\mid  x\in I_U\}
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$q_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$q_{n+1}$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (n1)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (n1)
                (n) edge node [above, sloped] {$x?\in I_U$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
        \label{UohneE}
      \end{center}
      \end{figure}
      Für $w$ können zwei Fälle unterscheiden werden. Beide führen zu
      $\varepsilon\in \PrET{}(U\|S_1)$. Dieses Resultat unterscheidet sich von dem
      in~\cite{Vogler2014EIO}, da hier die synchronisierten Aktionen als Outputs
      vorhanden bleiben und somit kann nicht $\varepsilon\in \StET{}(U\|S_1)$
      gelten.
      \begin{itemize}
        \item Fall 2a) ($w\in \MIT{}(S_1)$): In $U\|S_1$ erhält man
          $(q_0,q_{01}) \overset{x_1\dots x_n}{\Rightarrow} (q_n,q')$ mit
          $q' \overset{x_{n+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und $q_n
          \overset{x_{n+1}}{\rightarrow}$. Deshalb gilt $(q_n,q')\in
          E_{U\|S_1}$ und $x_1\dots x_n\in \StET{}(U\|S_1)$. Da alle Aktionen aus
          $w$ bis auf $x_{n+1}$ synchronisiert werden gilt $x_1,\dots ,x_n\in
          O_{U\|S_1}$. Daraus ergibt sich dann $\varepsilon\in \PrET{}(U\|S_1)$.
        \item Fall 2b) ($w\in \PrET{}(S_1)$): In $U\|S_1$ erhält man
          $(q_0,q_{01}) \overset{w}{\Rightarrow} (q_{n+1},q'')
          \overset{u}{\Rightarrow} (q_{n+1},q')$ für $u\in O^*$ und $q'\in
          E_1$. Daraus folgt $(q_{n+1},q')\in E_{U\|S_1}$ und somit $wu\in
          \StET{}(U\|S_1)$. Da alle Aktionen aus $w$ synchronisiert werden, gilt
          $x_1,\dots ,x_n,x_{n+1}\in O_{U\|S_1}$ und, da $u\in O^*$, folgt
          $u\in O_{U\|S_1}^*$. Somit ergibt sich $\varepsilon\in
          \PrET{}(U\|S_1)$.
      \end{itemize}
      Da $\varepsilon\in \PrET{}(U\|S_1)$ gilt, kann durch
      $U\|S_1\EBRel U\|S_2$ geschlossen werden, dass auch in $U\|S_2$ ein Error
      lokal erreichbar sein muss.\\
      Dieser Error kann geerbt oder neu sein.
      \begin{itemize}
        \item Fall 2i) (neuer Error): Da jeder Zustand von $U$ alle Inputs $x\in
          O=I_U$ zulässt, muss ein lokal erreichbarer Error der Form sein, dass
          ein Output $a\in O_U$ von $U$ möglich ist, der nicht mit einem
          passenden Input aus $S_2$ synchronisiert werden kann. Durch die
          Konstruktion von $U$ sind in $q_{n+1}$ keine Outputs möglich. Ein
          neuer Error muss also die Form $(q_i,q')$ haben mit $i\leq n, q'
          \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und $x_{i+1}\in
          O_U=I$. Durch Projektion erhält man dann $q_{02} \overset{x_1\dots
          x_i}{\Rightarrow} q'
          \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und damit gilt
          $x_1\dots x_{i+1}\in \MIT{}(S_2)\subseteq \ET{}(S_2)$. Somit ist ein Präfix
          von $w$ in $\ET{}(S_2)$ enthalten.
        \item Fall 2ii) (geerbter Error): $U$ hat $x_1\dots x_i u$ ausgeführt
          mit $u\in I_U^*=O^*$ und ebenso hat $S_2$ diesen Weg ausgeführt.
          Durch dies hat $S_2$ einen Zustand in $E_2$ erreicht, da von $U$
          keine Errors geerbt werden können. Es gilt dann $\prune{}(x_1\dots
          x_iu)=\prune{}(x_1\dots x_i)\in \PrET{}(S_2)\subseteq \ET{}(S_2)$. Da $x_1\dots
          x_i$ ein Präfix von $w$ ist, führt auch in diesem Fall ein Präfix von
          $w$ zu einem Error.
      \end{itemize}
  \end{itemize}
  Um die zweiten Inklusion zu beweisen, reicht es aufgrund der ersten
  Inklusion und der Definition von $\EL{}$ aus zu zeigen, dass
  $L(S_1)\backslash \ET{}(S_1)\subseteq \EL{}(S_2)$ gilt.\\
  Es wird dafür ein beliebiges $w\in L(S_1)\backslash \ET{}(S_1)$ gewählt und
  gezeigt, dass es in $\EL{}(S_2)$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Da $\varepsilon$ immer in $\EL{}(S_2)$
      enthalten ist, ist hier nichts zu zeigen.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Es wird einen
      Partner $U$ wie folgt konstruiert (siehe dazu auch Abbildung~\ref{UmitE}):
      \begin{itemize}
        \item $Q_U=\{q,q_0,q_1,\dots ,q_n\}$
        \item $q_{0U}=q_0$
        \item $E_U={q_n}$
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid 0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid x\in I_U\backslash\{x_{i+1}\},0\leq
          i\leq n\}\\
          &\cup\{(q,x,q)\mid x\in I_U\}
              \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$q_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$q_n\in E_U$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                       edge [dashed] (q)
                (n1) edge node {$x_n$} (n)
                edge [bend left] node [below, sloped] {$x?\neq x_n$} (q)
                (q) edge [loop below] node {$x?\in I_U$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$, $q_n$
          ist der einzige Error-Zustand}
        \label{UmitE}
      \end{center}
      \end{figure}
      Da $q_{01} \overset{w}{\Rightarrow} q'$ gilt, kann man schließen, dass $U\|S_1$
      einen lokal erreichbaren geerbten Error hat. Somit muss $U\|S_2$ ebenfalls einen
      lokal erreichbaren Error haben.
      \begin{itemize}
        \item Fall 2a) (neuer Error aufgrund von $x_i\in O_U$ und $q_{02}
          \overset{x_1\dots x_{i-1}}{\Rightarrow} q''
          \overset{x_i}{\not{\hspace{-0.1cm}\rightarrow}}$): Es gilt $x_1\dots
          x_i\in \MIT{}(S_2)$ und somit $w\in \EL{}(S_2)$. Anzumerken ist, dass nur
          auf diesem Weg Outputs von $U$ möglich sind, deshalb gibt es keine
          anderen Outputs von $U$, die zu einem neuen Error führen können.
        \item Fall 2b) (neuer Error aufgrund von $a\in O_2$): Der einzige
          Zustand, in dem $U$ nicht alle Inputs erlaubt sind, ist $q_n$, der
          bereits ein Error-Zustand ist. Falls dieser Zustand erreichbar ist in
          $U\|S_2$, dann besitzt das komponierte \EIO{} einen geerbten Error und
          es gilt $w\in L(S_2)\subseteq \EL{}(S_2)$, wegen Fall 2c).
        \item Fall 2c) (geerbter Error von $U$): Da der einzige Zustand aus
          $E_U$ $q_n$ ist und alle Aktionen synchronisiert sind, ist dies nur
          möglich, wenn gilt $q_{02} \overset{x_1\dots x_n}{\Rightarrow}$. In
          diesem Fall gilt, $w\in L(S_2)\subseteq \EL{}(S_2)$.
        \item Fall 2d) (geerbter Error von $S_2$): Es gilt dann $q_{02}
          \overset{x_1\dots x_iu}{\Rightarrow} q'\in E_2$ für $i\geq 0$ und
          $u\in O^*$. Somit ist $x_1\dots x_iu\in \StET{}(S_2)$ und damit
          $\prune{}(x_1\dots x_iu)=\prune{}(x_1\dots x_i)\in \PrET{}(S_2)\subseteq
          \EL{}(S_2)$. Somit gilt $w\in \EL{}(S_2)$.
      \end{itemize}
  \end{itemize}
\end{proof}

Der folgende Satz sagt aus, dass \ERel{} die gröbste Präkongruenz ist, die
charakterisiert werden soll, also gleich der vollständig abstrakten
Präkongruenz \ECRel{}.

\begin{satz}[Full Abstractness für Error-Semanik]
  \label{satzFullAbstractness}
  Seien $S_1$ und $S_2$ zwei \EIO{}s mit derselben Signatur. Dann gilt
  $S_1\ECRel S_2\Leftrightarrow S_1\ERel S_2$, insbesondere ist \ERel{}
  eine Präkongruenz.
\end{satz}

\begin{proof}
  \glqq $\Leftarrow$\grqq : Nach Definition gilt, genau dann wenn
      $\varepsilon\in \ET{}(S)$, ist ein Error lokal erreichbar in $S$.
      $S_1\ERel S_2$ impliziert, dass $\varepsilon\in
      \ET{}(S_2)$ gilt, wenn $\varepsilon\in \ET{}(S_1)$. Somit ist ein Error
      in $S_1$ nur dann lokal erreichbar, wenn dieser auch in $S_2$ erreichbar
      ist. Dadurch folgt, dass $S_1\EBRel S_2$ gilt, da \EBRel{} in
      Definition~\ref{DefErrorBasisrel} über die lokale Erreichbarkeit der
      Error-Zustände definiert wurde. Somit ist \ERel{} in \EBRel{} enthalten.
      Wie in Proposition~\ref{propPraekongruenz} gezeigt, ist \ERel{} eine
      Präkongruenz. Da \ECRel{} die gröbste Präkongruenz bezüglich
      $\cdot\|\cdot$ ist, die in \EBRel{} enthalten ist, muss \ERel{} in
      \ECRel{} enthalten sein. Es folgt also aus $S_1\ERel S_2$, dass auch
      $S_1\ECRel{} S_2$ gilt.

      \glqq $\Rightarrow$\grqq : Durch die Definition von \ECRel{} als
      Präkongruenz in~\ref{DefErrorBasisrel} folgt aus $S_1\ECRel S_2$, dass
      $U\|S_1\ECRel U\|S_2$ für alle \EIO{}s $U$, die mit $S_1$ komponierbar
      sind. Da \ECRel{} nach Definition auch in \EBRel{} enthalten sein soll
      folgt aus $U\|S_1\ECRel U\|S_2$ auch die Gültigkeit von $U\|S_1\EBRel
      U\|S_2$ für alle diese \EIO{}s $U$. Mit Lemma~\ref{lemVerfeinerung} folgt
      dann $S_1\ERel S_2$.
\end{proof}

Es wurde somit jetzt eine Kette an Folgerungen gezeigt, die sich zu einem
Ring schließt. Dies ist in Abbildung~\ref{Folgerungskette} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{
        S_1\ERel S_2 & S_1\ECRel S_2 \\
        \substack{\forall~\mathrm{Partner}~U:\\U\|S_1\EBRel U\|S_2} &
    \substack{\forall~\mathrm{komponierbaren}~U:\\U\|S_1\EBRel U\|S_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{satzFullAbstractness}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition von \ECRel{}
          in~\ref{DefErrorBasisrel}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{lemVerfeinerung}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{U~\mathrm{Partner}\\\Downarrow\\ U~\mathrm{komponierbar}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette}
    \label{Folgerungskette}
  \end{center}
\end{figure}

Aus Satz~\ref{satzFullAbstractness} und Lemma~\ref{lemVerfeinerung} ergibt sich
das folgende Korollar:

\begin{kor}
  Ein \EIO{} $S_1$ verfeinert ein \EIO{} $S_2$ genau dann, wenn für alle \EIO{}s $U$
  für die $S_2$ gut mit $U$ kommuniziert, folgt $S_1$ kommuniziert
  ebenfalls gut mit $U$.\\
  Dies lässt sich formal wie folgt ausdrücken: $S_1\ERel S_2
  \Leftrightarrow U\|S_1\EBRel U\|S_2$ für alle Partner $U$.
  %TODO gut kommunizieren und verfeinern analog zu Lemma 3.7 ersetzten
\end{kor}

\section{Hiding und Error-Freiheit}

Es soll nun untersucht werden, was für Auswirkungen Hiding auf die
Verfeinerungsrelationen hat. Es werden also Outputs der Systeme internalisiert.

\begin{prop}[Error-Basisrelation bzgl. Internalisierung]
  \label{propErBaIn}
  Wenn $S_1\EBRel S_2$ gilt, dann folgt daraus, dass auch $(S_1/X)\EBRel
  (S_2/X)$ gilt.
\end{prop}

\begin{proof}
  Da die Definition der lokalen Erreichbarkeit auf lokalen Aktionen beruht, die
  aus den Outputs und der internen Aktion besteht, ändert sich durch das
  Verbergen von Outputs nichts an der Error-Erreichbarkeit. Somit ist jeder
  Error, der in $S_i$ lokal erreichbar ist über ein Trace, das Outputs aus $X$
  enthält, auch in $S_i/X$ erreichbar, jedoch enthält das Trace
  nicht mehr diesen Output. Alle Traces, die keine Outputs aus der Menge hinter
  dem Internalisierungsoperator enthalten, bleiben unverändert erhalten. Es ist
  auch nicht möglich, dass durch das Verbergen von Outputs neue Errors
  entstehen. Somit folgt die Behauptung.
\end{proof}

\begin{satz}[Präkongurenz bzgl. Interalisierung]
  \label{satzPraeInternalisierung}
  Seinen $S_1$ und $S_2$ zwei \EIO{}s für die $S_1\ERel S_2$ gilt, somit gilt
  auch $(S_1/X)\ERel (S_2/X)$. Daraus folgt insbesondere, dass \ERel{} eine
  Präkongruenz bezüglich $\cdot /\cdot$ ist.
\end{satz}

\begin{proof}
  Da $S_1\ERel S_2$ gilt, weiß man, dass $\ET{}_1\subseteq \ET{}_2$ und
  $\EL{}_1\subseteq \EL{}_2$ gilt. Um eine genauere Vorstellung davon zu
  bekommen, was das Hiding für die Systeme bedeutet, werden hier zunächst
  einmal die neuen Errortraces und die neue error-geflutete Sprache definiert.
  Es gilt:
  \begin{itemize}
    \item $\ET{}(S/X) = \{w\in (\Sigma\backslash (X\cap O))^*\mid \exists
      w'\in \ET{}(S): w'|_{\Sigma\backslash (X\cap O)} = w\}$,
    \item $\EL{}(S/X) = \{w\in (\Sigma\backslash (X\cap O))^*\mid \exists w'\in
      \EL(S): w'|_{\Sigma\backslash (X\cap O)} = w\}$.
  \end{itemize}
  %TODO umformulieren bzgl. der neuen ET und EL Definitionen und Abläufe
  %explizit einarbeiten (beliebige Verlängerungen möglich?)
  Es wird einen präfix-minimaler Traces $w=a_1a_2\dots a_m\in \ET{}_1$ gewählt.
  Daraus folgt, dass ein Ablauf $q_0 \overset{w}{\Rightarrow} q$ existiert mit
  $q\in E$ oder $q$ hat nicht für alle Inputs eine Transitionsmöglichkeit. Es
  gilt also entweder $w\in \PrET{}_1$ oder $w\in \MIT{}_1$. An diesem Punkt
  muss unterschieden werden, ob es sich hier um ein Trace handelt, der aus
  dem leeren Wort besteht oder um ein Trace, für den $m\geq 1$ gilt.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Da Elemente aus $\MIT{}_1$ mindestens die
      Länge 1 haben müssen, gilt hier $w\in \PrET{}_1$. Da es in diesem Wort
      keine Aktionen aus $X$ gibt, werden in diesem Zusammenhang auch keine
      Aktionen verborgen und somit gilt $\varepsilon\in\PrET{}(S_1/X)$. In
      $\ET{}(S_1/X)$ sind somit alle beliebigen Kombinationen von Aktionen aus
      $\Sigma$ enthalten, genau so wie in $\ET{}_1$.\\
    \item Fall 2 ($m\geq 1$): Nach der Internalisierung bleiben von dem Ablauf
      nur noch die Aktionen übrig, die nicht Element von $X\cap O$ sind. Da
      hier ein präfix-minimales Element aus $\ET{}_1$ betrachtet wird, muss
      $a_m\in I$ gelten. Das Trace reduziert sich also auf
      $w'=w|_{\Sigma\backslash (O\cap X)}$. Dabei bleibt der Input $a_m$
      erhalten. $w'$ ist dann in $\MIT{}(S_1/X)$ oder in $\PrET{}(S_1/X)$
      enthalten und somit ist $w'$ und alle seine Verlängerungen durch die
      \cont{}-Funktion in $\ET{}(S_1/X)$ enthalten.
  \end{itemize}
  Nach Voraussetzung gilt $w\in\ET{}_2$. Nach analoger Argumentation gilt dann
  auch $w'\in\ET{}(S_2/X)$.\\
  Somit bleibt jetzt nur noch zu zeigen, dass $L(S_1/X)\backslash \ET{}(S_1/X)
  \subseteq EL(S_2/X)$ gilt. Die Argumentation wieso nur diese Inklusion zu
  zeigen ist, kann dem Beweis zu Lemma~\ref{lemVerfeinerung} entnommen werden.
  Da bereits bekannt ist, dass $L_1\backslash\ET{}_1\subseteq\EL{}_2$ gilt,
  kann geschlossen werden, dass alle relevanten Traces bereits in $\EL{}_2$
  enthalten sind und die Modifikation durch den Internalisierungsoperator wie
  oben keine Auswirkungen auf die Teilmengenbeziehung hat. Es ist hier nur noch
  wichtig festzuhalten, dass für ein Trace aus $L_1$ keine beliebigen
  Verlängerungen zulässig sind, genauso wie für $L(S_1/X)$. Jedoch kann immer
  ein passender Trace in $L(S_1/X)$ zu jedem Trace aus $L_1$ gefunden werden
  durch weglassen der Aktionen aus $X\cap O$.
\end{proof}

Aus~\ref{propPraekongruenz} ist bekannt, dass \ERel{} eine Präkongruenz
bezüglich $\cdot\|\cdot$ ist, und aus~\ref{satzPraeInternalisierung}, dass
\ERel{} auch eine Präkongruenz bezüglich $\cdot/\cdot$ ist. Da sich nach
Definition~\ref{defIntParal} die Parallelkomposition mit Internalisierung nur
aus diesen Operatoren zusammensetzt, erhalten man das folgende Korollar.

\begin{kor}[Präkongurenz mit Internalisierung]
  \ERel{} ist eine Präkongruenz bezüglich $\cdot|\cdot$.
\end{kor}
