\chapter{Verfeinerung über Error- und Quiescenttraces}

In diesem Kapitel werden wir uns nicht nur um die Erreichbarkeit von
Error-Zuständen kümmern, sondern auch um die Erreichbarkeit von
Quiescent-Zuständen. Wir werden dabei ähnlich vorgehen wie im letzten Kapitel,
jedoch halten wir uns als Quelle an~\cite{Chilton2013}. Darin werden ähnliche Konzepte
beschrieben, jedoch aus Sicht der Traces.\\
Wir sehen nicht nur die Zustände, die keine Outputs haben als Quiescents an,
sondern auch die, die eine $\tau$-Transition zu so einem machen können, da wir
diese Zustände auf Trace-Ebene nicht unterscheiden können.

\begin{Def}[Quiescent]
  Ein \emph{Quiescent-Zustand} ist ein Zustand in einem \EIO{} der keine Outputs besitzt
  oder ein Zustand, von dem aus über eine interne Handlung $\tau$ ein Zustand
  erreicht werden kann, der keine Outputs zulässt.\\
  Somit ist die Menge der Quiescent-Zustände in einem \EIO{} wie folgt formal
  definiert: $Qui:=\{q\in Q\mid q\in K\vee \exists p\in Q:
  q\overset{\tau}{\Rightarrow} p\in K\}$ mit $K:=\{q\in Q\mid \forall a\in O:
  q\overset{a}{\not{\hspace{-0.1cm}\rightarrow}}\}$.
\end{Def}

Für die Erreichbarkeit verwenden wir wie im letzten Kapitel wieder den
optimistischen Ansatz der lokalen Erreichbarkeit für die Errors. Da die
Quiescents jedoch keine unabwendbaren Fehler sein, sondern durch einen Input
reparierbar sind, sagen wir, dass diese erst erreichbar sind, wenn sie durch
eine interne Handlung zu erreichen sind. Also eher einen hyper-optimistischen
Erreichbarkeitsbegriff.

\begin{Def}[lokal error- und quiescentfreie Kommunikation]
  Zwei \EIO{}s $S_1$ und $S_2$ \emph{kommunizieren gut}, wenn keine Errors
  lokal und keine Quiescents durch interne Handlungen
  erreichbar sind in ihrer Parallelkomposition $S_1\| S_2$.
\end{Def}

\begin{Def}[lokale Basisrelation]
  Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur schreiben wir
  $S_1\QBRel S_2$, wenn ein Error oder Quiescent in $S_1$ nur dann lokal bzw.\
  durch ein $\tau$ erreichbar ist, wenn er auch in $S_2$ lokal erreichbar
  ist.\\
  \QCRel{} bezeichnet die \emph{vollständig abstrakte Präkongruenz} von
  \QBRel{} bezüglich $\cdot\|\cdot$.
\end{Def}

\begin{Def}[Error und Quiescenttraces]
  \label{DefQuiescenttraces}
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item die Traces bezüglich Errors entsprechen denen
      aus~\ref{DefErrortraces},
    \item \emph{strickte Quiescenttraces}: $\StQT{}(S) := \{w\in\Sigma ^*\mid q_0
      \overset{w}{\Rightarrow} q\in Qui\}$.
  \end{itemize}
\end{Def}

\begin{Def}[Lokale Error und Quiescent Semantik]
  \label{DefQTQL}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Errortraces} ist wie in~\ref{DefETEL} definiert.
    \item Die Menge der \emph{Quiescenttraces} von $S$ ist $\QT{}(S) := \StQT{}(S)$.
    \item Die \emph{geflutete Sprache} von $S$ ist $\QL{}(S):=L(S)\cup \ET{}(S)$
      und entspricht somit der gefluteten Sprache $\EL{}(S)$ in~\ref{DefETEL}.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur schreiben wir
  $S_1\QRel S_2$, wenn $\ET{}(S_1)\subseteq \ET{}(S_2)$,
  $\QT{}(S_1)\subseteq \QT{}(S_2)$ und $\QL{}(S_1)\subseteq \QL{}(S_2)$ gilt.
\end{Def}

Da $QT$ nur die strickten Quiescenttraces enthält, also die Traces, die im
Automaten vorhanden sind und zu einem Quiescent-Zustand führen, gilt
$QT\subseteq L\subseteq QL$. Somit musste $QT$ nicht mehr explizit in die
Definition von $QL$ aufgenommen werden und trotzdem ist jeder Traces, der in
$QT$ möglich ist auch in der gefluteten Sprache enthalten.

\begin{satz}[Lokale Error und Quiescent Semantik für Parallelkompositonen]
  \label{satzQuiSemantik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und $S_{12} = S_1\|S_2$ gilt:
  \begin{enumerate}
    \item $\ET{}_{12} = \cont{}(\prune{}((\ET{}_1\|\QL{}_2)\cup (\QL{}_1\|\ET{}_2)))$,
    \item $\QT{}_{12} = (\QT{}_1\|\QT{}_2)$,%TODO???
    \item $\QL{}_{12} = (\QL{}_1\|\QL{}_2)\cup \ET{}_{12}$.%TODO???
  \end{enumerate}
\end{satz}

\begin{proof}
  ~
  \begin{enumerate}
    \item \hspace{-0.2cm}:
  \end{enumerate}
  \vspace{-0.3cm}
  Der Beweis diese Punktes entspricht dem Beweis von Punkt 1.\ im Beweis von
  Satz~\ref{satzErrorSemanik}.

  2. ``$\subseteq$'':\\
  Wir betrachten $w\in \StQT{}_{12}$ und versuchen dessen
  Zugehörigkeit zur rechten Menge zu zeigen. Aufgrund von
  Definition~\ref{DefQuiescenttraces} wissen wir es gilt $(q_{01},q_{02})
  \overset{w}{\Rightarrow} (q_1,q_2)$ mit $(q_1,q_2)\in Qui_{12}$. Durch
  Projektion erhalten wir $q_{01} \overset{w_1}{\Rightarrow} q_1$ und $q_{02}
  \overset{w_2}{\Rightarrow} q_2$ mit $w\in w_1\|w_2$. Aus $(q_1,q_2)\in
  Qui_{12}$ können wir folgern, dass bereits $q_1\in Qui_1$ und $q_2\in
  Qui_2$ gilt. Somit gilt $w_1\in \StQT{}_1\subseteq \QT{}_1$ und $w_2\in
  \StQT{}_2\subseteq \QT{}_2$. Daraus folgt dann $w\in \QT{}_1\|\QT{}_2$ und somit ist $w$
  in der rechten Seiten der Gleichung enthalten.

  2. ``$\supseteq$'':\\
  Für diese Inklusionsrichtung betrachten wir ein Element $w\in \QT{}_1\|\QT{}_2$ und
  zeigen, dass es in der linken Menge enthalten ist. Da $\QT{}_i = \StQT{}_i$ gilt,
  existieren $w_1$ und $w_2$ für die gilt $q_{01} \overset{w_1}{\Rightarrow}
  q_1\in Qui_1$ und $q_{02} \overset{w_2}{\Rightarrow} q_2\in Qui_2$ mit $w\in
  w_1\| w_2$. Da für die Zustände $q_1$ und $q_2$ die Zugehörigkeit zur
  Quiescent Menge gilt, können wir folgern, dass der aus ihnen zusammengesetzte
  Zustand in der Parallelkomposition ebenfalls keine Outputs zulässt. Somit
  gilt also für die Komposition $(q_{01},q_{02}) \overset{w}{\Rightarrow}
  (q_1,q_2)\in Qui_{12}$ und dadurch ist $w$ in der linken Seite der Gleichung
  enthalten.

  3.:\\
  Der Beweis diese Punktes entspricht dem Beweis von Punkt 2.\ im Beweis von
  Satz~\ref{satzErrorSemanik}.
\end{proof}

$\QT{}_{12}$ ist hier in $\QL{}_{12}$ enthalten, da wie wir bereits oben festgestellt
haben $\QT{}_i\subseteq \QL{}_i$ für $i=1,2$ gilt. Somit gilt auch
$(\QT{}_1\|\QT{}_2)\subseteq (\QL{}_1\|\QL{}_2)$.

\begin{prop}[Präkongruenz]
  \QRel{} ist eine Präkongruenz.
\end{prop}

\begin{proof}
  Es muss gezeigt werden, wenn $S_1\QRel S_2$ gilt,  für   jedes $
  S_3$ auch $S_3\|S_1\QRel S_3\|S_2$ gilt. D.h.\ es ist zu zeigen,
  dass aus $\ET{}_1\subseteq \ET{}_2$, $\QT{}_1\subseteq \QT{}_2$ und $\QL{}_1\subseteq \QL{}_2$
  folgt, $\ET{}_{31}\subseteq \ET{}_{32}$, $\QT{}_{31}\subseteq \QT{}_{32}$ und
  $\QL{}_{31}\subseteq \QL{}_{32}$.
  \begin{itemize}
    \item $\begin{aligned}[t]
        \ET{}_{31} \overset{\mathrm{Beweis}~\ref{korPraekongruenz}
        ~\mathrm{Punkt}~1}{\subseteq} \ET{}_{32}
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QT{}_{31} &\overset{\ref{satzQuiSemantik}~2.}{=} (\QT{}_3\|\QT{}_1)\\
                &\hspace{-0.3cm}\overset{\QT{}_1\subseteq \QT{}_2}{\subseteq} (\QT{}_3\|\QT{}_2)\\
                &\overset{\ref{satzQuiSemantik}~2.}{=} \QT{}_{32}
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QL{}_{31} \overset{\mathrm{Beweis}~\ref{korPraekongruenz}
        ~\mathrm{Punkt}~2}{\subseteq} \QL{}_{32}
    \end{aligned}$
  \end{itemize}
\end{proof}

\begin{lem}[Verfeinerung mit Quiescents]
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  alle Partner \EIO{}s $U$, die mit $S_2$  gut kommunizieren, auch mit $S_1$
  gut kommunizieren, dann verfeinert $S_1$ den \EIO{} $S_2$. Diese Verfeinerung
  entspricht der Relation \QRel{} von oben: Wenn $U\|S_1\QBRel U\|S_2$ für alle
  Partner $U$, dann gilt $S_1\QRel S_2$.
\end{lem}

\begin{proof}
  Da wir davon ausgehen, dass $S_1$ und $S_2$ die gleiche Signatur haben,
  definieren wir $I:=I_1=I_2$ und $O:=O_1=O_2$. Für jeden Partner $U$ gilt
  $I_U=O$ und $O_U=I$.\\
  Um zu zeigen, dass die Relation $S_1\QRel S_2$ gilt, müssen wir die
  folgenden Punkte nachweisen:
  \begin{itemize}
    \item $\ET{}(S_1)\subseteq \ET{}(S_2)$,
    \item $\QT{}(S_1)\subseteq \QT{}(S_2)$,
    \item $\QL{}(S_1)\subseteq \QL{}(S_2)$.
  \end{itemize}
  Der erste und der letzte Punkt wurden bereits in Lemma~\ref{lemVerfeinerung}
  gezeigt. So bleibt uns nur noch die Inklusion $\QT{}_1\subseteq \QT{}_2$ zu zeigen.
\end{proof}
