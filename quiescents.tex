\chapter{Verfeinerung, Error- und Ruhe-Freiheit}

\section{Präkongruenz für Ruhe}

In diesem Kapitel wird es nicht mehr nur um die Erreichbarkeit von
Error-Zuständen gehen, sondern auch um die Erreichbarkeit von
Ruhe-Zuständen. Es wird dabei ein ähnlich vorgehen wie im letzten Kapitel
angewandt, jedoch wird~\cite{Chilton2013} als Quelle verwendet. Darin werden ähnliche
Konzepte beschrieben, jedoch aus Sicht der Traces. Es werden dort zudem
gleichzeitig auch noch Traces mit Divergenz betrachtet. Diese Eigenschaft der
Zustände wird hier zunächst nicht betrachtet.\\
Die Zustände, die keine Outputs und keine Transitionsmöglichkeit für
eine interne Aktion haben werden, als eine Art Verklemmung angesehen, da sie
ohne einen Input von einem Kommunikationspartner den Zustand nicht mehr
verlassen können.

\begin{Def}[Ruhe]
  Ein \emph{Ruhe-Zustand} ist ein Zustand in einem \EIO{}, der keine
  Outputs und kein $\tau$ zulässt.\\
  Somit ist die Menge der Ruhe-Zustände in einem \EIO{} wie folgt formal
  definiert: $Qui:=\big\{q\in Q\mid \forall \alpha\in (O\cup \{\tau\}): q
  \overset{\alpha}{\not{\hspace{-0.1cm}\rightarrow}}\big\}$.
\end{Def}

Für die Erreichbarkeit wird wie im letzten Kapitel wieder der
optimistischen Ansatz der lokalen Erreichbarkeit für die Error-Zustände
verwendet. Ruhe ist kein unabwendbaren Fehler, sondern kann durch einen Input
repariert werden. Somit ist ein Ruhe-Zustand als nicht so \glqq{}schlimmer
Fehler\grqq{} anzusehen wie ein Error. Somit ist ein Ruhe-Zustand ebenso wie
ein Error-Zustand erreichbar, sobald er durch Outputs und $\tau$s erreicht
werden kann, jedoch ist nicht jede beliebige Fortsetzung eines Traces, der die
Eigenschaft erfüllt ein Ruhe-Trace.

\begin{Def}[error- und ruhe-freie Kommunikation]
  Zwei \EIO{}s $S_1$ und $S_2$ \emph{kommunizieren error- und ruhe-frei}, wenn
  in ihrer Parallelkomposition $S_1\| S_2$ keine Errors und keine Ruhe-Zustände
  lokal erreichbar sind.
\end{Def}

\begin{Def}[Ruhe-Verfeinerungs-Basisrelation]
  Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird
  $S_1\QBRel S_2$ geschrieben, wenn ein Error oder Ruhe-Zustand in $S_1$ nur
  dann lokal erreichbar ist, wenn ein solcher auch in $S_2$ lokal erreichbar
  ist. Diese \emph{Basisrelation} stellt eine \emph{Verfeinerung} bezüglich
  \emph{Errors} und \emph{Ruhe-Zustände} dar.\\
  \QCRel{} bezeichnet die \emph{vollständig abstrakte Präkongruenz} von
  \QBRel{} bezüglich $\cdot\|\cdot$.
\end{Def}

Um eine genauer Auseinandersetzung mit den Präkongruenzen zu ermöglichen,
benötigt man wie im letzten Kapitel die Definition von Traces auf der Struktur.
Dadurch erhält man die Möglichkeit die gröbste Präkongruenz finden und
definieren zu können.\\
Wie bereits oben erwähnt, sind Ruhe-Zustände reparierbar im Gegensatz zu
Errors. Somit werden keine gekürzten Ruhetraces benötigt, bei der die
\prune{}-Funktion zur Anwendung käme, da auch keine beliebigen Verlängerungen
davon benötigt werden.

\begin{Def}[Ruhetraces]
  \label{DefRuhetraces}
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Ruhetraces}: $\StQT{}(S) := \{w\in\Sigma ^*\mid q_0
      \overset{w}{\Rightarrow} q\in Qui\}$.
  \end{itemize}
\end{Def}

Nur für die Ruhe wird eine neue Semantik definiert, die Error-Semantik wird aus
dem letzten Kapitel übernommen. Somit gelten für \ET{} und \EL{} die
Definitionen aus dem letzten Kapitel.

\begin{Def}[Ruhe-Semantik]
  \label{DefQTQL}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{error-gefluteten Ruhetraces} von $S$ ist
      $\QT{}(S) := \StQT{}(S)\cup \ET{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur wird
  $S_1\QRel S_2$ geschrieben, wenn $S_1\ERel S_2$ und $\QT{}(S_1)\subseteq \QT{}(S_2)$ gilt.
\end{Def}

Für die Menge der error-gefluteten Ruhetraces \QT{} wurde eine Informationsvermischung
mit den Errortraces vorgenommen wie beim Fluten der Sprache \EL{}. Da jedoch
durch die Ruhetraces keine neuen Traces entstehen, die nicht bereits in der
gefluteten Sprache \EL{} enthalten wären, würde eine neue Flutung nichts
ändern. Es wird also durch die Relation \QRel{} nur die
bereits existierende Präkongruenz \ERel{} eingeschränkt.\\
Das folgende Lemma soll explizit festhalten, wie Ruhezustände sich unter der
Parallelkomposition verhalten. Dies ist vor allem in dem danach folgenden Satz
relevant.

\begin{lem}[Ruhe-Zustände unter Parallelkomposition]
  \label{lemRuheParallelkomp}
  \begin{enumerate}
    \item Ein Zustand $(q_1,q_2)$ aus der Parallelkomposition $S_{12}=S_1\|S_2$
      ist ruhig, wenn es auch die Zustände $q_1$ und $q_2$ in $S_1$ bzw.\ $S_2$
      sind.
    \item Wenn der Zustand $(q_1,q_2)$ ruhig ist und nicht in $E_{12}$
      enthalten ist, dann sind auch die auf die Teilsysteme projizierten
      Zustände $q_1$ und $q_2$ ruhig.
  \end{enumerate}
\end{lem}

\begin{proof}
  ~
  \begin{enumerate}
    \item \hspace{-0.2cm}:
  \end{enumerate}
  \vspace{-0.3cm}
  Da $q_1\in Qui_1$ und $q_2\in Qui_2$ gilt, haben
  diese beiden Zustände jeweils höchstens die Möglichkeiten Transitionen
  auszuführen, die mit Inputs beschriftet sind. Jedoch keine Möglichkeiten für
  Outputs oder $\tau$s. Der Zustand, der durch Parallelkomposition aus diesen
  beiden Zuständen entsteht hat die Transitionsmöglichkeiten dieser Zustände
  die parallel ausgeführt werden. Es gibt somit drei unterschiedliche
  Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($a\in I_i\backslash Synch(S_1,S_2)\wedge q_i
      \overset{a}{\rightarrow}$ für ein $i\in \{1,2\}$): Da $a$ ein
      unsynchronisierter Input ist, wird dieser unabhängig ausgeführt, somit hat
      $(q_1,q_2)$ ebenfalls die Möglichkeit eine Transition mit $a$ als Input
      auszuführen.
    \item Fall 2 ($a\in I_1\cap I_2\wedge q_i \overset{a}{\rightarrow}$ für
      beide $i\in \{1,2\}$): Da beide Zustände den gleichen Input ausführen
      können, der zu synchronisieren ist, gilt somit $(q_1,q_2)
      \overset{a}{\rightarrow}$. Wobei $a\in I_{12}$ gilt.
    \item Fall 3 ($a\in I_i\cap Synch(S_1,S_2)\wedge q_i
      \overset{a}{\rightarrow}$ für ein $i\in \{1,2\}$): Hier handelt es sich
      um eine Transition, die für $(q_1,q_2)$ nicht ausführbar ist, da es keine
      passende Transition für das andere System gibt, mit dem diese Aktion
      synchronisiert werden könnte. Da es sich hier jedoch um den Input der zu
      synchronisierenden Aktion handelt, entsteht daraus auch kein
      neu Fehler, sondern einfach nur eine Transition, die nicht
      genommen werden kann, weil der passende Output nicht vorhanden ist.
  \end{itemize}
  Dies sind alle Fälle, die auftreten können für die Parallelkomposition der
  Transitionsmöglichkeiten. Bei keinen dieser Möglichkeiten ist ein Output oder
  ein $\tau$ entstanden und somit hat der Zustand $(q_1,q_2)$ auch keine
  Möglichkeiten solche Transitionen auszuführen. Daraus folgt also, dass
  $(q_1,q_2)\in Qui_{12}$ gilt.

  2.:\\
  Es gilt $(q_1,q_2)\in Qui_{12}\backslash E_{12}$, somit hat
  dieser Zustand maximal die Möglichkeit Transitionen für Inputs auszuführen.
  Diese Transitionen für Inputs können nur aus Inputs, die nicht in der Menge
  der synchronisierten Handlungen enthalten sind oder aus der Synchronisation
  von zwei Inputs aus der Menge $I_1\cup I_2$ enstehen. Durch die
  Parallelkomposition von Outputs mit anderen Aktionen können keine Inputs
  entstehen und in der Definition der Parallelkomposition auch keine
  $\tau$s. Outputs, die nicht in der Menge $Synch(S_1,S_2)$ enthalten sind,
  würden als Outputs des zusammengesetzten Zustandes übernommen werden und
  können somit weder bei $q_1$ noch bei $q_2$ vorhanden sein. Falls jedoch
  $(q_1,q_2)\in E_{12}$ zulassen wäre, wäre es möglich, dass einer der beiden
  Zustände $q_i$ eine Transitionsmöglichkeit für einen Output hat, der aufgrund
  eines fehlenden Inputs des anderen Zustandes nicht synchronisiert werden kann
  und somit ein neuer Error entsteht. Dieser Fall wird jedoch durch die
  zusätzliche Einschränkung ausgeschlossen. Falls einer der beiden Zustände
  eine Transitionsmöglichkeit für ein $\tau$ gehabt hätte, müsste dies auch der
  zusammengesetzte Zustand haben und könnte somit nach Definition
  nicht ruhig sein. Es folgt also, dass $q_1$ und $q_2$ ebenso nur
  Transitionen mit Inputs ausführen können. Es gilt also $q_1\in Qui_1$ und
  $q_2\in Qui_2$.
\end{proof}

In dem folgenden Satz sind Punkt 1.\ und 3.\ nur zur Vollständigkeit aufgeführt.
Sie entsprechen Punkt 1.\ und 2.\ aus Satz~\ref{satzErrorSemanik}.

\begin{satz}[Error- und Ruhe-Semantik für Parallelkompositonen]
  \label{satzQuiSemantik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition $S_{12} =
  S_1\|S_2$ gilt:
  \begin{enumerate}
    \item $\ET{}_{12} = \cont{}(\prune{}((\ET{}_1\|\EL{}_2)\cup (\EL{}_1\|\ET{}_2)))$,
    \item $\QT{}_{12} = (\QT{}_1\|\QT{}_2)\cup \ET{}_{12}$,
    \item $\EL{}_{12} = (\EL{}_1\|\EL{}_2)\cup \ET{}_{12}$.
  \end{enumerate}
\end{satz}

\begin{proof}
  Wir beweisen nur den 2. Punkt.

  \glqq $\subseteq$\grqq :\\
  Hier muss unterscheiden werden ob ein $w\in\StQT{}_{12}\backslash
  \ET{}_{12}$ oder ein $w\in \ET{}_{12}$ betrachtet wird. Im zweiten Fall ist das
  $w$ in der rechten Seite enthalten. Somit wird ab jetzt ein $w\in
  \StQT{}_{12}\backslash \ET{}_{12}$ betrachtet und dessen Zugehörigkeit zur
  rechten Menge versucht zu zeigen. Aufgrund von Definition~\ref{DefRuhetraces}
  weiß man, dass $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)$ gilt mit
  $(q_1,q_2)\in Qui_{12}$. Durch Projektion erhält man $q_{01}
  \overset{w_1}{\Rightarrow} q_1$ und $q_{02} \overset{w_2}{\Rightarrow} q_2$
  mit $w\in w_1\|w_2$. Aus $(q_1,q_2)\in Qui_{12}$ kann mit Punkt 2.\ von
  Lemma~\ref{lemRuheParallelkomp} folgert werden, dass bereits $q_1\in Qui_1$ und
  $q_2\in Qui_2$ gilt. Somit gilt $w_1\in \StQT{}_1\subseteq \QT{}_1$ und
  $w_2\in \StQT{}_2\subseteq \QT{}_2$. Daraus folgt dann $w\in
  \QT{}_1\|\QT{}_2$ und somit ist $w$ in der rechten Seiten der Gleichung
  enthalten.

  \glqq $\supseteq$\grqq :\\
  Es muss wieder danach unterschieden werden aus welcher Menge das betrachtete
  Element stammt. Falls $w\in \ET{}_{12}$ gilt, so kann die
  Zugehörigkeit zur linken Seite direkt folgert werden. Wird für den
  weiteren Beweis dieser Inklusionsrichtung ein Element $w\in
  \QT{}_1\|\QT{}_2$ betrachtet und gezeigt, dass es in der linken Menge enthalten ist. Da
  $\QT{}_i = \StQT{}_i\cup \ET{}_i$ gilt, existieren für $w_1$ und $w_2$ mit
  $w\in w_1\| w_2$ unterschiedliche Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in \ET{}_1\vee w_2\in \ET{}_2$): \OBdA{} gilt
      $w_1\in \ET{}_1$. Nun kann $w_2\in \StQT{}_2\subseteq L_2$ gelten
      oder $w_2\in \ET{}_2$ und somit gilt auf jeden Fall $w_2\in
      \EL{}_2$. Daraus kann dann mit dem ersten Punkt von
      Satz~\ref{satzErrorSemanik} bzw.\ aus dem ersten Punkt dieses Satzes
      gefolgert werden, dass $w\in \ET{}_{12}$ gilt und somit in der linken Seite der
      Gleichung enthalten ist.
    \item Fall 1 ($w_1\in \StQT{}_1\wedge w_2\in \StQT{}_2$): Es gilt in
      diesem Fall $q_{01} \overset{w_1}{\Rightarrow} q_1\in Qui_1$ und $q_{02}
      \overset{w_2}{\Rightarrow} q_2\in Qui_2$. Da $q_1$ und $q_2$ in der
      Ruhe-Menge enthalten sind, ist auch der Zustand, der aus ihnen
      zusammengesetzt ist, in der Parallelkomposition ruhig und lässt keine
      $\tau$-Transitionen zu, wie bereits in Punkt 1.\ von
      Lemma~\ref{lemRuheParallelkomp} gezeigt. Es gilt also für die Komposition
      $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)\in Qui_{12}$ und
      dadurch ist $w$ in der linken Seite der Gleichung enthalten, da $w\in
      \StQT{}_{12}\subseteq \QT{}_{12}$ gilt.
  \end{itemize}
\end{proof}

Die folgende Proposition ist eine direkte Folgerung aus dem letzten Satz.
Jedoch ist es eine wichtige Feststellung für die weiteren Verlauf die gröbste
Präkongruenz finden zu wollen.

\begin{prop}[Präkongruenz]
  \label{propQuiPrae}
  \QRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{prop}

\begin{proof}
  Es muss gezeigt werden: Wenn $S_1\QRel S_2$ gilt, so auch
  $S_3\|S_1\QRel S_3\|S_2$ für jedes $S_3$. D.h.\ es ist zu zeigen, dass aus
  $S_1\ERel S_2$ und $\QT{}_1\subseteq \QT{}_2$ folgt, dass $S_{31}\ERel
  S_{32}$ und $\QT{}_{31}\subseteq \QT{}_{32}$. Dies ergibt sich wie im Beweis
  zu Proposition~\ref{propPraekongruenz} aus der Monotonie von $\cdot\|\cdot$
  auf Sprachen wie folgt:
  \begin{itemize}
    \item $\begin{aligned}[t]
        S_{31} \overset{\mathrm{Proposition}~
        \ref{propPraekongruenz}}{\overset{\mathrm{und}}{\overset{S_1\ERel
    S_2}{\ERel}}} S_{32}
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QT{}_{31} &\overset{\ref{satzQuiSemantik}~2.}{=}
        (\QT{}_3\|\QT{}_1)\cup \ET{}_{31}\\
        &\hspace{-0.5cm}\overset{\ET{}_{31}\subseteq
      \ET{}_{32}}{\overset{\mathrm{und}}{\overset{\QT{}_1\subseteq
      \QT{}_2}{\subseteq}}} (\QT{}_3\|\QT{}_2) \cup \ET{}_{32}\\
        &\overset{\ref{satzQuiSemantik}~2.}{=} \QT{}_{32}
    \end{aligned}$
  \end{itemize}
\end{proof}

\begin{lem}[Verfeinerung mit Ruhe-Zuständen]
  \label{lemQuiVerfeinerung}
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  alle Partner \EIO{}s $U$, die mit $S_2$  gut kommunizieren, auch mit $S_1$
  gut kommunizieren, dann verfeinert $S_1$ das \EIO{} $S_2$. Diese Verfeinerung
  entspricht der Relation \QRel{} von oben: Wenn $U\|S_1\QBRel U\|S_2$ für alle
  Partner $U$, dann gilt $S_1\QRel S_2$. %TODO nachdenken, wieso 3.7 nicht
  %anwendbar bzw. andere Voraussetzungen
  %TODO gut kommunizieren anders formulieren
\end{lem}

\begin{proof}
  %TODO Beweis abändern, da durch \QBRel nur festgehalten wird, dass eine Art
  %von Fehler erreichbar ist, aber nicht welche Art
  Da davon ausgehen wird, dass $S_1$ und $S_2$ die gleiche Signatur haben,
  definiert man $I:=I_1=I_2$ und $O:=O_1=O_2$. Für jeden Partner $U$ gilt
  $I_U=O$ und $O_U=I$.\\
  Um zu zeigen, dass die Relation $S_1\QRel S_2$ gilt, müssen die
  folgenden Punkte nachweisen werden:
  \begin{itemize}
    \item $S_1\ERel S_2$,
    \item $\QT{}(S_1)\subseteq \QT{}(S_2)$.
  \end{itemize}
  Der erste Punkt wurde bereits in Lemma~\ref{lemVerfeinerung}
  gezeigt. So bleibt nur noch die Inklusion $\QT{}_1\subseteq \QT{}_2$ zu
  zeigen. Diese Inklusion kann jedoch noch anlog zum Beweis der Inklusion
  der gefluteten Sprachen in Lemma~\ref{lemVerfeinerung} weiter einschränken.
  Da bereits bekannt ist, dass $\ET{}_1\subseteq\ET{}_2$ gilt, muss nur
  noch $\StQT{}_1\subseteq \QT{}_2$ gezeigt werden.\\
  Es wird ein $w\in \StQT{}(S_1)$ gewählt und gezeigt, dass es auch in $\QT{}(S_2)$
  enthalten ist.\\
  Es ist vom Startzustand von $S_1$ durch das Wort $w$ ein ruhiger Zustand
  erreichbar. Dies hat keine Auswirkungen auf die Parallelkomposition $U\|S_1$,
  wenn in $U$ kein Ruhe-Zustand durch $w$ erreicht wird. Somit wird
  den Partner $U$ betrachtet bei dem durch $w$ ebenfalls ein Ruhe-Zustand erreicht wird.
  Daraus folgt dann, dass in $U\|S_1$ ein Ruhe-Zustand mit $w$ erreicht wird
  und durch die gegebene Relation folgt dann auch, dass in $U\|S_2$ auch ein
  Ruhe-Zustand durch $w$ erreicht werden muss. Dies kann nur der Fall sein,
  wenn in $S_2$ bereits ein Ruhe-Zustand durch $w$ erreicht wird. Somit gilt
  also $w\in \StQT{}_2$.
\end{proof}

Mit dem folgenden Satz wird festgehalten, dass mit \QRel{} die gröbste
Präkongruenz gefunden wurde bezüglich $\cdot\|\cdot$ die in \QBRel{} enthalten
ist.

\begin{satz}[Full Abstractness für Ruhe-Semantik]
  \label{satzQuiFullAbst}
  Seien $S_1$ und $S_2$ zwei \EIO{}s mit derselben Signatur. Dann gilt
  $S_1\QCRel S_2\Leftrightarrow S_1\QRel S_2$, insbesondere ist \QRel{} eine
  Präkongruenz.
\end{satz}

\begin{proof}
  Wie bereits in Proposition~\ref{propQuiPrae} festgehalten, ist \QRel{} eine
  Präkongruenz.

  \glqq{}$\Leftarrow$\grqq{}: Nach Definition gilt, wenn
  $\varepsilon\in\QT{}(S)$, ist in $S$ ein Ruhe-Zustand durch interne Aktionen
  oder ein Error-Zustand lokal erreichbar. Somit impliziert $S_1\QRel S_2$,
  dass $\varepsilon\in\QT{}_2$ gilt, wenn $\varepsilon\in\QT{}_1$. Daraus folgt
  ebenfalls, dass $S_1\QBRel S_2$ gilt. Somit folgt aus $S_1\QRel S_2$ der
  relationale Zusammenhang $S_1\QCRel S_2$.

  \glqq{}$\Rightarrow$\grqq{}: Durch die Definition von \QCRel{} folgt aus
  $S_1\QCRel{} S_2$, dass $U\|S_1\QCRel U\|S_2$ für alle EIOs $U$ , die mit
  $S_1$ komponierbar sind. Somit folgt auch die Gültigkeit von $U\|S_1\EBRel
  U\|S_2$ für alle diese EIOs $U$. Mit Lemma~\ref{lemQuiVerfeinerung} folgt
  dann $S_1\QRel{} S_2$.
\end{proof}

Es wurde somit, wie im letzten Kapitel, eine Kette an Folgerungen gezeigt, die
sich zu einem Ring schließen. Dies ist in Abbildung~\ref{FolgerungsketteQui}
dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{
        S_1\QRel S_2 & S_1\QCRel S_2 \\
        \substack{\forall~\mathrm{Partner}~U:\\U\|S_1\QBRel U\|S_2} &
      \substack{\forall~\mathrm{komponierbaren}~U:\\U\|S_1\QBRel U\|S_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{satzQuiFullAbst}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {\glqq{}$\Rightarrow$\grqq{} von
            Satz~\ref{satzQuiFullAbst}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{lemQuiVerfeinerung}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
        (m-2-2) -- node [below]
        {$\substack{U~\mathrm{Partner}\\\Downarrow\\U~\mathrm{komponierbar}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette}
    \label{FolgerungsketteQui}
  \end{center}
\end{figure}

Aus Satz~\ref{satzQuiFullAbst} und Lemma~\ref{lemQuiVerfeinerung} erhält man
das folgende Korollar:

\begin{kor}
  Ein \EIO{} $S_1$ verfeinert einen \EIO{} $S_2$ genau dann, wenn für alle
  \EIO{}s $U$ für die $S_2$ gut mit $U$ kommuniziert folgt $S_1$ kommuniziert
  ebenfalls gut mit $U$.\\
  Dies lässt sich formal wie folgt ausdrücken: $S_1\QRel S_2\Leftrightarrow
  U\|S_1\QBRel U\|S_2$ für alle Partner $U$.
\end{kor}

\section{Hiding und Ruhe-Freiheit}

Es soll nun auch hier die Auswirkungen der Internalisierung von Aktionen auf
die Verfeinerungsrelationen untersucht werden. Es werden Outputs in interne
Aktionen umgewandelt. Da jedoch bei den Ruhe-Zuständen auch
$\tau$-Transitionen verboten wurden, verändert sich nichts an der Menge der ruhigen
Zustände. Da die Erreichbarkeit von Ruhe-Zuständen mittels interner Aktionen
betrachtet wurde, können durch das verbergen von Outputs neue erreichbare
Ruhe-Zustände hinzu kommen. Somit ist es nicht möglich hier eine analoge
Proposition zu~\ref{propErBaIn} zu formulieren. Es kann zwar daraus
geschlossen werden, dass alle Ruhe-Zustände, die vor dem Hiding zu erreichen waren mit
$\tau$s auch danach noch erreichbar sind, jedoch können durch die
Internalisierung neue erreicht werden, die möglicherweise in dem anderen
Transitionssystem nicht erreicht werden können. Da jedoch für die
Präkongruenz \QRel{} noch Wissen über die Teilmengenbeziehung der Traces
existiert, kann einen Satz analog zu~\ref{satzPraeInternalisierung} formulieren.

\begin{satz}[Präkongurenz bzgl. Internalisierung]
  \label{satzPraeInterQui}
  Seien $S_1$ und $S_2$ zwei \EIO{}s für die $S_1\QRel S_2$ gilt, somit gilt
  auch $(S_1/\{x_1,x_x,\dots ,x_n\})\QRel (S_2/\{x_1,x_x,\dots ,x_n\})$. Es
  ist also \QRel{} eine Präkongruenz bezüglich $\cdot /\cdot$.
\end{satz}

\begin{proof}
  Da $S_1\QRel S_2$ gilt, kann geschlossen werden, dass $S_1\ERel S_2$ und $\QT{}_1\subseteq
  \QT{}_2$ gilt. Aufgrund von
  Satz~\ref{satzPraeInternalisierung} ist bekannt, dass daraus $(S_1/\{x_1,x_x,\dots
  ,x_n\})\ERel (S_2/\{x_1,x_x,\dots ,x_n\})$ folgt. Ebenso wie im Beweis zu
  Satz~\ref{satzPraeInternalisierung} kann hier davon ausgehen werden, dass
  $X\subseteq O$ gilt. Für jeden Trace aus $\QT{}_1$ kann ein passender
  in $\QT{}(S_1/X)$ gefunden werden und ebenso für das Transitionssystem $S_2$. Die
  Argumentation läuft hierfür analog zum Beweis von
  Satz~\ref{satzPraeInternalisierung}. Es ist hier auch kein Problem, dass
  neue Zustände hinzu kommen, von denen aus durch $\tau$s Ruhe-Zustände
  erreichbar sind, da diese $\tau$s aus Outputs entstanden sind, die verborgen
  wurden. Es war also bereits ein Trace in $\QT{}_i$ vorhanden, der nur aus
  Outputs aus $X$ bestanden hat und der dann durch das Hiding zu einem $\tau$
  wurde, was aber das passende Trace ist, den man zu dem ursprünglichen in
  $\QT{}(S_i/X)$ findet. Somit gilt
  also auch $\QT{}(S_1/X)\subseteq \QT{}(S_2/X)$. Daraus folgt dann, dass die
  Relation \QRel{} trotz Hiding erhalten bleibt und somit das Hiding bezüglich
  dieser Relation eine Präkongruenz ist.
\end{proof}

In Definition~\ref{defIntParal} wurde mit Hilfe des Internalisierungsoperator
aus der Parallelkomposition ohne Verbergen die Parallelkomposition mit
Verbergen der synchronisierten Aktionen nachgebildet. Es kann deren
Eigenschaft als Präkongruenz aus den Präkongruenz-Eigenschaften von
$\cdot\|\cdot$ und $\cdot /\cdot$ bezüglich \QRel{} aus der
Proposition~\ref{propQuiPrae} und dem Satz~\ref{satzPraeInterQui} geschlossen
werden.

\begin{kor}[Präkongruenz mit Internalisierung]
  \QRel{} ist eine Präkongruenz bezüglich $\cdot |\cdot$.
\end{kor}

\section{Diskussion für Veränderungen an Semantik oder anderen Definitionen}

%TODO Divergenz definieren

Es währe hier auch denkbar, dass man auch für die Ruhe-Zustände einen lokalen
Erreichbarkeitsbegriff verwendet. Es könnte dadurch sogar möglich sein eine
noch gröbere Präkongruenz zu erhalten. Dies wurde hier jedoch nicht gemacht, da
es bei den denkbaren Umsetzung eines solchen Erreichbarkeitsbegriffes zu
Problemen kommt, so dass nicht mehr alle Inklusionen erreichen können, die in
deb Sätzen gefordert wurden.\\
Die Umsetzung des lokalen Erreichbarkeitsbegriffes wie im letzten Kapitel, mit
abschneiden der Outputs und beliebigem Fortsetzten der Traces, würde zu einem
Problem in Satz~\ref{satzQuiSemantik} in Punkt 2.\ führen, dass analog zu dem
Problem währe in der Semantik, die als nächstes beschrieben wird. Zusätzlich könnte
man nicht die \EL{} als geflutete Sprache beibehalten sondern müsste noch
zusätzlich mit den Ruhetraces fluten, da sonst nicht mehr alle
Informationen, die in Ruhetraces enthalten auch in der gefluteten Sprache
enthalten wäre. Durch diese Abänderung käme es zusätzlich noch zu einem Problem
in Punkt 3.\ bei Satz~\ref{satzQuiSemantik}. Durch die Anwendung der Definition
der gefluteten Sprachen würden Terme entstehen, in denen Ruhetraces und Traces
aus der Sprache $L$ in Parallelkomposition gesetzt würden. Da die Ruhetraces
nicht mehr Teil der Sprache sind, kann nicht mehr gelten, dass die Teil von
$L_1\|L_2$ ist. Es kann auch nicht Teil der Ruhetraces sein, da Ruhetraces nur
aus Kombination von zwei Ruhetraces entstehen können oder in dem sie
Errortraces sind, was beides hier nicht der Fall ist.\\
Man muss jedoch nicht an dieser Umsetzung für die lokale Erreichbarkeit
festhalten. Man könnte sich auch eine Umsetzung denken, in dem man die
Ruhetraces zwar um die Outputs kürzt, jedoch dann nur Fortsetzungen zulässt,
die bereits im Transitionssystem möglich sind. Somit benötigt man keine weitere
Flutung der gefluteten Sprache \EL{}, da weiterhin alle Ruhetraces in der
Sprache $L$ enthalten sind. Jedoch stoßt man hier wieder bei Punkt 2.\ von
Satz~\ref{satzQuiSemantik} an Probleme. Hierzu muss davon ausgegangen werden,
dass eine neue \prune{}-Funktion definiert wurde bzw.\ eine neue
\cont{}-Funktion, wie z.B. $\prunenew{}: \Sigma ^*\rightarrow
\mathfrak{P}(\Sigma ^*), w\mapsto \{u\mid \exists v\in O^*:w=uv\}$. Somit würde
sich die Definition der Ruhetraces entsprechend abändern. So das statt
\StQT{} ein entsprechendes \PrQT{} enthalten wäre, dass durch die Anwendung
der \prunenew{}-Funktion entstanden wäre. Somit wäre Punkte 2.\ von
Satz~\ref{satzQuiSemantik} entsprechend auch leicht abgewandelt und müsste
$\QT{}_{12}=\prunenew (\QT{}_1\|\QT{}_2)\cup \ET{}_{12}$ lauten. Das Problem
würde nun auftauchen wenn man die Inklusionsrichtung $\supseteq$ zu beweisen
versucht. Hierzu gibt es jedoch folgendes Gegenbeispiel, dass die Behauptung
gar nicht stimmen kann.\\
Für $S_1$ wird das folgende Transitionssystem verwendet (siehe dazu auch
Abbildung~\ref{S1}):
\begin{itemize}
  \item $Q_1=\{q_{01}, q_{11}\}$
  \item $I_1=\emptyset$
  \item $O_1=\{a\}$
  \item $\delta _1 = \{(q_{01},a,q_{11})\}$
  \item $E_1=\emptyset$
  \item $Qui_1=\{q_{11}\}$
\end{itemize}
\begin{figure} [h!tbp]
\begin{center}
  \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

    \node (0) {$q_{01}$};
    \node (1) [right of=0, rectangle, draw] {$q_{11}\in Qui_1$};

    \path (0) edge node {$a!$} (1);
  \end{tikzpicture}
  \caption{$S_1$}
  \label{S1}
\end{center}
\end{figure}
Für $S_2$ wird das folgende Transitionssystem verwendet (siehe dazu auch
Abbildung~\ref{S2}):
\begin{itemize}
  \item $Q_2=\{q_{02}, q_{12}, q_{22}\}$
  \item $I_2=\{a\}$
  \item $O_2=\{b\}$
  \item $\delta _2 = \{(q_{02},a,q_{22}), (q_{02},b,q_{12}), (q_{12},a,q_{22}),
    (q_{22},b,q_{22})\}$
  \item $E_2=\emptyset$
  \item $Qui_2=\{q_{12}\}$
\end{itemize}
\begin{figure} [h!tbp]
\begin{center}
  \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

    \node (0) {$q_{02}$};
    \node (1) [right of=0, rectangle, draw] {$q_{12}\in Qui_2$};
    \node (2) at ($(0)!0.5!(1) + (0,-2)$){$q_{22}$};

    \path (0) edge node {$b!$} (1)
              edge [below left] node {$a?$} (2)
          (1) edge node {$a?$} (2)
          (2) edge [loop below] node {$b!$} (2);
  \end{tikzpicture}
  \caption{$S_2$}
  \label{S2}
\end{center}
\end{figure}
Somit ergibt sich für die Parallelkomposition $S_{12} = S_1\| S_2$ das folgende
Transitionssystem, bei dem bereits unerreichbare Zustände weggelassen sind
(siehe dazu auch Abbildung~\ref{S12}):
\begin{itemize}
  \item $Q_{12}=\{(q_{01},q_{02}), (q_{01},q_{12}), (q_{11},q_{22})\}$
  \item $I_{12}=\emptyset$
  \item $O_{12}=\{a,b\}$
  \item $\begin{aligned}[t]
      \delta _{12} = \{&((q_{01},q_{02)},a,(q_{11},q_{22})),
      ((q_{01},q_{12}),a,(q_{11},q_{22})),
    ((q_{01},q_{02}),b,(q_{01},q_{12})),\\
  &((q_{11},q_{22}),b,(q_{11},q_{22}))\}
        \end{aligned}$
  \item $E_{12}=\emptyset$
  \item $Qui_{12}=\emptyset$
\end{itemize}
\begin{figure} [h!tbp]
\begin{center}
  \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

    \node (0) {$(q_{01},q_{02})$};
    \node (1) [right of=0] {$(q_{01},q_{12})$};
    \node (2) at ($(0)!0.5!(1) + (0,-2)$){$(q_{11},q_{22})$};

    \path (0) edge node {$b!$} (1)
              edge [below left] node {$a!$} (2)
          (1) edge node {$a!$} (2)
          (2) edge [loop below] node {$b!$} (2);
  \end{tikzpicture}
  \caption{$S_{12}$}
  \label{S12}
\end{center}
\end{figure}

Es wäre möglich gewesen, die Menge der Ruhe-Zustände bereits anders zu
definieren. Dadurch, dass die $\tau$-Transitionen verboten wurden, ist man
einer Fallunterscheidung entgangen. Da jedoch Quiescents als Deadlock-Zustände
anzusehen sind, aus denen das System ohne Hilfe nicht mehr heraus kommt,
müsste hier eigentlich darauf achten, wohin die $\tau$-Transitionen führen
und dann möglicherweise die Zustände trotz dieser Transitionen in Menge
aufnehmen. Ein Zustand, der keine Outputs machen kann und als einzige
$\tau$-Transition eine Schlinge auf sich selbst hat, kann ebenfalls nicht ohne
Inputs sich aus diesem Zustand heraus bewegen. Dieser Zustand wird jedoch nach
der Definition nicht als ruhig angesehen. Jedoch ist so ein Zustand
divergent, da er eine unendliche Folge an internen Aktionen ausführen kann.
Dies wurde in~\cite{Chilton2013} mit untersucht. Auch bei anderen
Divergenz-Möglichkeiten eines Zustandes, bei denen nicht die Möglichkeit
besteht von einem durch $\tau$ erreichbaren Zustand aus einen Output zu machen,
sollte der Zustand als ruhig angesehen werden. Die passende Definition würde
dann wie folgt lauten.

\begin{Def}[Ruhe Alternative]
  Ein Ruhe-Zustand ist ein Zustand in einem \EIO{}, der keine Möglichkeit hat
  ohne einen Input von außen je wieder einen Output zu machen.\\
  Somit ist die Menge der Ruhe-Zustände in einem \EIO{} wie folgt formal
  definiert: $Qui:=\left\{q\in Q\mid \forall a\in O: q
  \overset{a}{\not{\hspace{-0.1cm}\Rightarrow}}\right\}$.
\end{Def}

Diese Art der Definition hätte jedoch die Betrachtung deutlich aufwendiger
gemacht und soll deshalb hier nicht behandelt werden.
