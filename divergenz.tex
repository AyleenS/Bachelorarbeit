\chapter{Verfeinerung für Error-, Ruhe- und Divergenz-Freiheit}

\section{Präkongruenz für Divergenz}

In diesem Kapitel soll die Menge der betrachteten Zustände noch einmal
erweitert werden. Somit werden dann Errors, Ruhe-Zustände und
Divergente-Zustände betrachtet. Somit eignet sich~\cite{Chilton2013} hier als
Quelle, da nun auch noch die Divergenz betrachtet wird. Diese wurde dort
gleichzeitig mit der Ruhe eingeführt und betrachtet. Da es sich nur um eine
Erweiterung der Präkongruenzen aus den letzten beiden Kapiteln handelt, wird
dabei ähnlich vorgegangen wie in den letzten beiden Kapiteln.\\
Wie bereits oben und im letzten Kapitel erwähnt wurden in~\cite{Chilton2013}
auch noch divergente Zustände als Fehler-Zustände betrachtet. Um zu klären, was
darunter verstanden wird, wird nun noch eine Definition für Divergenz gegeben.

\begin{Def}[Divergenz]
  Ein \emph{Divergenz-Zustand} ist ein Zustand in einem \EIO{}, der eine
  unendliche Folge an $\tau$s ausführen kann.%\\
  % Somit ist die Menge der Divergenz-Zustände in einem \EIO{} wie folgt formal
  % definiert: $Div := \{q\in Q\mid \forall i\in \mathbb{N}\; \exists q_i\in Q: q
  % \overset{\tau}{\Rightarrow} q_i~\mathrm{und}~\forall j\in N\backslash \{i\}:
  % q_i\neq q_j\}$.
\end{Def}

Als Erreichbarkeitsbegriff wird wieder die lokale Erreichbarkeit verwendet.
Da das Divergieren eines Systems nicht mehr verhindert werden kann, sobald ein
divergenter Zustand lokal erreichbar ist, ist Divergenz als ähnlich
\glqq{}schlimm\grqq{} zu bewerten wie ein Error.

\begin{Def}[error-, ruhe- und divergenz-freie Kommunikation]
  Zwei \EIO{}s $S_1$ und $S_2$ kommunizieren \emph{error-, ruhe- und
  divergenz-frei}, wenn in ihre Parallelkomposition $S_{12}$ keine Errors,
  Ruhe-Zustände und Divergenz-Zustände lokal erreichbar sind.
\end{Def}

\begin{Def}[Divergenz-Verfeinerungs-Basisrelation]
Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird $S_1\DBRel S_2$
geschrieben, wenn ein Error, Ruhe-Zustand oder Divergenz-Zustand in $S_1$ nur
dann lokal erreichbar ist, wenn er auch in $S_2$ lokal erreichbar ist. Diese
\emph{Basisrelation} stellt eine \emph{Verfeinerung} bezüglich \emph{Errors},
\emph{Ruhe-Zuständen} und \emph{Divergenz-Zuständen} dar.\\
\DCRel{} bezeichnet die \emph{vollständige abstrakte Präkongruenz} von \DBRel{}
bezüglich $\cdot\|\cdot$.
\end{Def}

Da nun die grundlegenden Definitionen für Divergenz festgehalten sind,
kann man sich nun einen Begriff für die Traces von divergenten Zuständen
bilden.\\

\begin{Def}[Divergenztraces]
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item \emph{strickte Divergenztraces}: $\StDT{}(S) := \{w\in\Sigma ^*\mid
      q_0 \overset{w}{\Rightarrow} q\in Div\}$,
  \end{itemize}
\end{Def}

Da in~\cite{Chilton2013} bereits direkt Divergenz mit betrachtet wurde, wird
dort die Flutung der Traces so vorgenommen, dass $\ET\subseteq \DT\subseteq
\QT$ gilt. Dies soll auch hier in diesem Kapitel erreicht werden. Somit kann
zwar die Semantik aus dem Error-Kapitel übernehmen werden, jedoch wird für die
Ruhe eine andere Semantik benötigt, die sich von der im letzten Kapitel
unterscheidet. Die Inklusionskette der Fehlertraces scheint auch von der
Hierarchie her auf die Bewertung zu passen, als wie kritisch die einzelnen
Fehler zu bewerten sind.

\begin{Def}[Ruhe- und Divergenz-Semantik]
\label{DefRuheDivSemantik}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{error-gefluteten Divergenztraces} von $S$ ist
      $\DT{}(S) := \StDT{}(S)\cup \ET{}(S)$.
    \item Die Menge der \emph{divergenz-gefluteten Ruhetraces} von $S$ ist
      $\QT{}(S) := \StQT{}(S)\cup \DT{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur schreibt man $S_1\DRel
  S_2$, wenn $S_1\ERel S_2$, $\DT{}_1\sqsubseteq \DT{}_2$ und
  $\QT{}_1\sqsubseteq \QT{}_2$ gilt.
\end{Def}

In der letzten Definition wurde wieder durch das Fluten eine
Informationsvermischung vorgenommen. Im Fall von \DT{} mit den Errortraces und
im Fall von \QT{} mit den Divergenztraces. Jedoch entstehen hier wie im letzten
Kapitel keine neuen Traces, die nicht bereits in der error-gefluteten Sprache
\EL{} aus den Error-Kapitel enthalten wären. Somit kann diese Sprache ohne
weitere Flutung verwendet werden. Somit ist die Relation \DRel{} ebenso wie
\QRel{} eine Einschränkung der Relation \ERel{}.\\
Ebenso wie in Satz~\ref{satzQuiSemantik} wird im nächsten Satz nur der
Vollständigkeit halber der erste und letzte Punkt erwähnt der Beweis dazu
findet sich in Satz~\ref{satzErrorSemanik}.

\begin{satz}[Error-, Ruhe- und Divergenz-Semantik für Parallelkompostionen]
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition
  $S_{12}$ gilt:
  \begin{enumerate}
    \item $\ET{}_{12}=\cont (\prune ((\ET{}_1\|\EL{}_2)\cup
      (\EL{}_1\|\ET{}_2)))$,
    \item $\DT{}_{12}= (\DT{}_1\|\EL{}_2)\cup (\EL{}_1\|\DT{}_2)\cup
      \ET{}_{12}$,
    \item $\QT{}_{12}=(\QT{}_1\|\QT{}_2)\cup \DT{}_{12}$,
    \item $\EL{}_{12}=(\EL{}_1\|\EL{}_2)\cup \ET{}_{12}$.
  \end{enumerate}
\end{satz}

\begin{proof} Es wird hier nur der 2.\ und 3.\ Punkt bewiesen.

  2. \glqq{}$\subseteq$\grqq{}:\\
  Es muss hier unterschieden, ob $w\in \StDT{}_{12}$ oder $w\in \ET{}_{12}$
  betrachtet wird. Im zweiten Fall ist das $w$ in der rechten Seite der
  Gleichung enthalten. Deshalb wird im weiteren Verlauf dieses Beweises davon
  ausgegangen, dass $w\in \StDT{}_{12}$ gilt, und es wird versucht zu
  zeigen, dass dieses $w$ ebenfalls in der rechten Seite enthalten ist. Aus der
  Definition~\ref{DefRuheDivSemantik} weiß man, dass $(q_{01},q_{02})
  \overset{w}{\Rightarrow} (q_1,q_2)$ mit $(q_1,q_2)\in Div_{12}$ gilt. Durch
  die Projektion auf die Transitionssysteme $S_1$ und $S_2$ erhält man $q_{01}
  \overset{w_1}{\Rightarrow} q_1$ und $q_{02} \overset{w_2}{\Rightarrow} q_2$
  mit $w\in w_1\|w_2$. Aus $(q_1,q_2)\in Div_{12}$ folgt, dass \oBdA{} $q_1\in
  Div_1$ gilt, d.h.\ $w_1\in \StDT{}_1$. Da $q_{02} \overset{w_2}{\Rightarrow}$
  gilt, erhält man $w_2\in L_2\subseteq \EL{}_2$ gelten. Somit gilt insgesamt
  $w\in \DT{}_1\|\EL{}_2$ und $w$ ist in der rechten Seite der Gleichung
  enthalten.

  2. \glqq{}$\supseteq$\grqq{}:\\
  Falls $w\in\ET{}_{12}$ gilt, ist dieses $w$ auch in der linken Seite der
  Gleichung enthalten. Somit wird für den Rest des Beweises dieser Inklusion
  davon ausgegangen, dass $w\in(\DT{}_1\|\EL{}_2)\cup (\EL{}_1\|\DT{}_2)$ gilt.
  Es wird nun davon ausgegangen, das \oBdA{} $w\in \DT{}_1\|\EL{}_2$ gilt,
  d.h.\ es existieren $w_1\in\DT{}_1$ und $w_2\in\EL{}_2$ mit $w\in
  w_1\|w_2$.
  \begin{itemize}
    \item Fall 1 ($w_1\in \ET{}_1 \vee w_2\in \ET{}_2$): Dieser Fall läuft
      analog zum Fall 1 der selben Inklusionsrichtung vom Beweis zu
      Satz~\ref{satzQuiSemantik}. Es muss dazu nur \StQT{} durch \StDT{}
      ersetzt werden.
    \item Fall 2 ($w_1\in \StDT{}_1\backslash \ET{}_1 \wedge w_2\in
      \EL{}_2\backslash \ET{}_2$): Es in diesem Fall also $q_{01}
      \overset{w_1}{\Rightarrow} q_1\in Div_1$ und $q_{02}
      \overset{w_2}{\Rightarrow}$. Da $q_1$ ein unendliche Folge an $\tau$s
      ausführen kann, ist dies auch für den zusammengesetzten Zustand von $q_1$
      und $q_2$ in der Parallelkomposition möglich. Es gilt also für die
      Komposition $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)\in
      Div_{12}$ und somit ist $w$ in der linken Seite der Gleichung enthalten,
      da $w\in \StDT{}_{12}\subseteq \DT{}_{12}$ gilt.
  \end{itemize}

  3. \glqq{}$\subseteq$\grqq{}:\\
  Diese Inklusionsrichtung kann analog zum Beweis der selben Inklusionsrichtung
  von Satz~\ref{satzQuiSemantik} gezeigt werden. Es muss dabei nur in der
  Argumentation die Menge $\ET{}_{12}$ durch Menge $\DT{}_{12}$ ersetzt werden.
  Dadurch wird ebenso gefolgert werden, dass der erreichte Zustand $(q_1,q_2)$
  kein Error-Zustand sein kann, da $\ET{}_{12}\subseteq \DT{}_{12}$ gilt.

  3. \glqq{}$\supseteq$\grqq{}:\\
  Es muss wieder danach unterschieden werden, aus welcher Menge das betrachtete
  Element stammt. Falls $w$ ein Element von $\ET{}_{12}$ ist, so folgt die
  Zugehörigkeit zur linken Seite der Gleichung direkt. Somit wird für den
  weiteren Punkt dieses Beweises davon ausgegangen, dass $w\in \QT{}_1\|\QT_2$
  gilt. Für dieses $w$ soll dann gezeigt werden, dass es auch in $\QT_{12}$
  enthalten ist. Da $\QT_i=\StQT{}_i\cup \DT{}_i$ gilt, existieren für $w_1$
  und $w_2$ mit $w\in w_1\|w_2$ unterschiedliche Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in \DT{}_1 \vee w_2\in \DT{}_2$): \OBdA{} gilt $w_1\in
      \DT{}_1$. Es kann nun $w_2\in \StQT{}_2 \subseteq L_2$ gelten oder
      $w_2\in \DT{}_2$ und somit gilt auf jeden Fall $w_2\in \EL{}_2$. Daraus
      kann mit dem zweiten Punkt dieses Satzes gefolgert werden, dass $w\in
      \DT{}_{12}$ gilt und somit $w$ in der linken Seite der Gleichung
      enthalten ist.
    \item Fall 2 ($w_1\in \StQT{}_1\backslash \DT{}_1 \wedge w_2\in \StQT{}_2
      \backslash \DT{}_2$): Dieser Fall läuft analog zu Fall 2 der selben
      Inklusionsrichtung des Beweises von Satz~\ref{satzQuiSemantik}.
  \end{itemize}
\end{proof}
