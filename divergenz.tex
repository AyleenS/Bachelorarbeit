\chapter{Verfeinerung für Error-, Ruhe- und Divergenz-Freiheit}

\section{Präkongruenz für Divergenz}

In diesem Kapitel soll die Menge der betrachteten Zustände noch einmal
erweitert werden. Somit werden dann Errors, Ruhe-Zustände und
Divergente-Zustände betrachtet. Es eignet sich also~\cite{Chilton2013} als
Quelle, da nun auch noch die Divergenz betrachtet wird. Diese wurde dort
gleichzeitig mit der Ruhe eingeführt und betrachtet. Da es sich nur um eine
Abwandlung der Präkongruenzen aus den letzten beiden Kapiteln handeln soll, wird
dabei ähnlich vorgegangen wie in den letzten beiden Kapiteln.\\
Wie bereits oben und im letzten Kapitel erwähnt wurden in~\cite{Chilton2013}
auch noch divergente Zustände als Fehler-Zustände betrachtet. Um zu klären, was
darunter verstanden wird, wird nun noch eine Definition für Divergenz gegeben.

\begin{Def}[Divergenz]
  Ein \emph{Divergenz-Zustand} ist ein Zustand in einem \EIO{}, der eine
  unendliche Folge an $\tau$s ausführen kann. Die Menge $Div(S)$ besteht aus all
  diesen Divergenten-Zuständen des \EIO{}s $S$.
\end{Def}

Die unendliche Folge an $\tau$s kann durch eine Schleife an einem durch $\tau$s
erreichbaren Zustand ausführbar sein, oder durch einen Weg, der mit $\tau$s
ausführbar ist, mit dem
unendliche viele Zustände durchlaufen werden. Es ist jedoch zu beachten, dass
ein Zustand, von dem aus unendlich viele Zustände durch $\tau$s erreichbar sind,
nicht divergent sein muss. Es ist auch möglich, dass dieser Zustand eine
unendliche Verzeigung hat und somit keine unendliche Folge an $\tau$s ausführen
kann.\\
Als Erreichbarkeitsbegriff wird wieder die lokale Erreichbarkeit verwendet.
Da das Divergieren eines Systems nicht mehr verhindert werden kann, sobald ein
divergenter Zustand lokal erreichbar ist, ist Divergenz als ähnlich
\glqq{}schlimm\grqq{} zu bewerten wie ein Error.

\begin{Def}[error-, ruhe- und divergenz-freie Kommunikation]
  Zwei \linebreak\EIO{}s $S_1$ und $S_2$ kommunizieren \emph{error-, ruhe- und
  divergenz-frei}, wenn in ihre Parallelkomposition $S_{12}$ keine Errors,
  Ruhe-Zustände und Divergenz-Zustände lokal erreichbar sind.
\end{Def}

\begin{Def}[Divergenz-Verfeinerungs-Basisrelation]
\label{DefDivBasisrel}
Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird $S_1\DBRel S_2$
geschrieben, wenn ein Error, Ruhe-Zustand oder Divergenz-Zustand in $S_1$ nur
dann lokal erreichbar ist, wenn er auch in $S_2$ lokal erreichbar ist. Diese
\emph{Basisrelation} stellt eine \emph{Verfeinerung} bezüglich \emph{Error},
\emph{Ruhe} und \emph{Divergenz} dar.\\
\DCRel{} bezeichnet die \emph{vollständige abstrakte Präkongruenz} von \DBRel{}
bezüglich $\cdot\|\cdot$.
\end{Def}

Da nun die grundlegenden Definitionen für Divergenz festgehalten sind,
kann man sich einen Begriff für die Traces zu divergenten Zuständen
bilden. Da oben bereits festgehalten wurde, dass Divergenz als ähnlich
\glqq{}schlimmer\grqq{} Fehler anzusehen ist, wie Error und dass das Divergieren
eines Systems nicht mehr verhinderbar ist, sobald ein divergenter Zustand
erreichbar ist, kommt für die Divergenztraces wieder die $\prune$-Funktion zu
Einsatz. Ein System, dass unendliche viele $\tau$s ausführen kann, ist von
außen nicht so einem System zu unterscheiden, dass einen Error-Zustand
erreicht. Somit wird in den Trace-Mengen auch nicht zwischen Errortraces und
Divergenztraces explizit unterschieden. Somit kann man auch nicht mehr nur mit
den Errortraces die Sprache fluten, sondern muss sowohl mit den Errortraces wie
auch den Divergenztraces fluten. Ebenso werden die strikten Ruhetraces mit
diesen beiden Trace-Mengen geflutet.

\begin{Def}[Divergenztraces]
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Divergenztraces}: $\StDT{}(S) := \{w\in\Sigma ^*\mid
      q_0 \overset{w}{\Rightarrow} q\in Div\}$,
    \item \emph{gekürzte Divergenztraces}: $\PrDT{}(S) :=
      \bigcup\{\prune{}(w)\mid w\in\StDT{}(S)\}$.
  \end{itemize}
\end{Def}

Da in~\cite{Chilton2013} bereits direkt Divergenz mit betrachtet wurde, wird
dort die Flutung der Traces so vorgenommen, dass die Errortraces in den
Divergenztraces enthalten sind und die Divergenztraces in den Ruhetraces. Da
hier zwischen den Errortraces und den Divergenztraces nicht unterschieden
werden soll, kann diese Inklusionskette nicht so umgesetzt werden, jedoch
entsteht durch das Fluten immer noch der selbe Effekt für die Ruhetraces. Somit
kann nur die Semantik der Menge \ET{} aus den früheren Kapitel übernommen
werden. Die jedoch für den weiteren Verlauf nur innerhalb der Trace-Menge
\EDT{} relevant sein wird.

\begin{Def}[Error-, Divergenz- und Ruhe-Semantik]
\label{DefRuheDivSemantik}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Divergenztraces} von $S$ ist $\DT{}(S) :=
      \cont{}(\PrDT{}(S))$.
    \item Die Menge der \emph{Error-Divergenztraces} von $S$ ist $\EDT{}(S) :=
      \ET{}(S)\cup \DT{}(S)$.
    \item Die Menge der \emph{error-divergenz-gefluteten Ruhetraces} von $S$
      ist $\QDT{}(S) :=$\linebreak $\StQT{}(S)\cup \EDT{}(S)$.
    \item Die Menge der \emph{error-divergenz-gefluteten Sprache} von $S$ ist
      $\EDL{}(S) := L(S) \cup \EDT{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur schreibt man $S_1\DRel
  S_2$, wenn $\EDT{}_1\subseteq \EDT{}_2$, $\QDT{}_1\subseteq \QDT{}_2$ und
  $\EDL{}_1\subseteq \EDL{}_2$ gilt.
\end{Def}

In der letzten Definition wurde wieder durch das Fluten eine
Informationsvermischung vorgenommen. Sowohl im Fall \QDT{} wie auch im Fall
\EDL{} mit \EDT{}, den Error-Divergenztraces. Da hier die Errortraces um die
Divergenztraces erweitert wurde, und die error-geflutete Sprache zur
error-divergenz-gefluteten Sprache erweitert wurde folgt, dass die Relation
\DRel{} im Gegensatz zu \QRel{} keine direkte Einschränkung der Relation
\ERel{} ist.

\begin{satz}[Error-, Ruhe- und Divergenz-Semantik für Parallelkompostionen]
\label{satzDivSemantik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition
  $S_{12}$ gilt:
  \begin{enumerate}
    \item $\EDT{}_{12}=\cont (\prune ((\EDT{}_1\|\EDL{}_2)\cup
      (\EDL{}_1\|\EDT{}_2)))$,
    \item $\QDT{}_{12}=(\QDT{}_1\|\QDT{}_2)\cup \EDT{}_{12}$,
    \item $\EDL{}_{12}=(\EDL{}_1\|\EDL{}_2)\cup \EDT{}_{12}$.
  \end{enumerate}
\end{satz}

\begin{proof}

  1. \glqq{}$\subseteq$\grqq{}:\\
  Da beide Seiten der Gleichung unter \cont{} abgeschlossen sind, genügt es ein
  präfix-minimales Element $w$ zu betrachten. Es muss hier unterschieden, ob
  $w\in \ET{}_{12}$ oder $w\in \DT{}_{12}\backslash \ET{}_{12}$ betrachtet
  wird. Im ersten Fall ist das $w$ in der rechten Seite der Gleichung
  enthalten, wegen den Beweises des ersten Punktes von
  Satz~\ref{satzErrorSemanik} und da $\ET{}(S)\subseteq \EDT{}(S)$ und
  $\EL{}(S)\subseteq \EDL{}(S)$ gilt. Deshalb wird im weiteren Verlauf dieses
  Beweises
  davon ausgegangen, dass $w\in \DT{}_{12}\backslash \ET{}_{12}$ gilt, und es
  wird versucht zu zeigen, dass dieses $w$ ebenfalls in der rechten Seite
  enthalten ist. Da das betrachtete $w$ präfix-minimal ist, gilt $w\in
  \PrDT{}_{12}\backslash \ET{}_{12}$. Aus der
  Definition~\ref{DefRuheDivSemantik} weiß man, dass ein $v\in O^*_{12}$
  existiert, so dass $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)
  \overset{v}{\Rightarrow} (q_1',q_2')$ mit $(q_1',q_2')\in Div_{12}$ gilt.
  Durch die Projektion auf die Transitionssysteme $S_1$ und $S_2$ erhält man
  $q_{01} \overset{w_1}{\Rightarrow} q_1 \overset{v_1}{\Rightarrow} q_1'$ und
  $q_{02} \overset{w_2}{\Rightarrow} q_2 \overset{v_2}{\Rightarrow} q_2'$ mit
  $w\in w_1\|w_2$ und $v\in v_1\|v_2$. Aus $(q_1',q_2')\in Div_{12}$ folgt,
  dass \oBdA{} $q_1'\in Div_1$ gilt, d.h.\ $w_1v_1\in \StDT{}_1\subseteq
  \EDT{}_1$. Da $q_{02} \overset{w_2v_2}{\Rightarrow}$ gilt, erhält man
  $w_2v_2\in \EDL_2$. Somit gilt insgesamt $wv\in \EDT{}_1\|\EDL{}_2$ und $w$
  ist in der rechten Seite der Gleichung enthalten, da $v\in O_{12}^*$ gilt und
  somit $\prune{}(wv)=\prune{}(w)$.

  1. \glqq{}$\supseteq$\grqq{}:\\
  Es wird ebenso wie oben nur ein präfix-minimales $w$ betrachtet wegen den
  Abschlusses beider Seiten der Gleichung unter \cont{}. Es wird also für ein beliebiges
  $x\in\prune{}((\EDT{}_1\|$ $\EDL{}_2)\cup (\EDL{}_1\|\EDT{}_2))$ gezeigt, dass
  dieses oder einer seiner Präfixe auch in $\EDT{}_{12}$ enthalten ist. Da das
  $x$ aus der \prune{}-Funktion entstanden ist, lässt sich ein $y$ aus
  $O_{12}^*$ finden, sodass $xy\in (\EDT{}_1\|\EDL{}_2)\cup
  (\EDL{}_1\|\EDT{}_2)$. Es wird nun noch die Einschränkung vorausgesetzt,
  dass \oBdA{} $xy\in \EDT{}_1\|\EDL{}_2$, d.h.\ es existieren
  $w_1\in\EDT{}_1$ und $w_2\in\EDL{}_2$ mit $xy\in w_1\|w_2$.\\
  Die folgende Argumentation läuft analog zu dem Beweis der Inklusion
  $\ET{}_{12} \supseteq \cont{}($ $\prune{}((\ET{}_1\|\EL_2)\cup
  (\EL{}_1\|\ET{}_2)))$ aus Satz~\ref{satzErrorSemanik}. Es muss dazu nur
  jeweils an den Stellen, wo $\PrET{}(S)\cup \MIT{}(S)$ steht auch noch eine
  Vereinigung mit $\PrDT{}(S)$ vorgenommen werden. Am Ende ist dann auch noch
  ein Fall für $v_1\in\PrDT{}_1$ zu ergänzen:
  \begin{itemize}
    \item Fall III ($v_1\in \PrDT{}_1$): Es existiert ein $u_1$ aus $O_1^*$,
      sodass $q_{01} \overset{v_1}{\Rightarrow} q_1 \overset{u_1}{\Rightarrow}
      q_1'$ mit $q_1'\in Div_1$ gilt. Da es hier keine disjunkten Inputmengen gibt, kann das
      $a$ auf das $v_1$ im Fall $v_1\neq \varepsilon$ endet, ebenfalls der
      letzte Buchstabe von $v_2$ sein. Im Fall von $v_2\in \MIT{}_2$ kann somit
      $a=b$ gelten und somit wäre $v_2= v_2'$. Dieser Fall verläuft jedoch
      analog zu Fall Ic) und wird somit hier nicht weiter betrachtet. Es gilt
      somit für alle im folgenden betrachteten Fälle $q_{02} \overset{v_2'}{\Rightarrow}
      q_2$ mit $(q_{01},q_{02}) \overset{v'}{\Rightarrow}$.
      \begin{itemize}
        \item Fall IIIa) ($u_2\in (O_1\cap I_2)^*, c\in (O_1\cap I_2)$, sodass
          $u_2c$ ein Präfix von $u_1|_{I_2}$ mit $q_2
          \overset{u_2}{\Rightarrow}
          q_2'\overset{c}{\not{\hspace{-0.1cm}\rightarrow}}$): Für ein Präfix
          $u_1'c$ von $u_1$ mit $u_1'c|_{I_2}= u_2c$ weiß man, dass $q_1
          \overset{u_1'}{\Rightarrow} q_1''
          \overset{c}{\hspace{-0.1cm}\rightarrow}$. Somit gilt $u_1'\in
          u_1'\|u_2$ und $(q_1,q_2) \overset{u_1'}{\Rightarrow} (q_1'',q_2')
          \in E_{12}$, da für $S_2$ der entsprechende Input fehlt, der mit dem
          $c$ Output von $S_1$ zu koppeln wäre. Es handelt sich also um einen
          neuen Error. Es wird $v:=\prune{}(v'u_1')\in \PrET{}_{12}$ gewählt,
          dies ist ein Präfix von $v'$, da $u_1\in O_1^*$.
        \item Fall IIIb) ($q_2 \overset{u_2}{\Rightarrow} q_2'$ mit $u_2=
          u_1|_{I_2}$): Somit ist $u_1\in u_1\|u_2$ und $(q_1,q_2)
          \overset{u_1}{\Rightarrow} (q_1',q_2') \in Div_{12}$, da $q_1\in
          Div_1$. $S_{12}$ hat also die Divergenz von $S_1$ geerbt. Es wird nun
          $v:= \prune{}(v'u_1)\in \PrDT{}_{12}$ gewählt, das wiederum ein
          Präfix von $v'$ ist.
      \end{itemize}
  \end{itemize}

  2. \glqq{}$\subseteq$\grqq{}:\\
  Diese Inklusionsrichtung kann analog zum Beweis der selben Inklusionsrichtung
  von Satz~\ref{satzQuiSemantik} gezeigt werden. Es muss dabei nur in der
  Argumentation die Menge $\ET{}_{12}$ durch die Menge $\EDT{}_{12}$ und die
  Menge $\QT{}(S)$ durch die Menge $\QDT{}(S)$ ersetzt
  werden. Dadurch kann ebenso gefolgert werden, dass der erreichte Zustand
  $(q_1,q_2)$ kein Error-Zustand sein kann, da $\ET{}_{12}\subseteq
  \EDT{}_{12}$ gilt.

  2. \glqq{}$\supseteq$\grqq{}:\\
  Es muss wieder danach unterschieden werden, aus welcher Menge das betrachtete
  Element stammt. Falls $w$ ein Element von $\EDT{}_{12}$ ist, so folgt die
  Zugehörigkeit zur linken Seite der Gleichung direkt. Somit wird für den
  weiteren Verlauf dieses Beweises davon ausgegangen, dass $w\in
  \QDT{}_1\|\QDT{}_2$ gilt. Für dieses $w$ soll dann gezeigt werden, dass es
  auch in $\QDT_{12}$ enthalten ist. Da $\QDT_i=\StQT{}_i\cup \EDT{}_i$ gilt,
  existieren für $w_1$ und $w_2$ mit $w\in w_1\|w_2$ unterschiedliche
  Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in \EDT{}_1 \vee w_2\in \EDT{}_2$): \OBdA{} gilt $w_1\in
      \EDT{}_1$. Es kann nun $w_2\in \StQT{}_2 \subseteq L_2$ gelten oder
      $w_2\in \EDT{}_2\subseteq\EDL{}_2$ und somit gilt auf jeden Fall $w_2\in
      \EDL{}_2$. Daraus kann mit dem ersten Punkt dieses Satzes gefolgert
      werden, dass $w\in \EDT{}_{12}$ gilt und somit $w$ in der linken Seite
      der Gleichung enthalten ist.
    \item Fall 2 ($w_1\in \StQT{}_1\backslash \EDT{}_1 \wedge w_2\in \StQT{}_2
      \backslash \EDT{}_2$): Dieser Fall läuft analog zu Fall 2 der selben
      Inklusionsrichtung des Beweises von Satz~\ref{satzQuiSemantik}. Hierfür
      ist wichtig festzustellen, dass Lemma~\ref{lemRuheParallelkomp} anwendbar
      ist, da $\ET{}_i\subseteq \EDT{}_i$ gilt. Zusätzlich muss die Menge
      $\QT{}_{12}$ durch $\QDT{}_{12}$ ersetzt werden.
  \end{itemize}

  3.:\\
  Durch die Definition ist klar, dass $L_i\subseteq \EDT{}_i$ und
  $\EDT{}_i\subseteq \EDL{}_i$ gilt. Die
  Argumentation wird von der rechten Seite der Gleichung aus begonnen:
  \begin{align*}
    &(\EDL{}_1\| \EDL{}_2)\cup \EDT{}_{12}\\
    &\overset{\ref{DefRuheDivSemantik}}{=}((L_1\cup \EDT{}_1)\|(L_2\cup
    \EDT{}_2))\cup \EDT{}_{12}\\
    &=\underset{\overset{1.}{\subseteq} \EDT{}_{12}}{\underset{\subseteq
    (\EDL{}_1\|\EDT{}_2)}{\underbrace{(L_1\|\EDT{}_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \EDT{}_{12}}{\underset{\subseteq
    (\EDT{}_1\|\EDL{}_2)}{\underbrace{(\EDT{}_1\|L_2)}}} \cup
    (L_1\|L_2) \cup \underset{\overset{1.}{\subseteq}
    \EDT{}_{12}}{\underset{\subseteq
    (\EDL{}_1\|\EDT{}_2)}{\underbrace{(\EDT{}_1\|\EDT{}_2)}}} \cup \EDT{}_{12}\\
    &=(L_1\|L_2) \cup \EDT{}_{12}\\
    &\overset{\ref{LemmaSprache}}{=}L_{12}\cup \EDT{}_{12}\\
    &\overset{\ref{DefRuheDivSemantik}}{=}\EDL{}_{12}.
  \end{align*}
\end{proof}

Analog wie in den beiden vorgegangenen Kapiteln, ergibt sich aus diesem Satz
als direkte Folgerung, dass es sich bei der Relation \DRel{} um eine
Präkongruenz handelt.

\begin{prop}[Divergenz-Präkongurenz]
\label{propDivPrae}
  \DRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{prop}

\begin{proof}
  Um zu zeigen, dass es sich bei \DRel{} um eine Präkongruenz handelt, muss
  nachgewiesen werden, dass $S_{31}\DRel{} S_{32}$ für jedes komponierbare
  System $S_3$ gilt, wenn $S_1\DRel{} S_2$ erfüllt ist.  D.h.\ es ist
  zu zeigen, dass auch $\EDT{}_1\subseteq \EDT{}_2$, $\QDT{}_1\subseteq
  \QDT{}_2$ und $\EDL{}_1\subseteq \EDL{}_2$ sowohl $\EDT{}_{31}\subseteq
  \EDT_{32}$, $\QDT{}_{31}\subseteq \QDT{}_{32}$ als auch $\EDL{}_{31}\subseteq
  \EDL{}_{32}$ folgt. Dies ergibt sich wie in den Beweisen zu den
  Propositionen~\ref{propPraekongruenz} und~\ref{propQuiPrae} aus der Monotonie
  von $\cdot\|\cdot$ auf Sprachen wie folgt:
  \begin{itemize}
    \item $\begin{aligned}[t]
        \EDT{}_{31} &\overset{\ref{satzDivSemantik}~1.}{=}
        \cont{}(\prune{}((\EDT{}_3\|\EDL{}_1) \cup (\EDL{}_3\|\EDT{}_1))\\
        &\hspace{-0.5cm}\overset{\EDT{}_1\subseteq
      \EDT{}_2}{\overset{\mathrm{und}}{\overset{\EDL{}_1\subseteq
    \EDL{}_2}{\subseteq}}} \cont{}(\prune{}((\EDT{}_3\|\EDL{}_2) \cup
    (\EDL{}_3\|\EDT{}_2)))\\
      &\overset{\ref{satzDivSemantik}~2.}{=} \EDT{}_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QDT{}_{31} &\overset{\ref{satzDivSemantik}~2.}{=} (\QDT{}_3\|\QDT{}_1)
        \cup \EDT{}_{31}\\
        &\hspace{-0.5cm}\overset{\EDT{}_{31}\subseteq
      \EDT{}_{32},}{\overset{\mathrm{und}}{\overset{\QDT{}_1\subseteq
      \QDT{}_2}{\subseteq}}} (\QDT{}_3\|\QDT{}_2) \cup \EDT{}_{32}\\
      &\overset{\ref{satzDivSemantik}~3.}{=} \QDT{}_{32}.
    \end{aligned}$
  \end{itemize}
\end{proof}

Als nächstes soll nun eine Verfeinerungsrelation bezüglich guter Kommunikation
von Transitionssystemen im Sinne von error-, ruhe- und divergenz-freier
Kommunikation betrachtet werden. Es muss in diesem Lemma eine Veränderung zu
den analogen Lemmata aus den vorangegangen Kapiteln vorgenommen werden. Die
Einschränkung, dass $U$ ein Partner sein muss, kann nicht mehr beibehalten
werden, da die Strategie zur Vermeidung von Ruhe im Beweis aus dem letzten
Kapitel hier zu Divergenz führen würde. Somit wird für die Ruhe-Vermeidung in
diesem Kapitel Aktionen außerhalb der Menge $Synch$
benötigt. Jedoch müssten trotzdem nicht alle komponierbaren \EIO{}s $U$ betrachtet
werden. Es kann eine Einschränkung gemacht werden, so dass $U$ fast ein
Partner ist. Um umständliche Formulierungen im folgenden zu Vereinfachen, wird hierfür
nun ein neuer Begriff definiert.

\begin{Def}[\boldmath$\omega$-Partner]
  Ein \EIO{} $S_1$ ist ein \emph{$\omega$-Partner} von einem \EIO{} $S_2$, wenn
  $I_1=O_2$ und $O_1=I_2\cup\{\omega\}$ mit $\omega\notin I_2\cup O_2$ gilt.
\end{Def}

Ein $\omega$-Partner $S_1$ von $S_2$ unterscheidet sich von einem Partner von
$S_2$ nur um den Output $\omega$, der nicht in der Menge $Synch(S_1,S_2)$
enthalten ist.

\begin{lem}[Vereinerung mit Divergenz-Zuständen]
\label{lemDivVerfeinerung}
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  $U\|S_1\DBRel{} U\|S_2$ für alle $\omega$-Partner $U$ gilt, dann folgt daraus
  $S_1\DRel{} S_2$.
\end{lem}

\begin{proof}
  Da davon ausgegangen wird, dass $S_1$ und $S_2$ die gleiche Signatur haben,
  definiert man $I:=I_1=I_2$ und $O:=O_1=O_2$. Für jeden $\omega$-Partner $U$
  gilt $I_U=O$ und $O_U=I\cup\{\omega\}$ mit $\omega\notin I\cup O$.\\
  Um zu zeigen, dass die Relation $S_1\DRel S_2$ gilt, müssen die folgenden
  Punkte nachgewiesen werden:
  \begin{itemize}
    \item $\EDT{}_1\subseteq \EDT{}_2$,
    \item $\QDT{}_1\subseteq \QDT{}_2$,
    \item $\EDL{}_1\subseteq \EDL{}_2$.
  \end{itemize}
  In den Lemmata~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} wurde
  bereits etwas Ähnliches gezeigt. Jedoch kann Aufgrund der unterschiedlichen
  Basisrelation, die zur Anwendung kommen nichts über dieses Lemma und dessen
  Gültigkeit ausgesagt werden. Es kann also in diesem Lemma eben so wie
  in~\ref{lemQuiVerfeinerung} aus der lokalen Erreichbarkeit eines Errors in
  $S_1'$ und dem relationalen Zusammenhang von $S_1'\DBRel S_2'$ nur
  geschlossen werden, dass in $S_2'$ auch ein Fehler lokal erreichbar ist,
  jedoch kann dieser Fehler hier ein Error, ein Ruhe-Zustand oder ein
  divergenter Zustand sein. Analog verhält es sich, wenn in $S_1'$ ein
  Divergenz-Zustand oder ein Ruhe-Zustand lokal erreichbar ist.

  Als erstes wird der erste Beweispunkt gezeigt. Also die Inklusion
  $\EDT{}_1\subseteq \EDT{}_2$.\\
  Es wird für ein präfix-minimales $w$ aus $\EDT{}_1$ gezeigt, dass dieses
  $w$ oder eines seiner Präfixe in $\EDT{}_2$ enthalten ist. Diese Möglichkeit
  bietet sich, da beide Mengen unter \cont{} abgeschlossen sind.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Error oder Divergenz-Zustand in $S_1$. Für $U$ wird ein Transitionssystem
      verwendet, das nur aus dem Startzustand und einer Schleife für alle
      Inputs $x\in I_U$ und einer Schleife für $\omega$ besteht. Somit kann
      $S_1$ die im Prinzip gleichen Error-Zustände bzw. Divergenz-Zustände
      lokal erreichen wie $U\|S_1$. Draus folgt, dass auch $U\|S_2$ einen lokal
      erreichbaren Fehler haben muss, da $U\|S_1\DBRel U\|S_2$ gilt. Durch den
      Aufbau von $U$, ist in einer Parallelkomposition mit $U$ kein
      Ruhe-Zustand möglich. Der Fehler, der in $U\|S_2$ lokal erreichbar ist,
      muss also ein Error oder Divergenz-Zustand sein. Da von $U$ kein Error
      und keine Divergenz geerbt werden kann und durch die Inputschleife auch
      kein neuer Error enstehen kann, muss der Fehler von $U_2$ geerbt sein.
      Somit gilt also, dass in $S_2$ ein Error- oder Divergenz-Zustand lokal
      erreichbar ist. Da $\EDT{}(S) = \ET{}(S)\cup \DT{}(S)$ gilt, folgt somit
      $w\in \EDT{}_2$.
    \item Fall 2 ($w=x_1\dots x_nx_{n+1}\in\Sigma{} ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgende $\omega$-Partner $U$ betrachtet
      (siehe auch Abbildung~\ref{UohneEmitO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_{n+1}\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i\leq n\}\\
                      &\cup\{(q_i,x,q_{n+1})\mid  x\in I_U\backslash\{x_{i+1}\},
          0\leq i\leq n\}\\
          &\cup\{(q_{n+1},x,q_{n+1})\mid  x\in I_U\}\\
          &\cup\{(q_i,\omega ,q_{n+1})\mid 0\leq i\leq n+1\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$q_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$q_{n+1}$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                    !$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \omega !$} (n1)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (n1)
                (n) edge node [above, sloped] {$x?\in I_U, \omega !$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U, \omega !$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UohneEmitO}
      \end{center}
      \end{figure}
      Die Mengen der Divergenz- und Ruhe-Zustände des hier betrachteten $U$s
      sind leer. Da im Vergleiche zum Transitionssystem in
      Abbildung~\ref{UohneE} nur die $\omega$-Transitionen zu $q_{n+1}$ ergänzt
      wurden, ändert sich nichts an dem Fall 2a). In Fall 2b) muss die Menge
      $O^*$ durch $(O\cup \{\omega\})^*$ ersetzt werden. Die Begründungen,
      wieso in den beiden Fällen $\varepsilon\in \PrET{}(U\|S_1)$ gilt bleibt
      also analog zum Beweis von Lemma~\ref{lemVerfeinerung}. Da nun aber auch
      Divergenz betrachtet wird, muss ein weiterer Fall ergänzt werden:
      \begin{itemize}
        \item Fall 2c) ($w\in\PrDT{}_1$): In $U\|S_1$ erhält man $(q_0,q_{01})
          \overset{w}{\Rightarrow} (q_{n+1},q'') \overset{u}{\Rightarrow}
          (q_{n+1},q')$ für $u\in (O\cup \{\omega\})^*$ und $q'\in Div_1$.
          Daraus folgt $(q_{n+1},q')\in Div_{U\|S_1}$ und somit $wu\in
          \StDT{}(U\|S_1)$. Da alle Aktionen aus $w$ synchronisiert werden gilt
          $x_1,\dots ,x_n,x_{n+1}\in O_{U\|S_1}$ und, da $u\in (O\cup
          \{\omega\})^*$, folgt $u\in O_{U\|S_1}^*$. Somit ergibt sich
          $\varepsilon\in \PrDT{}(U\|S_1)$.
      \end{itemize}
      Da $\varepsilon$ in $\PrET{}(U\|S_1)\cup \PrDT{}(U\|S_1)$ enthalten
      ist, kann mit der Relation $U\|S_1\DBRel U\|S_2$ geschlossen werden, dass
      in $U\|S_2$ ein Fehler lokal erreichbar sein muss. Durch die
      $\omega$-Transitionen an den Zuständen von $U$ kann es in Komposition mit
      $U$ keine Ruhe-Zustände geben. Der Fehler muss also Error oder Divergenz
      sein.
      \begin{itemize}
        \item Fall 2i) ($\varepsilon\in\ET{}(U\|S_2)$ wegen neuem Error): Da
          jeder Zustand von $U$ allen Inputs $x\in I_U=O$ zulässt, muss ein
          lokal erreichbarer Error der Form sein, dass ein Output $a\in
          O_U\backslash\{\omega\}$ von $U$ möglich ist, der nicht mit einem
          passenden Input aus $S_2$ synchronisiert werden kann. Durch die
          Konstruktion von $U$ ist in $q_{n+1}$ kein Output außer $\omega$
          möglich. Ein neuer Error muss also die Form $(q_i,q')$ haben mit
          $i\leq n, q' \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und
          $x_{i+1}\in O_U\backslash\{\omega\}$. Durch Projektion erhält man
          dann $q_{02} \overset{x_1\dots x_i}{\Rightarrow} q'
          \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und damit gilt
          $x_1\dots x_{i+1}\in \MIT{}_2\subseteq \ET{}_2$. Somit ist ein Präfix
          von $w$ in $\EDT{}_2$ enthalten.
        \item Fall ii) ($\varepsilon\in\ET{}(U\|S_2)$ wegen geerbtem Error):
          $U$ hat $x_1\dots x_iu$ ausgeführt mit $u\in (O\cup\{\omega\})^*$ und
          ebenso hat $S_2$ den Weg $x_1\dots x_iu|_{\Sigma _2}$ ausgeführt.
          Durch dies hat $S_2$ einen Zustand aus $E_2$ erreicht, da von $U$
          kein Error geerbt werden kann. Es gilt dann $\prune{}(x_1\dots
          x_iu|_{\Sigma _2})= \prune{}(x_1\dots x_i)\in\PrET{}_2\subseteq
          \ET{}_2$. Da $x_1\dots x_i$ ein Präfix von $w$ ist, führt auch in
          diesem Fall ein Präfix von $w$ zu einem Error und ist somit in
          $\EDT{}_2$ enthalten.
        \item Fall 2iii) ($\varepsilon\in \DT{}(U\|S_2)\backslash
          \ET{}(U\|S_2)$): Da $U$ nicht unendliche viele Zustände hat und auch
          keine $\tau$-Schleifen besitzt, kann das divergenz Verhalten nur von
          $S_2$ geerbt sein. $U$ hat $x_1\dots x_iu$ ausgeführt mit $u\in
          (O\cup \{\omega\})^*$ und ebenso hat $S_2$ den Weg $x_1\dots
          x_iu|_{\Sigma _2}$ ausgeführt. Durch dies hat $S_2$ einen Zustand aus
          $Div_2$ erreicht. Es gilt dann $\prune{}(x_1\dots x_iu|_{\Sigma
          _2}) = \prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \DT{}_2$, da
          $u|_{\Sigma _2}$ in $O^*$ enthalten ist. Da $x_1\dots x_i$ ein Präfix
          von $w$ ist, führt in diesem Fall ein Präfix von $w$ zu einem
          divergenten Zustand und ist somit in $\EDT{}_2$ enthalten.
      \end{itemize}
  \end{itemize}

  Als nächstes wird nun der zweite Beweispunkt gezeigt, d.h.\ die Inklusion
  $\QDT{}_1\subseteq \QDT{}_2$. Diese Inklusion kann jedoch noch, anlog zum
  Beweis der Inklusion der error-gefluteten Sprachen aus dem Error-Kapitel,
  weiter eingeschränkt werden. Da bereits bekannt ist, dass $\EDT{}_1\subseteq
  \EDT{}_2$ gilt, muss nur noch $\StQT{}_1\backslash \EDT{}_1\subseteq
  \QDT{}_2$ gezeigt werden.\\
  Es wird ein $w\in \StQT{}_1\backslash\EDT{}_1$ gewählt und gezeigt, dass
  dieses auch in $\QDT{}_2$ enthalten ist.\\
  Durch die Wahl des $w$s wird vom Startzustand von $S_1$ durch das Wort $w$
  ein ruhiger Zustand erreichbar. Dies hat nur Auswirkungen auf die
  Parallelkomposition $U\|S_1$, wenn in $U$ ebenfalls ein Ruhe-Zustand durch
  $w$ erreichbar ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es ist ein Ruhe-Zustand intern erreichbar
      in $S_1$, da jedoch $\varepsilon\notin \EDT{}_1$ gilt, ist kein Error
      oder Divergenz-Zustand lokal erreichbar. Für $U$ wird ein
      Transitionssystem verwendet, das nur aus dem Startzustand ohne
      Transitionsmöglichkeiten besteht. Somit ist auch in $U$ ein Ruhe-Zustand
      lokal erreichbar. Es folgt also mit Lemma~\ref{lemRuheParallelkomp}, dass
      auch in $U\|S_1$ ein Ruhe-Zustand lokal erreichbar ist. Es muss also auch
      in $U\|S_2$ ein Fehler lokal erreichbar sein. Bei diesem Fehler-Zustand
      kann es sich nun um einen Error, Divergenz-Zustand oder um einen
      Ruhe-Zustand handeln, dies ist jedoch Aufgrund der Definition der Menge
      \QDT{} nicht relevant. Da für $U$ keine Transitionen möglich sind, kann
      nur $\varepsilon$ ein striktes Ruhetrace sein, falls es sich bei dem
      Fehler in $U\|S_2$ um einen lokal erreichbaren Ruhe-Zustand handelt.
      Somit folgt in allen drei Fällen, dass $w$ in $\QDT{}_2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n\in \Sigma ^+$ mit $n\geq 1$): Es wird der
      folgende $\omega$-Partner $U$ betrachtet (siehe auch
      Abbildung~\ref{UohneEmitIundO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_n, q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid  x\in (I_U\cup
          \{\omega\})\backslash\{x_{i+1}\}, 0\leq i< n\}\\
                      &\cup\{(q_n,x,q)\mid x\in I_U\}\\
                      &\cup\{(q,x,q)\mid x\in I_U\cup\{\omega\}\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots, rectangle, dashed, draw] {$q_n\in Qui_U$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                    !$} (q)
                (1) edge node {$x_2$} (dots)
                    edge [below, sloped] node {$x?\neq x_2, \omega !$} (q)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (q)
                (n) edge [bend left] node [below,sloped] {$x?\in I_U$} (q)
                (q) edge [loop below] node {$x?\in I_U, \omega !$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UohneEmitIundO}
      \end{center}
      \end{figure}
      Der Zustand $q_n$ aus $U$ ist der einzige ruhige Zustand in $U$.
      Es gilt wegen Lemma~\ref{lemRuheParallelkomp}, dass auch in der
      Parallelkomposition $U\|S_1$ ein Ruhe-Zustand mit $w$ erreicht wird. Da
      es sich bei allen in $w$ befindlichen Aktionen um synchronisierte
      Aktionen handelt und $I_U\cap I=\emptyset$, folgt $w\in O_{U\|S_1}^*$ und
      $w\in \StQT{}(U\|S_1)$. Es kann also in der Parallelkomposition durch $w$
      ein Ruhe-Zustand lokal erreicht werden. Da $w\notin \EDT{}_1$ gilt, kann
      auf dem Weg, der mit $w$ im Transitionssystem $S_1$ zurück gelegt wird
      kein Error oder Divergenz-Zustand lokal erreicht werden. Es kann also
      weder von $S_1$ noch von $U$ Error oder Divergenz auf diesem Weg geerbt
      werden oder neu entstehen. Da ein Ruhe-Zustand in $U\|S_1$ lokal
      erreichbar ist, muss auch ein Fehler in $U\|S_2$ lokal erreichbar sein.
      Hier kann jedoch zunächst keine Aussage darüber getroffen werden, ob das
      $w$ ausführbar ist und ob es sich bei dem Fehler um Error, Ruhe oder
      Divergenz handelt.
      \begin{itemize}
        \item Fall 2a) ($\varepsilon\in \ET{}(U\|S_2)$): Der lokal erreichbare
          Fehler ist ein Error. Das $w$ muss somit nicht ausführbar sein. Da
          nur auf dem Trace $w$ in $U$ Sychornisa\-tions-Fehler möglich sind
          und wegen des ersten Punktes von Lemma~\ref{lemVerfeinerung}, ist ein
          Präfix von $w$ in $\ET{}_2$ enthalten. Da die Menge \ET{} unter
          \cont{} abgeschlossen ist, gilt auch $w\in \ET{}_2\subseteq \EDT{}_2
          \subseteq \QDT{}_2$.
        \item Fall 2b) ($\varepsilon\in \DT{}(U\|S_2)\backslash
          \ET{}(U\|S_2)$): Es handelt sich bei dem lokal erreichbaren Fehler um
          Divergenz. Der Fehler muss von $S_2$ geerbt sein, da $U$ keine
          Divergenz-Möglichkeiten hat. Es gilt also, dass bereits in $S_2$ ein
          Präfix von $w$ in $\EDT{}_2$ enthalten ist, wegen des Beweises des
          zweiten Punktes aus diesem Lemma. Mit dem Abschluss unter \cont{}
          folgt, dass auch $w\in \EDT{}_2\subseteq \QDT{}_2$ gilt.
        \item Fall 2c) (Ruhe-Zustand lokal erreichbar in $U\|S_2$ und
          $\varepsilon\notin \EDT{}(U\|S_2)$): Da in $U$ nur durch $w$ ein
          ruhiger Zustand erreicht werden kann, muss es sich bei dem lokal
          erreichbaren Ruhe-Zustand in $U\|S_2$ um einen handeln, der mit $w$
          erreicht werden kann. Mit Lemma~\ref{lemRuheParallelkomp} kann somit
          gefolgert werden, dass auch in $S_2$ ein Ruhe-Zustand mit $w$
          erreichbar sein muss. Es gilt also $w\in \StQT{}_2\subseteq
          \QDT{}_2$.
      \end{itemize}
  \end{itemize}

  Nun wird mit dem letzten Punkt des Beweises begonnen. Analog
  wie in den Beweisen zu~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} ist
  hier jedoch auf Grund der bereits geführten Beweisteile nur noch
  $L_1\backslash \EDT{}_1\subseteq \EDL{}_2$ zu zeigen. Es wird also für ein
  beliebig gewähltes $w\in L_1\backslash \EDT{}_1$ gezeigt, dass es auch in
  $\EDL{}_2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Analog zu~\ref{lemVerfeinerung}
      und~\ref{lemQuiVerfeinerung} gilt auch hier, dass $\varepsilon$ immer in
      $\EDL{}_2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Die Konstruktion des
      $\omega$-Partners $U$ weicht nur durch die $\omega$-Transition vom
      Transitionssystems aus dem Beweis der Inklusion der error-gefluteten Sprache \EL{} aus
      Lemma~\ref{lemVerfeinerung} ab. Somit ist der $\omega$-Partner $U$ dann
      wie folgt definiert (siehe dazu auch Abbildung~\ref{UmitEundO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_n,q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\{q_n\}$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid 0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid x\in I_U\backslash\{x_{i+1}\},0\leq
          i < n\}\\
          &\cup\{(q_i,\omega ,q)\mid 0\leq i\leq n\}\\
          &\cup\{(q,x ,q)\mid x\in I_U\cup \{\omega\}\}.
              \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$q_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$q_n\in E_U$};
          \node (q) at ($(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                    !$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \omega !$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                       edge [dashed] (q)
                (n1) edge node {$x_n$} (n)
                     edge node [below, sloped] {$x?\neq x_n, \omega !$} (q)
                (q) edge [loop below] node {$x?\in I_U, \omega !$} (q)
                (n) edge [bend left] node {$\omega !$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$, $q_n$
          ist der einzige Error-Zustand}
\label{UmitEundO}
      \end{center}
      \end{figure}
      Durch die $\omega$-Transitionen an den Zuständen wird wie oben vermieden,
      dass es in einer Komposition mit $U$ und auch in $U$ selbst Ruhe-Zustände
      gibt. Da $q_{01} \overset{w}{\Rightarrow} q_1'$ gilt, kann man schließen,
      dass $U\|S_1$ einen lokal erreichbaren geerbten Error hat. Somit muss
      $U\|S_2$ ebenfalls einen lokal erreichbaren Fehler haben. Wie oben
      bereits erwähnt, kann es sich bei dem Fehler nicht um Ruhe handeln.
      \begin{itemize}
        \item Fall 2a) \big(neuer Error aufgrund von $x_i\in O_U\backslash
          \{\omega\}$ und $q_{02} \overset{x_1\dots x_{i-1}}{\Rightarrow} q_2'
          \overset{x_i}{\not{\hspace{-0.1cm}\rightarrow}}$\big): Es gilt $x_1\dots
          x_i\in \MIT{}_2$ und somit $w\in\EDL{}_2$. Anzumerken ist, dass nur
          auf diesem Weg Outputs von $U$ aus $Synch$ möglich sind, deshalb gilt
          es keine anderen Outputs von $U$, die zu einem neuen Error führen
          könnten.
      \end{itemize}
      Die restlichen Fälle sind analog zu Lemma~\ref{lemVerfeinerung} möglich.
      Somit gilt für alle Fälle (2a) bis 2d)), dass $w$ in $\EDL{}_2$ enthalten
      ist, da $\EL{}_2\subseteq \EDL{}_2$ gilt.
      \begin{itemize}
        \item Fall 2e) (Divergenz und kein neuer Error): Da $U$ keine
          Möglichkeit hat zu divergieren, muss diese Möglichkeit von $S_2$
          geerbt sein. Es gilt dann $q_{02} \overset{x_1\dots
          x_iu}{\Rightarrow} q'\in Div_2$ für $i\geq 0$ und $u\in O^*$. Somit
          ist $x_1\dots x_iu\in\StDT{}_2$ und damit $\prune{}(x_1\dots x_iu)=
          \prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \EDT{}_2$. Also folgt,
          dass $w$ in $\EDT{}_2 \subseteq \EDL{}_2$ enthalten ist, da \DT{}
          unter \cont{} abgeschlossen ist.
      \end{itemize}
  \end{itemize}
\end{proof}

Der folgenden Satz hält fest, dass \DRel{} die gröbste Präkongruenz bezüglich
$\cdot\|\cdot$ charakterisiert, die in \DBRel{} enthalten ist.

\begin{satz}[Full Abstractness für Divergenz-Semantik]
\label{satzDivFullAbst}
  Seinen $S_1$ und $S_2$ zwei \EIO{}s mit derselben Signatur. Dann gilt $S_1
  \DCRel{} S_2\Leftrightarrow S_1\DRel{} S_2$, insbesondere ist \DRel{} eine
  Präkongruenz.
\end{satz}

\begin{proof}
  \glqq{}$\Leftarrow$\grqq{}: Nach Definition gilt $w\in\QDT{}(S)$ mit $w\in
  O^*$, genau dann wenn in $S$ ein Divergenz-Zustand, ein Ruhe-Zustand oder ein
  Error-Zustand lokal erreichbar ist. $S_1\DRel S_2$ impliziert, dass
  $w\in\QDT{}_2$ gilt, wenn $w\in\QDT{}_1$ gilt. Somit ist ein Divergenz-Zustand,
  ein Ruhe-Zustand oder ein Error-Zustand nur dann in $S_1$ lokal erreichbar,
  wenn auch ein solcher in $S_2$ lokal erreichbar ist. Daraus folgt, dass
  $S_1\DBRel S_2$ gilt. Somit ist \DRel{} in \DBRel{} enthalten. In
  Proposition~\ref{propDivPrae} wurde festgestellt, dass \DRel{} eine
  Präkongruenz ist. Da jedoch \DCRel{} nach Definition die gröbste Präkongruenz
  bezüglich $\cdot\|\cdot$ ist, die in \DBRel{} enthalten ist, muss \DRel{} in
  \DCRel{} enthalten sein. Es folgt also aus $S_1\DRel S_2$,
  dass auch der relationale Zusammenhang $S_1\DCRel S_2$ gilt.

  \glqq{}$\Rightarrow$\grqq{}: Durch die Definition von \DCRel{} als
  Präkongruenz in~\ref{DefDivBasisrel} folgt aus $S_1\DCRel{} S_2$, dass
  $U\|S_1\DCRel U\|S_2$ für alle EIOs $U$ gilt, die mit $S_1$ komponierbar sind.
  Somit folgt auch die Gültigkeit von $U\|S_1\DBRel U\|S_2$ für alle diese EIOs
  $U$. Mit Lemma~\ref{lemDivVerfeinerung} folgt dann $S_1\DRel{} S_2$.
\end{proof}

Es wurde somit, wie in den letzten beiden Kapiteln, eine Kette an Folgerungen
gezeigt, die sich zu einem Ring schließen. Jedoch ändert sich an der Begründung
für einen der Folgepfeile etwas, da in Lemma~\ref{lemDivVerfeinerung} $U$ kein
Partner mehr ist, sondern nur ein $\omega$-Partner. Diese Folgerungskette ist in
Abbildung~\ref{FolgerungsketteDiv} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        S_1\DRel S_2 & S_1\DCRel S_2 \\
        \substack{\forall~\omega\mathrm{-Partner}~U:\\U\|S_1\DBRel
        U\|S_2} & \substack{\forall~\mathrm{komponierbaren}~U:\\U\|S_1\DBRel
      U\|S_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{satzDivFullAbst}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition von \DCRel{}
          in~\ref{DefDivBasisrel}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{lemDivVerfeinerung}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
        (m-2-2) -- node [below]
        {$\substack{U~\omega\mathrm{-Partner}\\\Downarrow\\U~\mathrm{komponierbar}}$}
        (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette}
\label{FolgerungsketteDiv}
  \end{center}
\end{figure}

Aus Satz~\ref{satzDivFullAbst} und Lemma~\ref{lemDivVerfeinerung} erhält man
das folgende Korollar. Angenommen man definiert, dass $S_1$ $S_2$ verfeinern
soll, genau dann wenn für alle $\omega$-Partner \EIO{}s $U$, für die $S_2$ error-,
ruhe- und divergenz-frei mit $U$ kommuniziert, folgt, dass $S_1$ ebenfalls
error-, ruhe- und divergenz-frei mit $U$ kommuniziert. Dann wird auch diese
Verfeinerung durch \DRel{} charakterisiert.

\begin{kor}
  Es gilt: $S_1\DRel{} S_2 \Leftrightarrow U\|S_1\DBRel{} U\|S_2$ für alle
  komponierbaren $U$.
\end{kor}

Um die gröbste Präkongruenz mit den gewünschten Eigenschaften zu erhalten,
musste hier eine Änderung gegenüber~\cite{Chilton2013} vorgenommen werden. Es
musste auf die Verfeinerung der Error-Präkongruenz verzichtet werden und es
mussten auf Trace-Ebene Error und Divergenz vermischt werden.

\section{Hiding und Divergenz-Freiheit}

Da durch den Internalisierungsoperator Outputs in $\tau$s umgewandelt werden,
hat das Hiding auf die Divergenz-Eigenschaft eine recht große Auswirkung. Die
Menge der divergenten Zustände kann sich somit durch das Internalisieren
vergrößern. Es kann ein Zustand divergent werden, wenn von diesem bereits
lokal ein divergenter Zustand aus erreichbar war oder wenn er eine unendliche
Folge von Aktionen aus $X\cup\{\tau\}$ ausführen konnte, jedoch nur endlich
viele davon $\tau$s waren. Somit kann die Basisrelation für Divergenz unter
Internalisierung auf jeden Fall nicht erhalten bleiben.\\
Zusätzlich vergrößern sich durch die zusätzlichen Divergenz-Zustände alle
Trace-Mengen, die in der Präkongruenz \DRel{} betrachtet werden. Somit würde
die Untersuchung, ob die Relation erhalten bleibt unter Hiding deutlich
aufwendiger werden. Deshalb soll dies nicht mehr in dieser Arbeit betrachtet
werden.
