\chapter{Verfeinerung für Error-, Ruhe- und Divergenz-Freiheit}

\section{Präkongruenz für Divergenz}

In diesem Kapitel soll die Menge der betrachteten Zustände noch einmal
erweitert werden. Somit werden dann Error-, Ruhe- und
Divergente-Zustände betrachtet. Es eignet sich also~\cite{Chilton2013} als
Quelle, da nun auch noch die Divergenz betrachtet wird. Diese wurde dort
gleichzeitig mit der Ruhe eingeführt und betrachtet. Da es sich nur um eine
Abwandlung der Präkongruenzen aus den letzten beiden Kapiteln handeln soll, wird
in diesem Kapitel ein ähnliches Vorgehen angewendet.\\
Wie bereits oben und im letzten Kapitel erwähnt wurden in~\cite{Chilton2013}
auch noch divergente Zustände als Fehler-Zustände betrachtet. Um zu klären, was
darunter zu verstehen ist, wird nun noch eine Definition für Divergenz gegeben.

\begin{Def}[Divergenz]
  Ein \emph{Divergenz-Zustand} ist ein Zustand in einem \EIO{}, der eine
  unendliche Folge an $\tau$s ausführen kann.\\
  Die Menge $Div(S)$ besteht aus all diesen divergenten Zuständen des
  \EIO{}s $S$.
\end{Def}

Die unendliche Folge an $\tau$s kann durch eine Schleife an einem durch $\tau$s
erreichbaren Zustand ausführbar sein oder durch einen Weg, der mit $\tau$s
ausführbar ist, mit dem
unendliche viele Zustände durchlaufen werden. Es ist jedoch zu beachten, dass
ein Zustand, von dem aus unendlich viele Zustände durch $\tau$s erreichbar sind,
nicht divergent sein muss. Es ist auch möglich, dass dieser Zustand eine
unendliche Verzeigung hat und somit keine unendliche Folge an $\tau$s ausführen
kann.\\
Als Erreichbarkeitsbegriff wird wieder die lokale Erreichbarkeit verwendet.
Da das Divergieren eines Systems nicht mehr verhindert werden kann, sobald ein
divergenter Zustand lokal erreicht werden kann, ist Divergenz als ähnlich
\glqq{}schlimm\grqq{} zu bewerten wie ein Error-Zustand.

\begin{Def}[error-, ruhe- und divergenz-freie Kommunikation]
  Zwei \linebreak\EIO{}s $S_1$ und $S_2$ kommunizieren \emph{error-, ruhe- und
  divergenz-frei}, wenn in ihre Parallelkomposition $S_{12}$ keine Error-,
  Ruhe- und Divergenz-Zustände lokal erreichbar sind.
\end{Def}

\begin{Def}[Divergenz-Verfeinerungs-Basisrelation]
\label{DefDivBasisrel}
Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird $S_1\DBRel S_2$
geschrieben, wenn ein Error-, Ruhe- oder Divergenz-Zustand in $S_1$ nur
dann lokal erreichbar ist, wenn er auch in $S_2$ lokal erreichbar ist. Diese
\emph{Basisrelation} stellt eine \emph{Verfeinerung} bezüglich \emph{Error},
\emph{Ruhe} und \emph{Divergenz} dar.\\
\DCRel{} bezeichnet die \emph{vollständige abstrakte Präkongruenz} von \DBRel{}
bezüglich $\cdot\|\cdot$.
\end{Def}

Da nun die grundlegenden Definitionen für Divergenz festgehalten sind,
kann man sich einen Begriff für die Traces zu divergenten Zuständen
bilden. Da oben bereits festgestellt wurde, dass Divergenz als ähnlich
\glqq{}schlimmer Fehler\grqq{} anzusehen ist wie Error und dass das Divergieren
eines Systems nicht mehr verhinderbar ist, sobald ein divergenter Zustand lokal
erreichbar ist, kommt für die Divergenztraces wieder die $\prune$-Funktion zu
Einsatz. Ein System, das unendliche viele $\tau$s ausführen kann, ist von
außen nicht von so einem System zu unterscheiden, das einen Error-Zustand
erreicht. Somit wird in den Trace-Mengen auch nicht zwischen Errortraces und
Divergenztraces explizit unterschieden. Dadurch genügt es nicht mehr nur mit
den Errortraces die Sprache fluten, sondern es muss sowohl mit den Errortraces wie
auch den Divergenztraces geflutet werden. Ebenso werden die strikten Ruhetraces mit
diesen beiden Trace-Mengen geflutet.

\begin{Def}[Divergenztraces]
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Divergenztraces}: $\StDT{}(S) := \left\{w\in\Sigma ^*\mid
      q_0 \overset{w}{\Rightarrow} q\in Div\right\}$,
    \item \emph{gekürzte Divergenztraces}: $\PrDT{}(S) :=
      \bigcup\hspace{1pt}\left\{\prune{}(w)\mid w\in\StDT{}(S)\right\}$.
  \end{itemize}
\end{Def}

Da in~\cite{Chilton2013} bereits direkt Divergenz mit betrachtet wurde, wird
dort das Fluten der Traces so vorgenommen, dass die Errortraces in den
Divergenztraces und die Divergenztraces in den Ruhetraces enthalten sind.
Es wird dort die Error-Präkongruenz erhalten und nur durch die Inklusionen der
Divergenztraces und Ruhetraces erweitert. Dies ist aufgrund der Basisrelation
hier nicht möglich. Da hier zwischen den Errortraces und den Divergenztraces
nicht unterschieden werden soll, kann diese Inklusionskette nicht so umgesetzt
werden wie in~\cite{Chilton2013}, jedoch
entsteht durch das Fluten immer noch derselbe Effekt für die Ruhetraces. Somit
kann nur die Semantik der Menge \ET{} aus den früheren Kapiteln übernommen
werden. Jedoch wird die Menge \ET{} für den weiteren Verlauf nur innerhalb der
Trace-Menge \EDT{} relevant sein wird.

\begin{Def}[Error-, Divergenz- und Ruhe-Semantik]
\label{DefRuheDivSemantik}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Divergenztraces} von $S$ ist $\DT{}(S) :=
      \cont{}(\PrDT{}(S))$.
    \item Die Menge der \emph{Error-Divergenztraces} von $S$ ist $\EDT{}(S) :=
      \ET{}(S)\cup \DT{}(S)$.
    \item Die Menge der \emph{error-divergenz-gefluteten Ruhetraces} von $S$
      ist $\QDT{}(S) :=$\linebreak $\StQT{}(S)\cup \EDT{}(S)$.
    \item Die Menge der \emph{error-divergenz-gefluteten Sprache} von $S$ ist
      $\EDL{}(S) := L(S) \cup \EDT{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur schreibt man $S_1\DRel
  S_2$, wenn $\EDT{}_1\subseteq \EDT{}_2$, $\QDT{}_1\subseteq \QDT{}_2$ und
  $\EDL{}_1\subseteq \EDL{}_2$ gilt.
\end{Def}

In der letzten Definition wurde wieder durch das Fluten eine
Informationsvermischung vorgenommen, sowohl im Fall \QDT{} wie auch im Fall
\EDL{} mit \EDT{}, den Error-Divergenz\-traces. Da hier die Errortraces um die
Divergenztraces erweitert wurden und die error-geflutete Sprache zur
error-divergenz-gefluteten Sprache erweitert wurde, folgt dass die Relation
\DRel{} im Gegensatz zu \QRel{} keine direkte Einschränkung der Relation
\ERel{} ist. Durch die Definition der Basisrelation ist auch keine andere
Lösung möglich. Dies wird an folgendem Beispiel illustriert. Hierfür werden
die nachfolgenden Transitionssysteme benötigt:
\begin{itemize}
  \item $S_1 = \left(\{q_{01}\},\emptyset ,\emptyset , \emptyset, q_{01},
    \{q_{01}\}\right)$ (siehe auch Abbildung~\ref{S1}),
  \item $S_2 = \left(\{q_{02}\},\emptyset ,\emptyset , \{(q_{02},\tau ,q_{02})\},
    q_{02}, \emptyset \right)$ (siehe auch Abbildung~\ref{S2}).
\end{itemize}
\begin{figure}[h!tbp]
  \begin{minipage}{0.49\textwidth}
  \begin{center}
    \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
      \node (0) [rectangle, draw]{$q_{01}\in E_1$};

      \path ($ (0) + (-1.5,0) $) edge (0);
    \end{tikzpicture}
    \caption{$S_1$}
\label{S1}
  \end{center}
  \end{minipage}
  \hfill
  \begin{minipage}{0.49\textwidth}
  \begin{center}
    \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
      \node (0) [rectangle, dashed, draw]{$q_{02}\in Div_2\backslash E_2$};

      \path ($ (0) + (-1.8,0) $) edge (0)
            (0) [loop right] edge node {$\tau$} (0);
    \end{tikzpicture}
    \caption{$S_2$}
\label{S2}
  \end{center}
  \end{minipage}
\end{figure}

Der Startzustand von $S_1$ ist in der Menge $E_1$ enthalten und somit ein
Error-Zustand. Da keine unendliche $\tau$-Transitionen in $S_1$ möglich sind,
ist $q_{01}$ kein Divergenz-Zustand. Bei $S_2$ ist der Startzustand durch
die $\tau$-Schleife divergent und nicht in der Menge $E_2=\emptyset$
enthalten.\\
Somit stehen die beiden Transitionssysteme $S_1$ und $S_2$ in der
Basisrelation \DBRel{}, obwohl in $S_1$ nur ein Error-Zustand und in $S_2$ nur
ein Divergenz-Zustand jedoch kein Error-Zustand lokal erreichbar ist. Um ein analoges Lemma zu den
Lemmata~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} formulieren zu
können sollten somit auch $S_1$ und $S_2$ in der Relation \DRel{} stehen, da
ein entsprechendes $U$, die Identität (Transitionssystem aus einem
Startzustand und einer Schleife für $\omega$), gewählt werden kann. Dies
wurde in der letzten Definition bereits berücksichtigt. Es
kann also unter der Verfeinerungsrelation \DRel{} nicht unterschieden
werden, ob das System Error oder Divergenz als Fehler hat. Somit folgt also aus
$S_1\DRel{} S_2$ nicht $S_1\ERel{} S_2$, da in $S_2$ kein Error-Zustand lokal
erreichbar ist.


\begin{satz}[Error-, Ruhe- und Divergenz-Semantik für Parallelkompostionen]
\label{satzDivSemantik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition
  $S_{12}$ gilt:
  \begin{enumerate}
    \item $\EDT{}_{12}=\cont \left(\prune \left(\left(\EDT{}_1\|\EDL{}_2\right)\cup
      \left(\EDL{}_1\|\EDT{}_2\right)\right)\right)$,
    \item $\QDT{}_{12}=(\QDT{}_1\|\QDT{}_2)\cup \EDT{}_{12}$,
    \item $\EDL{}_{12}=(\EDL{}_1\|\EDL{}_2)\cup \EDT{}_{12}$.
  \end{enumerate}
\end{satz}

\begin{proof}

  1. \glqq{}$\subseteq$\grqq{}:\\
  Da beide Seiten der Gleichung unter \cont{} abgeschlossen sind, genügt es ein
  präfix-mini\-ma\-les Element $w$ zu betrachten. Es muss hier unterschieden werden, ob
  $w\in \ET{}_{12}$ oder $w\in \DT{}_{12}\backslash \ET{}_{12}$ betrachtet
  wird. Im ersten Fall ist das $w$ in der rechten Seite der Gleichung
  enthalten wegen des Beweis des ersten Punktes von
  Satz~\ref{satzErrorSemanik} und da $\ET{}(S)\subseteq \EDT{}(S)$ und
  $\EL{}(S)\subseteq \EDL{}(S)$ gilt. Deshalb wird im weiteren Verlauf dieses
  Beweises
  davon ausgegangen, dass $w\in \DT{}_{12}\backslash \ET{}_{12}$ gilt und es
  wird versucht zu zeigen, dass dieses $w$ ebenfalls in der rechten Seite
  enthalten ist. Da das betrachtete $w$ präfix-minimal ist, gilt $w\in
  \PrDT{}_{12}\backslash \ET{}_{12}$. Aus der
  Definition~\ref{DefRuheDivSemantik} weiß man, dass ein $v\in O^*_{12}$
  existiert, sodass $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)
  \overset{v}{\Rightarrow} (q_1',q_2')$ gilt mit $(q_1',q_2')\in Div_{12}$.
  Durch die Projektion auf die Transitionssysteme $S_1$ und $S_2$ erhält man
  $q_{01} \overset{w_1}{\Rightarrow} q_1 \overset{v_1}{\Rightarrow} q_1'$ und
  $q_{02} \overset{w_2}{\Rightarrow} q_2 \overset{v_2}{\Rightarrow} q_2'$ mit
  $w\in w_1\|w_2$ und $v\in v_1\|v_2$. Aus $(q_1',q_2')\in Div_{12}$ folgt,
  dass \oBdA{} $q_1'\in Div_1$ gilt, d.h.\ $w_1v_1\in \StDT{}_1\subseteq
  \EDT{}_1$. Da $q_{02} \overset{w_2v_2}{\Longrightarrow}$ gilt, erhält man
  $w_2v_2\in \EDL_2$. Somit gilt insgesamt $wv\in \EDT{}_1\|\EDL{}_2$ und da
  $v\in O_{12}^*$, ist $w$ in der rechten Seite der Gleichung enthalten und
  es folgt insgesamt $\prune{}(wv)=\prune{}(w)$.

  1. \glqq{}$\supseteq$\grqq{}:\\
  Es wird ebenso wie oben nur ein präfix-minimales $x$ betrachtet wegen des
  Abschlusses beider Seiten der Gleichung unter \cont{}. Es wird also für ein
  beliebiges $x\in\prune{}\left(\right.$ $\left.\left(\EDT{}_1\|
  \EDL{}_2\right)\cup \left(\EDL{}_1\|\EDT{}_2\right)\right)$ gezeigt, dass
  dieses oder eines seiner Präfixe auch in $\EDT{}_{12}$ enthalten ist. Da das
  $x$ aus der \prune{}-Funktion entstanden ist, lässt sich ein $y$ aus
  $O_{12}^*$ finden, sodass $xy\in (\EDT{}_1\|\EDL{}_2)\cup
  (\EDL{}_1\|\EDT{}_2)$. Es wird nun noch vorausgesetzt,
  dass \oBdA{} $xy\in \EDT{}_1\|\EDL{}_2$ gilt, d.h.\ es existieren
  $w_1\in\EDT{}_1$ und $w_2\in\EDL{}_2$ mit $xy\in w_1\|w_2$.\\
  Die folgende Argumentation läuft analog zu dem Beweis der Inklusion
  $\ET{}_{12} \supseteq \cont{}\left(\right.$ $\left.\prune{}\left(\left(\ET{}_1\|\EL_2\right)\cup
  \left(\EL{}_1\|\ET{}_2\right)\right)\right)$ aus Satz~\ref{satzErrorSemanik}. Es muss dazu nur
  jeweils an den Stellen, an denen $\PrET{}(S)\cup \MIT{}(S)$ steht auch noch eine
  Vereinigung mit $\PrDT{}(S)$ vorgenommen werden. Für Fall I und II aus dem
  Beweis der oben genannten Inklusion vom Satz~\ref{satzErrorSemanik} ist
  jeweils kein weiterer Unterfall für $v_2'$ notwendig da, wenn $v_2'$ nicht
  ausführbar ist, bereits ein Error-Zustand in der Parallelkomposition entsteht.
  Somit ist egal, ob auch noch Divergenz vorlag. Falls $v_2'$ ausführbar, ist
  nicht relevant, ob eine Divergenz-Möglichkeit bestanden hat, da diese
  nichts an der Ausführbarkeit ändert. Am Ende ist ein zusätzlicher Fall für
  $v_1\in\PrDT{}_1$ zu ergänzen:
  \begin{itemize}
    \item Fall III ($v_1\in \PrDT{}_1$): Es existiert ein $u_1$ aus $O_1^*$,
      sodass $q_{01} \overset{v_1}{\Rightarrow} q_1 \overset{u_1}{\Rightarrow}
      q_1'$ mit $q_1'\in Div_1$ gilt. Da es hier keine disjunkten Inputmengen
      gibt kann das
      $a$, auf das $v_1$ im Fall $v_1\neq \varepsilon$ endet, ebenfalls der
      letzte Buchstabe von $v_2$ sein. Im Fall von $v_2\in \MIT{}_2$ kann somit
      $a=b$ gelten und damit wäre $v_2= v_2'$. Dieser Fall verläuft jedoch
      analog zu Fall Ic) aus dem Beweis der oben gegannten Inklusition vom
      Satz~\ref{satzErrorSemanik} und wird somit hier nicht weiter betrachtet. Deshalb
      gilt für alle im folgenden betrachteten Fälle $q_{02} \overset{v_2'}{\Rightarrow}
      q_2$ mit $(q_{01},q_{02}) \overset{v'}{\Rightarrow}$.
      \begin{itemize}
        \item Fall IIIa) \Big($u_2\in (O_1\cap I_2)^*, c\in (O_1\cap I_2)$, sodass
          $u_2c$ ein Präfix von $u_1|_{I_2}$ mit $q_2
          \overset{u_2}{\Rightarrow}
          q_2'\overset{c}{\not{\hspace{-0.1cm}\rightarrow}}$\Big): Für ein Präfix
          $u_1'c$ von $u_1$ mit $u_1'c|_{I_2}= u_2c$ weiß man, dass $q_1
          \overset{u_1'}{\Rightarrow} q_1''
          \overset{c}{\hspace{-0.1cm}\rightarrow}$. Somit gilt $u_1'\in
          u_1'\|u_2$ und $(q_1,q_2) \overset{u_1'}{\Rightarrow} (q_1'',q_2')
          \in E_{12}$, da für $S_2$ der entsprechende Input fehlt, der mit dem
          Output $c$ von $S_1$ zu koppeln wäre. Es handelt sich also um einen
          neuen Error. Es wird $v:=\prune{}(v'u_1')\in \PrET{}_{12}$ gewählt,
          dies ist ein Präfix von $v'$, da $u_1\in O_1^*$.
        \item Fall IIIb) \big($q_1 \overset{u_2}{\Rightarrow} q_2'$ mit $u_2=
          u_1|_{I_2}$\big): Somit ist $u_1\in u_1\|u_2$ und $(q_1,q_2)
          \overset{u_1}{\Rightarrow} (q_1',q_2') \in Div_{12}$, da $q_1\in
          Div_1$. $S_{12}$ hat also die Divergenz von $S_1$ geerbt. Es wird nun
          $v:= \prune{}(v'u_1)\in \PrDT{}_{12}$ gewählt, das wiederum ein
          Präfix von $v'$ ist.
      \end{itemize}
  \end{itemize}

  2. \glqq{}$\subseteq$\grqq{}:\\
  Diese Inklusionsrichtung kann analog zum Beweis derselben Inklusionsrichtung
  des zweiten Punktes von Satz~\ref{satzQuiSemantik} gezeigt werden. Es muss dabei nur in der
  Argumentation die Menge $\ET{}_{12}$ durch die Menge $\EDT{}_{12}$ und die
  Mengen $\QT{}(S)$ durch die Mengen $\QDT{}(S)$ für die entsprechenden
  Transitionssysteme $S$ ersetzt
  werden. Dadurch kann ebenso gefolgert werden, dass im Fall $w\in
  \StQT{}_{12}\backslash \EDT{}_{12}$ der erreichte Zustand $(q_1,q_2)$ kein
  Error-Zustand sein kann, da $\ET{}_{12}\subseteq \EDT{}_{12}$ gilt und somit
  lässt sich auch hier der zweite Punkt von Lemma~\ref{lemRuheParallelkomp} anwenden.

  2. \glqq{}$\supseteq$\grqq{}:\\
  Es muss wieder danach unterschieden werden, aus welcher Menge das betrachtete
  Element stammt. Falls $w$ ein Element von $\EDT{}_{12}$ ist, so folgt die
  Zugehörigkeit zur linken Seite der Gleichung direkt. Somit wird für den
  weiteren Verlauf dieses Beweises davon ausgegangen, dass $w\in
  \QDT{}_1\|\QDT{}_2$ gilt. Für dieses $w$ soll dann gezeigt werden, dass es
  auch in $\QDT_{12}$ enthalten ist. Da $\QDT_i=\StQT{}_i\cup \EDT{}_i$ gilt,
  existieren für $w_1$ und $w_2$ mit $w\in w_1\|w_2$ unterschiedliche
  Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in \EDT{}_1 \vee w_2\in \EDT{}_2$): \OBdA{} gilt $w_1\in
      \EDT{}_1$. Es kann nun $w_2\in \StQT{}_2 \subseteq L_2$ gelten oder
      $w_2\in \EDT{}_2\subseteq\EDL{}_2$ und somit gilt auf jeden Fall $w_2\in
      \EDL{}_2$. Daraus kann mit dem ersten Punkt dieses Satzes gefolgert
      werden, dass $w\in \EDT{}_{12}$ gilt und somit $w$ in der linken Seite
      der Gleichung enthalten ist.
    \item Fall 2 ($w_1\in \StQT{}_1\backslash \EDT{}_1 \wedge w_2\in \StQT{}_2
      \backslash \EDT{}_2$): Dieser Fall läuft analog zu Fall 2 derselben
      Inklusionsrichtung des Beweises von Satz~\ref{satzQuiSemantik}. Hierfür
      muss die Menge $\QT{}_{12}$ durch $\QDT{}_{12}$ ersetzt werden.
  \end{itemize}

  3.:\\
  Durch die Definition~\ref{DefRuheDivSemantik} ist klar, dass $L_i\subseteq
  \EDL{}_i$ und $\EDT{}_i\subseteq \EDL{}_i$ gilt. Die
  Argumentation wird von der rechten Seite der Gleichung aus begonnen:
  {\allowdisplaybreaks
  \begin{align*}
    (\EDL{}_1\| \EDL{}_2)\cup \EDT{}_{12} &\overset{\ref{DefRuheDivSemantik}}{=}\left(\left(L_1\cup
  \EDT{}_1\right)\|\left(L_2\cup \EDT{}_2\right)\right)\cup \EDT{}_{12}\\
    &=(L_1\|L_2) \cup \underset{\overset{1.}{\subseteq} \EDT{}_{12}}{\underset{\subseteq
    (\EDL{}_1\|\EDT{}_2)}{\underbrace{(L_1\|\EDT{}_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \EDT{}_{12}}{\underset{\subseteq
    (\EDT{}_1\|\EDL{}_2)}{\underbrace{(\EDT{}_1\|L_2)}}} \\
    &\quad\quad\cup \underset{\overset{1.}{\subseteq}
    \EDT{}_{12}}{\underset{\subseteq
    (\EDL{}_1\|\EDT{}_2)}{\underbrace{(\EDT{}_1\|\EDT{}_2)}}} \cup \EDT{}_{12}\\
    &=(L_1\|L_2) \cup \EDT{}_{12}\\
    &\overset{\ref{LemmaSprache}}{=}L_{12}\cup \EDT{}_{12}\\
    &\overset{\ref{DefRuheDivSemantik}}{=}\EDL{}_{12}.
\end{align*}}
\end{proof}

Analog wie in den beiden vorgegangenen Kapiteln, ergibt sich aus diesem Satz
als direkte Folgerung, dass es sich bei der Relation \DRel{} um eine
Präkongruenz handelt.

\begin{kor}[Divergenz-Präkongurenz]
\label{propDivPrae}
  Die Relation \DRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{kor}

\begin{proof}
  Um zu zeigen, dass es sich bei \DRel{} um eine Präkongruenz handelt, muss
  nachgewiesen werden, dass aus $S_1\DRel{} S_2$  auch
  $S_{31}\DRel{} S_{32}$ für jedes komponierbare System $S_3$ folgt.  D.h.\ es ist
  zu zeigen, dass aus $\EDT{}_1\subseteq \EDT{}_2$, $\QDT{}_1\subseteq
  \QDT{}_2$ und $\EDL{}_1\subseteq \EDL{}_2$, sowohl $\EDT{}_{31}\subseteq
  \EDT_{32}$, $\QDT{}_{31}\subseteq \QDT{}_{32}$ als auch $\EDL{}_{31}\subseteq
  \EDL{}_{32}$ folgt. Dies ergibt sich, wie in den Beweisen zu den
  Korollaren~\ref{propPraekongruenz} und~\ref{propQuiPrae}, aus der
  Monotonie von \cont{}, \prune{} und $\cdot\|\cdot$ auf Sprachen wie folgt:
  \begin{itemize}
    \item $\begin{aligned}[t]
        \EDT{}_{31} &\overset{\ref{satzDivSemantik}~1.}{=}
        \cont{}\left(\prune{}\left(\left(\EDT{}_3\|\EDL{}_1\right) \cup
        \left(\EDL{}_3\|\EDT{}_1\right)\right)\right)\\
        &\hspace{-0.6cm}\overset{\EDT{}_1\subseteq
      \EDT{}_2}{\overset{\mathrm{und}}{\overset{\EDL{}_1\subseteq
    \EDL{}_2}{\subseteq}}}
    \cont{}\left(\prune{}\left(\left(\EDT{}_3\|\EDL{}_2\right) \cup
        \left(\EDL{}_3\|\EDT{}_2\right)\right)\right)\\
      &\overset{\ref{satzDivSemantik}~1.}{=} \EDT{}_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QDT{}_{31} &\overset{\ref{satzDivSemantik}~2.}{=} (\QDT{}_3\|\QDT{}_1)
        \cup \EDT{}_{31}\\
        &\hspace{-0.8cm}\overset{\EDT{}_{31}\subseteq
      \EDT{}_{32},}{\overset{\mathrm{und}}{\overset{\QDT{}_1\subseteq
      \QDT{}_2}{\subseteq}}} (\QDT{}_3\|\QDT{}_2) \cup \EDT{}_{32}\\
      &\overset{\ref{satzDivSemantik}~2.}{=} \QDT{}_{32}.
    \end{aligned}$
    \item $\begin{aligned}[t]
        \EDL{}_{31} &\overset{\ref{satzDivSemantik}~3.}{=} (\EDL{}_3\|\EDL{}_1)
        \cup \EDT{}_{31}\\
        &\hspace{-0.8cm}\overset{\EDT{}_{31}\subseteq
      \EDT{}_{32},}{\overset{\mathrm{und}}{\overset{\EDL{}_1\subseteq
      \EDL{}_2}{\subseteq}}} (\EDL{}_3\|\EDL{}_2) \cup \EDT{}_{32}\\
      &\overset{\ref{satzDivSemantik}~3.}{=} \EDL{}_{32}.
    \end{aligned}$
  \end{itemize}
\end{proof}

Als nächstes soll nun eine Verfeinerungsrelation bezüglich guter Kommunikation
von Transitionssystemen im Sinne von error-, ruhe- und divergenz-freier
Kommunikation betrachtet werden. Es muss in diesem Lemma eine Veränderung zu
den analogen Lemmata aus den vorangegangen Kapiteln vorgenommen werden. Die
Einschränkung, dass $U$ ein Partner sein muss, kann nicht mehr beibehalten
werden, da die Strategie zur Vermeidung von Ruhe im Beweis aus dem letzten
Kapitel hier zu Divergenz führen würde. Somit werden für die Ruhe-Vermeidung in
diesem Kapitel Aktionen außerhalb der Menge $\Synch$
benötigt. Jedoch müssen trotzdem nicht alle komponierbaren \EIO{}s $U$ betrachtet
werden. Es kann eine Einschränkung gemacht werden, sodass $U$ fast ein
Partner ist. Zur Vereinfachung von umständlichen Formulierungen im Folgenden wird hierfür
nun ein neuer Begriff definiert.

\begin{Def}[\boldmath$\omega$-Partner]
  Ein \EIO{} $S_1$ ist ein \emph{$\omega$-Partner} von einem \EIO{} $S_2$, wenn
  $I_1=O_2$ und $O_1=I_2\cup\{\omega\}$ mit $\omega\notin I_2\cup O_2$ gilt.
\end{Def}

Ein $\omega$-Partner $S_1$ von $S_2$ unterscheidet sich von einem Partner von
$S_2$ nur um den Output $\omega$, der nicht in der Menge $\Synch(S_1,S_2)$
enthalten ist.

\begin{lem}[Verfeinerung mit Divergenz-Zuständen]
\label{lemDivVerfeinerung}
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  $U\|S_1\DBRel{} U\|S_2$ für alle $\omega$-Partner $U$ gilt, dann folgt daraus
  $S_1\DRel{} S_2$.
\end{lem}

\begin{proof}
  Da davon ausgegangen wird, dass $S_1$ und $S_2$ die gleiche Signatur haben,
  definiert man $I:=I_1=I_2$ und $O:=O_1=O_2$. Für jeden $\omega$-Partner $U$
  gilt $I_U=O$ und $O_U=I\cup\{\omega\}$ mit $\omega\notin I\cup O$.\\
  Um zu zeigen, dass die Relation $S_1\DRel S_2$ gilt, müssen die folgenden
  Punkte nachgewiesen werden:
  \begin{itemize}
    \item $\EDT{}_1\subseteq \EDT{}_2$,
    \item $\QDT{}_1\subseteq \QDT{}_2$,
    \item $\EDL{}_1\subseteq \EDL{}_2$.
  \end{itemize}
  In den Lemmata~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} wurde
  bereits etwas Ähnliches gezeigt. Jedoch kann draus aufgrund der unterschiedlichen
  Basisrelation, die zur Anwendung kommen, nichts über dieses Lemma und dessen
  Gültigkeit ausgesagt werden. Es kann in diesem Lemma, ebenso wie
  in Lemma~\ref{lemQuiVerfeinerung}, aus der lokalen Erreichbarkeit eines
  Error-Zustandes in
  $S_1'$ und dem Zusammenhang von $S_1'\DBRel S_2'$ nur
  geschlossen werden, dass in $S_2'$ auch ein Fehler lokal erreichbar ist,
  jedoch kann dieser Fehler hier ein Error-Zustand, ein Ruhe-Zustand oder ein
  divergenter Zustand sein. Analog verhält es sich, wenn in $S_1'$ ein
  Divergenz-Zustand oder ein Ruhe-Zustand lokal erreichbar ist.

  Als Erstes wird der erste Beweispunkt gezeigt, also die Inklusion
  $\EDT{}_1\subseteq \EDT{}_2$.\\
  Es wird für ein präfix-minimales $w$ aus $\EDT{}_1$ gezeigt, dass dieses
  $w$ oder eines seiner Präfixe in $\EDT{}_2$ enthalten ist. Diese Möglichkeit
  bietet sich, da beide Mengen unter \cont{} abgeschlossen sind.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Error- oder Divergenz-Zustand in $S_1$. Für $U$ wird ein Transitionssystem
      verwendet, das nur aus dem Startzustand und einer Schleife für alle
      Inputs $x\in I_U$ und einer Schlinge für $\omega$ besteht. Somit kann
      $S_1$ im Prinzip die gleichen Error-Zustände bzw. Divergenz-Zustände wie
      $U\|S_1$ lokal erreichen. Draus folgt, dass auch $U\|S_2$ einen lokal
      erreichbaren Fehler haben muss, da $U\|S_1\DBRel U\|S_2$ gilt. Durch die
      Struktur von $U$ ist in einer Parallelkomposition mit $U$ kein
      Ruhe-Zustand möglich. Der Fehler, der in $U\|S_2$ lokal erreichbar ist,
      muss also ein Error- oder Divergenz-Zustand sein. Da von $U$ kein Error
      und keine Divergenz geerbt werden kann und durch die Inputschleife auch
      kein neuer Error enstehen kann, muss der Fehler von $U_2$ geerbt sein.
      Somit gilt also, dass in $S_2$ ein Error- oder Divergenz-Zustand lokal
      erreichbar ist. Da $\EDT{}(S) = \ET{}(S)\cup \DT{}(S)$ gilt, folgt
      $w\in \EDT{}_2$.
    \item Fall 2 ($w=x_1\dots x_nx_{n+1}\in\Sigma{} ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgende $\omega$-Partner $U$ betrachtet
      (siehe auch Abbildung~\ref{UohneEmitO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_{n+1}\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i\leq n\}\\
                      &\cup\{(q_i,x,q_{n+1})\mid  x\in I_U\backslash\{x_{i+1}\},
          0\leq i\leq n\}\\
          &\cup\{(q_{n+1},x,q_{n+1})\mid  x\in I_U\}\\
          &\cup\{(q_i,\omega ,q_{n+1})\mid 0\leq i\leq n+1\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$q_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$q_{n+1}$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                    !$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \omega !$} (n1)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (n1)
                (n) edge node [above, sloped] {$x?\in I_U, \omega !$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U, \omega !$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UohneEmitO}
      \end{center}
      \end{figure}
      Die Mengen der Divergenz- und Ruhe-Zustände des hier betrachteten $U$s
      sind leer. Da im Vergleiche zum Transitionssystem in
      Abbildung~\ref{UohneE} nur die $\omega$-Transitionen zu $q_{n+1}$ ergänzt
      wurden, ändert sich nichts an dem Fall 2a) im ersten Punkt des Beweises
      von Lemma~\ref{lemVerfeinerung}. In Fall 2b) muss die Menge
      $O^*$ durch $(O\cup \{\omega\})^*$ ersetzt werden. Die Begründungen,
      wieso in den beiden Fällen $\varepsilon\in \PrET{}(U\|S_1)$ gilt, bleibt
      also analog zum Beweis von Lemma~\ref{lemVerfeinerung}. Da nun aber auch
      Divergenz betrachtet wird, muss ein weiterer Fall ergänzt werden:
      \begin{itemize}
        \item Fall 2c) ($w\in\PrDT{}_1$): In $U\|S_1$ erhält man $(q_0,q_{01})
          \overset{w}{\Rightarrow} (q_{n+1},q'') \overset{u}{\Rightarrow}
          (q_{n+1},q')$ für $u\in (O\cup \{\omega\})^*$ und $q'\in Div_1$.
          Daraus folgt $(q_{n+1},q')\in Div_{U\|S_1}$ und somit $wu\in
          \StDT{}(U\|S_1)$. Da alle Aktionen aus $w$ synchronisiert werden und
          $I_U\cap I_1 = \emptyset$ gilt
          $x_1,\dots ,x_n,x_{n+1}\in O_{U\|S_1}$. Da zusätzlich $u$ in $(O\cup
          \{\omega\})^*$ enthalten ist, folgt $u\in O_{U\|S_1}^*$. Somit ergibt sich
          $\varepsilon\in \PrDT{}(U\|S_1)$.
      \end{itemize}
      Da $\varepsilon$ in $\PrET{}(U\|S_1)\cup \PrDT{}(U\|S_1)$ enthalten
      ist, kann mit der Relation\linebreak $U\|S_1\DBRel U\|S_2$ geschlossen werden, dass
      in $U\|S_2$ ein Fehler lokal erreichbar sein muss. Durch die
      $\omega$-Transitionen an den Zuständen von $U$ kann es in Komposition mit
      $U$ keine Ruhe-Zustände geben. Der Fehler muss also Error oder Divergenz
      sein.
      \begin{itemize}
        \item Fall 2i) ($\varepsilon\in\ET{}(U\|S_2)$ wegen neuem Error): Da
          jeder Zustand von $U$ alle Inputs $x\in I_U=O$ zulässt, muss ein
          lokal erreichbarer Error-Zustand der Form sein, dass ein Output $a\in
          O_U\backslash\{\omega\}$ von $U$ möglich ist, der nicht mit einem
          passenden Input aus $S_2$ synchronisiert werden kann. Durch die
          Konstruktion von $U$ ist in $q_{n+1}$ kein Output außer $\omega$
          möglich. Ein neuer Error muss also die Form $(q_i,q')$ haben mit
          $i\leq n, q' \overset{x_{i+1}}{\not{\hspace{-0.2cm}\longrightarrow}}$ und
          $x_{i+1}\in O_U\backslash\{\omega\}$. Durch Projektion erhält man
          dann $q_{02} \overset{x_1\dots x_i}{\xRightarrow{\hspace{0.9cm}}} q'
          \overset{x_{i+1}}{\not{\hspace{-0.2cm}\longrightarrow}}$ und damit gilt
          $x_1\dots x_{i+1}\in \MIT{}_2\subseteq \ET{}_2$. Somit ist ein Präfix
          von $w$ in $\EDT{}_2$ enthalten.
        \item Fall 2ii) ($\varepsilon\in\ET{}(U\|S_2)$ wegen geerbtem Error):
          $U$ hat $x_1\dots x_iu$ ausgeführt mit $u\in (O\cup\{\omega\})^*$ und
          ebenso hat $S_2$ den Weg $x_1\dots x_iu|_{\Sigma _2}$ ausgeführt.
          Durch dies hat $S_2$ einen Zustand aus $E_2$ erreicht, da von $U$
          kein Error geerbt werden kann. Es gilt dann $\prune{}(x_1\dots
          x_iu|_{\Sigma _2})= \prune{}(x_1\dots x_i)\in\PrET{}_2\subseteq
          \ET{}_2$. Da $x_1\dots x_i$ ein Präfix von $w$ ist, führt in diesem
          Fall eine Verlängerung um lokale Aktionen von einem
          Präfix von $w$ zu einem Error-Zustand. Da $\ET$ der Menge aller
          Verlängerungen von gekürzten Errortraces entspricht, ist $x_1\dots x_i$ in
          $\EDT{}_2$ enthalten und somit ist ein Präfix von $w$ in $\EDT{}_2$
          enthalten.
        \item Fall 2iii) ($\varepsilon\in \DT{}(U\|S_2)\backslash
          \ET{}(U\|S_2)$): Da $U$ nicht unendliche viele Zustände hat und auch
          keine $\tau$-Schleifen besitzt, kann das Divergenzverhalten nur von
          $S_2$ geerbt sein. $U$ hat $x_1\dots x_iu$ ausgeführt mit $u\in
          (O\cup \{\omega\})^*$ und ebenso hat $S_2$ den Weg $x_1\dots
          x_iu|_{\Sigma _2}$ ausgeführt. Durch dies hat $S_2$ einen Zustand aus
          $Div_2$ erreicht. Es gilt dann $\prune{}(x_1\dots x_iu|_{\Sigma
          _2}) = \prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \DT{}_2$, da
          $u|_{\Sigma _2}$ in $O^*$ enthalten ist. Da $x_1\dots x_i$ ein Präfix
          von $w$ ist, führt in diesem Fall eine Verlängerung um lokale
          Aktionen von einem Präfix von $w$ zu einem divergenten Zustand. Da
          $\DT$ die Menge aller Verlängerungen von gekürzten Divergenztraces
          ist und $\DT{}_2\subseteq \EDT{}_2$ gilt, ist in diesem Fall das
          Präfix $x_1\dots x_i$ von $w$ in $\EDT{}_2$ enthalten.
      \end{itemize}
  \end{itemize}

  Als nächstes wird nun der zweite Beweispunkt gezeigt, d.h.\ die Inklusion
  $\QDT{}_1\subseteq \QDT{}_2$. Diese Inklusion kann jedoch noch, analog zum
  Beweis der Inklusion der error-gefluteten Sprachen aus dem Error-Kapitel,
  weiter eingeschränkt werden. Da bereits bekannt ist, dass $\EDT{}_1\subseteq
  \EDT{}_2$ gilt, muss nur noch $\StQT{}_1\backslash \EDT{}_1\subseteq
  \QDT{}_2$ gezeigt werden.\\
  Es wird ein $w\in \StQT{}_1\backslash\EDT{}_1$ gewählt und gezeigt, dass
  dieses auch in $\QDT{}_2$ enthalten ist.\\
  Durch die Wahl des $w$s wird vom Startzustand von $S_1$ durch das Wort $w$
  ein ruhiger Zustand erreicht. Dies hat nur Auswirkungen auf die
  Parallelkomposition $U\|S_1$, wenn in $U$ ebenfalls ein Ruhe-Zustand durch
  $w$ erreichbar ist.\\
  Das betrachtete $w$ hat also die Form $w=x_1\dots x_n\in \Sigma ^*$ mit
  $n\geq 0$. Es wird der folgende $\omega$-Partner $U$ betrachtet (siehe auch
  Abbildung~\ref{UohneEmitIundO}):
  \begin{itemize}
    \item $Q_U=\{q_0,q_1,\dots ,q_n, q\}$,
    \item $q_{0U}=q_0$,
    \item $E_U=\emptyset$,
    \item $\begin{aligned}[t]
        \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i< n\}\\
                  &\cup\{(q_i,x,q)\mid  x\in (I_U\cup
      \{\omega\})\backslash\{x_{i+1}\}, 0\leq i< n\}\\
                  &\cup\{(q_n,x,q)\mid x\in I_U\}\\
                  &\cup\{(q,x,q)\mid x\in I_U\cup\{\omega\}\}.
    \end{aligned}$
  \end{itemize}
  \begin{figure} [h!tbp]
  \begin{center}
    \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
      \node (0) {$q_0$};
      \node (1) [right of=0] {$q_1$};
      \node (dots) [right of=1] {$\dots$};
      \node (n) [right of=dots, rectangle, dotted, draw] {$q_n\in Qui_U$};
      \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$q$};

      \path ($ (0) + (-1,0) $) edge (0)
            (0) edge node {$x_1$} (1)
                edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                !$} (q)
            (1) edge node {$x_2$} (dots)
                edge [below, sloped] node {$x?\neq x_2, \omega !$} (q)
            (dots) edge node {$x_n$} (n)
                   edge [dashed] (q)
            (n) edge [bend left] node [below,sloped] {$x?\in I_U$} (q)
            (q) edge [loop below] node {$x?\in I_U, \omega !$} (q);
    \end{tikzpicture}
    \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$, $q_n$
      ist der einzige Ruhe-Zustand}
\label{UohneEmitIundO}
  \end{center}
  \end{figure}
  Falls für das betrachtete $w$ dem leeren Wort $\varepsilon$ entspricht, reduziert sich der
  $\omega$-Partner $U$ auf den Zustand $q_n =q_0$ und den Zustand $q$. Es ist
  also in diesem Fall der Startzustand gleich dem ruhigen Zustand.\\
  Allgemein ist der Zustand $q_n$ aus $U$ der einzige ruhige Zustand in $U$.
  Es gilt wegen des erstem Punktes von Lemma~\ref{lemRuheParallelkomp}, dass
  auch in der Parallelkomposition $U\|S_1$ ein Ruhe-Zustand mit $w$ erreicht
  wird. Da es sich bei allen in $w$ befindlichen Aktionen um synchronisierte
  Aktionen handelt und $I_U\cap I=\emptyset$, folgt $w\in O_{U\|S_1}^*$ und
  $w\in \StQT{}(U\|S_1)$. Es kann also in der Parallelkomposition durch $w$
  ein Ruhe-Zustand lokal erreicht werden. Da $w\notin \EDT{}_1$, kann
  auf dem Weg, der mit $w$ im Transitionssystem $S_1$ zurück gelegt wird,
  kein Error- oder Divergenz-Zustand lokal erreicht werden. Es kann also
  weder von $S_1$ noch von $U$ Error oder Divergenz auf diesem Weg geerbt
  werden oder neu entstehen. Da ein Ruhe-Zustand in $U\|S_1$ lokal
  erreichbar ist, muss auch ein Fehler in $U\|S_2$ lokal erreichbar sein.
  Hier kann jedoch zunächst keine Aussage darüber getroffen werden, ob das
  $w$ ausführbar ist und ob es sich bei dem Fehler um Error, Ruhe oder
  Divergenz handelt.
  \begin{itemize}
    \item Fall a) ($\varepsilon\in \ET{}(U\|S_2)$): Der lokal erreichbare
      Fehler ist ein Error-Zustand. Das $w$ muss somit nicht ausführbar sein. Der
      Error kann sowohl von $S_2$ geerbt sein, wie durch fehlende
      Synchronisations-Möglichkeiten als neuer Error in der
      Parallelkomposition entstanden sein. Da nur auf dem Trace $w$ in $U$
      Synchronisations-Fehler möglich sind und wegen den Fällen 2i) und
      2ii) des ersten Punktes von diesem Beweis ist ein Präfix von $w$
      in $\EDT{}_2$ enthalten. Da die Menge \EDT{} unter \cont{}
      abgeschlossen ist, gilt auch $w\in \EDT{}_2 \subseteq \QDT{}_2$.
    \item Fall b) ($\varepsilon\in \DT{}(U\|S_2)\backslash
      \ET{}(U\|S_2)$): Es handelt sich bei dem lokal erreichbaren Fehler um
      Divergenz. Der Fehler muss von $S_2$ geerbt sein, da $U$ keine
      Divergenz-Möglichkeiten hat. Es gilt also, dass bereits in $S_2$ ein
      Präfix von $w$ in $\EDT{}_2$ enthalten ist, wegen Fall 2iii) des
      Beweises des ersten Punktes aus diesem Lemma. Mit dem Abschluss unter
      \cont{} folgt, dass auch $w\in \EDT{}_2\subseteq \QDT{}_2$ gilt.
    \item Fall c) (Ruhe-Zustand lokal erreichbar in $U\|S_2$ und
      $\varepsilon\notin \EDT{}(U\|S_2)$): Da in $U$ nur durch $w$ ein
      ruhiger Zustand erreicht werden kann, muss es sich bei dem lokal
      erreichbaren Ruhe-Zustand in $U\|S_2$ um einen handeln, der mit $w$
      erreicht werden kann. Mit dem zweiten Punkt von
      Lemma~\ref{lemRuheParallelkomp} kann somit gefolgert werden, dass auch in
      $S_2$ ein Ruhe-Zustand mit $w$ erreichbar sein muss, da
      $\ET{}(U\|S_2)\subseteq \EDT{}(U\|S_2)$ ist. Es gilt also $w\in
      \StQT{}_2\subseteq \QDT{}_2$.
  \end{itemize}

  Nun wird mit dem letzten Punkt des Beweises begonnen. Analog
  wie in den Beweisen zu den Lemmata~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} ist
  hier jedoch aufgrund der bereits geführten Beweisteile nur noch
  $L_1\backslash \EDT{}_1\subseteq \EDL{}_2$ zu zeigen. Es wird also für ein
  beliebig gewähltes $w\in L_1\backslash \EDT{}_1$ gezeigt, dass es auch in
  $\EDL{}_2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Analog zu den Lemmata~\ref{lemVerfeinerung}
      und~\ref{lemQuiVerfeinerung} gilt auch hier, dass $\varepsilon$ immer in
      $\EDL{}_2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Die Konstruktion des
      $\omega$-Partners $U$ weicht nur durch die $\omega$-Transition vom
      Transitionssystem aus dem Beweis der Inklusion der error-gefluteten Sprache \EL{} aus
      Lemma~\ref{lemVerfeinerung} ab. Der $\omega$-Partner $U$ ist dann
      wie folgt definiert (siehe dazu auch Abbildung~\ref{UmitEundO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_n,q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\{q_n\}$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid 0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid x\in I_U\backslash\{x_{i+1}\},0\leq
          i < n\}\\
          &\cup\{(q_i,\omega ,q)\mid 0\leq i\leq n\}\\
          &\cup\{(q,x ,q)\mid x\in I_U\cup \{\omega\}\}.
              \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$q_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$q_n\in E_U$};
          \node (q) at ($(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \omega
                    !$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \omega !$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                       edge [dashed] (q)
                (n1) edge node {$x_n$} (n)
                     edge node [below, sloped] {$x?\neq x_n, \omega !$} (q)
                (q) edge [loop below] node {$x?\in I_U, \omega !$} (q)
                (n) edge [bend left] node {$\omega !$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$, $q_n$
          ist der einzige Error-Zustand}
\label{UmitEundO}
      \end{center}
      \end{figure}
      Durch die $\omega$-Transitionen an den Zuständen wird wie oben vermieden,
      dass es in einer Komposition mit $U$ und auch in $U$ selbst Ruhe-Zustände
      geben kann. Da $q_{01} \overset{w}{\Rightarrow} q_1'$ gilt, kann man schließen,
      dass $U\|S_1$ einen lokal erreichbaren geerbten Error hat. Somit muss
      $U\|S_2$ ebenfalls einen lokal erreichbaren Fehler haben. Wie oben
      bereits erwähnt, kann es sich bei dem Fehler nicht um Ruhe handeln.
      \begin{itemize}
        \item Fall 2a) \big(neuer Error aufgrund von $x_i\in O_U\backslash
          \{\omega\}$ und $q_{02} \overset{x_1\dots
          x_{i-1}}{\xRightarrow{\hspace{1cm}}} q_2'
          \overset{x_i}{\not{\hspace{-0.1cm}\rightarrow}}$\big): Es gilt $x_1\dots
          x_i\in \MIT{}_2$ und somit $w\in\EDL{}_2$. Anzumerken ist, dass nur
          auf diesem Weg Outputs von $U$ aus der Menge $\Synch (S_2,U)$ möglich sind, deshalb gibt
          es keine anderen Outputs von $U$, die zu einem neuen Error führen
          könnten.
      \end{itemize}
      Die restlichen Fälle sind analog zu Lemma~\ref{lemVerfeinerung} möglich.
      Somit gilt für alle Fälle (2a) bis 2d)), dass $w$ in $\EDL{}_2$ enthalten
      ist, da $\EL{}_2\subseteq \EDL{}_2$ gilt.
      \begin{itemize}
        \item Fall 2e) (Divergenz und kein neuer Error): Da $U$ keine
          Möglichkeit hat zu divergieren, muss diese Möglichkeit von $S_2$
          geerbt sein. Es gilt dann $q_{02} \overset{x_1\dots
          x_iu}{\xRightarrow{\hspace{1cm}}} q'\in Div_2$ für $i\geq 0$ und $u\in O^*$. Somit
          ist $x_1\dots x_iu\in\StDT{}_2$ und damit $\prune{}(x_1\dots x_iu)=
          \prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \EDT{}_2$. Also folgt,
          dass $w$ in $\EDT{}_2 \subseteq \EDL{}_2$ enthalten ist, da \DT{}
          unter \cont{} abgeschlossen ist.
      \end{itemize}
  \end{itemize}
\end{proof}

Der folgenden Satz hält fest, dass \DRel{} die gröbste Präkongruenz bezüglich
$\cdot\|\cdot$ charakterisiert, die in \DBRel{} enthalten ist.

\begin{satz}[Vollstänige Abstraktheit für Divergenz-Semantik]
\label{satzDivFullAbst}
  Seinen $S_1$ und $S_2$ zwei \EIO{}s mit derselben Signatur. Dann gilt $S_1
  \DCRel{} S_2\Leftrightarrow S_1\DRel{} S_2$.
\end{satz}

\begin{proof}
  \glqq{}$\Leftarrow$\grqq{}: Nach Definition gilt $w\in\QDT{}(S)$ mit $w\in
  O(S)^*$ genau dann, wenn in $S$ ein Divergenz-, Ruhe- oder Error-Zustand
  lokal erreichbar ist. $S_1\DRel S_2$ impliziert, dass
  $w\in\QDT{}_2$ gilt, wenn $w\in\QDT{}_1$ gilt. Somit ist ein Divergenz-,
  Ruhe- oder Error-Zustand nur dann in $S_1$ lokal erreichbar,
  wenn auch ein solcher in $S_2$ lokal erreichbar ist. Daraus folgt, dass
  $S_1\DBRel S_2$ gilt. Es ist also \DRel{} in \DBRel{} enthalten. In
  Korollar~\ref{propDivPrae} wurde festgestellt, dass \DRel{} eine
  Präkongruenz ist. Da jedoch \DCRel{} nach Definition~\ref{DefDivBasisrel} die gröbste Präkongruenz
  bezüglich $\cdot\|\cdot$ ist, die in \DBRel{} enthalten ist, muss \DRel{} in
  \DCRel{} enthalten sein. Es folgt also aus $S_1\DRel S_2$,
  dass auch der Zusammenhang $S_1\DCRel S_2$ gilt.

  \glqq{}$\Rightarrow$\grqq{}: Durch die Definition von \DCRel{} als
  Präkongruenz in~\ref{DefDivBasisrel} folgt aus $S_1\DCRel{} S_2$, dass
  $U\|S_1\DCRel U\|S_2$ für alle EIOs $U$ gilt, die mit $S_1$ komponierbar sind.
  Da \DCRel{} nach Definition in \DBRel{} enthalten ist, folgt auch die
  Gültigkeit von $U\|S_1\DBRel U\|S_2$ für alle diese EIOs $U$. Mit
  Lemma~\ref{lemDivVerfeinerung} folgt dann $S_1\DRel{} S_2$.
\end{proof}

Es wurde somit, wie in den letzten beiden Kapiteln, eine Kette an Folgerungen
gezeigt, die sich zu einem Ring schließen. Jedoch ändert sich an der Begründung
für einen der Folgepfeile etwas, da in Lemma~\ref{lemDivVerfeinerung} $U$ kein
Partner mehr ist, sondern nur ein $\omega$-Partner. Diese Folgerungskette ist in
Abbildung~\ref{FolgerungsketteDiv} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        S_1\DRel S_2 & S_1\DCRel S_2 \\
        \substack{\forall~\omega\mathrm{-Partner}~U:\\U\|S_1\DBRel
        U\|S_2} & \substack{\forall~\mathrm{komponierbaren}~U:\\U\|S_1\DBRel
      U\|S_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{satzDivFullAbst}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition von \DCRel{}
          in~\ref{DefDivBasisrel}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{lemDivVerfeinerung}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
        (m-2-2) -- node [below]
        {$\substack{U~\omega\mathrm{-Partner}\\\Downarrow\\U~\mathrm{komponierbar}}$}
        (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette}
\label{FolgerungsketteDiv}
  \end{center}
\end{figure}

Angenommen man definiert, dass $S_1$ $S_2$ verfeinern
soll genau dann, wenn für alle $\omega$-Partner \EIO{}s $U$ für die $S_2$ error-,
ruhe- und divergenz-frei mit $U$ kommuniziert, folgt, dass $S_1$ ebenfalls
error-, ruhe- und divergenz-frei mit $U$ kommuniziert. Dann wird auch diese
Verfeinerung durch \DRel{} charakterisiert.\\
Aus Satz~\ref{satzDivFullAbst} und Lemma~\ref{lemDivVerfeinerung} erhält man
das folgende Korollar.

\begin{kor}
  Es gilt: $S_1\DRel{} S_2 \Leftrightarrow U\|S_1\DBRel{} U\|S_2$ für alle
  komponierbaren $U$.
\end{kor}

Um die gröbste Präkongruenz mit den gewünschten Eigenschaften zu erhalten,
wurde hier eine Änderung gegenüber~\cite{Chilton2013} vorgenommen. Es
war nötig auf die Verfeinerung der Error-Präkongruenz zu verzichtet und es
mussten auf Trace-Ebene Error und Divergenz vermischt werden.\\
Falls man eine Basisrelation definieren würde, die unterscheiden kann, ob es
sich um Error oder Divergenz handelt, könnte man die hier erhaltenen
Ergebnisse so verändern, dass sie dem Ansatz entsprechen würden
den~\cite{Chilton2013} verwendet hat. Es wäre also möglich, dass man nicht nur
die Basisrelation \DBRel{} als erfüllt voraussetzt, sondern zusätzlich auch
noch die Basisrelation \EBRel{}. Somit wäre garantiert, dass man die beiden
Systeme $S_1$ (siehe dazu Abbildung~\ref{S1}) und $S_2$ (siehe dazu
Abbildung~\ref{S2}) aus dem Beispiel oben unter der Verfeinerungsrelation
unterscheiden könnte. Die Definition für die zu verwendende Basisrelation
müsste dann wie folgt lauten.

\begin{Def}[alternative Divergenz-Verfeinerungs-Basisrelation]
  Für\linebreak zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird $S_1\DBaRel{}
  S_2$ geschrieben, wenn ein Error-Zustand in $S_1$ nur dann lokal erreichbar
  ist, wenn er auch in $S_2$ lokal erreichbar ist und wenn ein Divergenz- oder
  Ruhe-Zustand in $S_1$ nur dann lokal erreichbar ist, wenn auch in $S_2$ ein
  Error-, Divergenz- oder Ruhe-Zustand lokal erreichbar ist. Diese
  \emph{alternative Basisrelation} stellt ebenfalls eine Verfeinerung bezüglich
  \emph{Error}, \emph{Ruhe} und \emph{Divergenz} dar.\\
  \DCaRel{} bezeichnet die \emph{alternative vollständig abstrakte
  Präkongruenz} von \DBaRel{} bezüglich $\cdot\|\cdot$.
\end{Def}

Die Relation \DBaRel{} ist somit die Vereinigung der Relationen \EBRel{} und
\DBRel{}. Die Forderung von \DBRel{} für die lokale Erreichbarkeit von
Error-Zuständen in $S_1$ wird bereits durch die stärkere Forderung von \EBRel{}
für die lokale Erreichbarkeit von Error-Zuständen erfüllt und
wurde deshalb in der obigen Definition nicht explizit aufgeführt. Die Relation
\DCaRel{} könnte dann durch die im folgenden definierte Relation charakterisiert
werden.

\begin{Def}[alternative Charakterisierung der volltändig abstrakten\linebreak Präkonrugenz]
  Für zwei \EIO{}s $S_1$, $S_2$ mit der gleichen Signatur schreibt
  man\linebreak
  $S_1\DaRel{} S_2$, wenn $S_1 \ERel{} S_2$, $\EDT{}_1\subseteq
  \EDT{}_2$ und $\QDT{}_1\subseteq \QDT{}_2$ gilt.
\end{Def}

Diese Charakterisierung \DaRel{} entspricht dem Ansatz
aus~\cite{Chilton2013}. Dadurch wird jedoch Error im vergleich zu Divergenz als
\glqq{}schlimmerer Fehler\grqq{} aufgefasst. Es ergibt sich also aus der Definitionen
eine echte Hierarchie zwischen den Fehler. Man erkennt nicht sofort, dass auch
die Mengeninklusion $\EDL{}_1\subseteq \EDL{}_2$ gilt, die benötigt wird, damit \DaRel{} die
Vereinigung von \ERel{} und \DRel{} ist. Diese Inklusion, muss in der
Definition jedoch nicht explizit aufgeführt werden, da sie aus den geforderten
Inklusionen bereits folgt. Durch $S_1 \ERel{} S_2$ weiß man, dass $\EL_1
\subseteq \EL_2$ gilt. Die Menge \EL{} ist
nach Definition die Vereinigung aus der Sprache $L$ und den Errortraces \ET{}.
Somit fehlt nur noch die Divergenztraces \DT{}, um daraus die Menge \EDL{} zu
erhalten. Jedoch ist durch die Inklusion $\EDT_1\subseteq \EDT{}_2$
bereits klar, dass $\ET{}_1\cup \DT{}_1 \subseteq \ET{}_2\cup \DT{}_2$ gilt.
Insgesamt folgt dann die Gleichung $\EDL = \EL \cup \EDT$. Falls sich eine
der beiden Mengen \EL{} bzw. \EDT{} vergrößert, vergrößert sich auch die Menge
\EDL{} echt. Somit ist also \DaRel{} die Vereinigung von \ERel{} und \DRel{}.

\newpage

\section{Hiding und Divergenz-Freiheit}

Da durch den Internalisierungsoperator Outputs in $\tau$s umgewandelt werden,
hat das Hiding auf die Divergenz-Eigenschaft im Vergleich zu den Eigenschaften
aus den beiden vorangegangenen Kapiteln deutlich großere Auswirkungen. Die
Menge der divergenten Zustände kann sich durch das Internalisieren
vergrößern. Es kann ein Zustand divergent werden, wenn von diesem bereits
lokal ein divergenter Zustand aus erreichbar war oder wenn er eine unendliche
Folge von Aktionen aus $X\cup\{\tau\}$ ausführen konnte, jedoch nur endlich
viele davon $\tau$s waren. Somit ist es nicht möglich, dass die Basisrelation
für Divergenz unter Internalisierung erhalten bleibt.\\
Außerdem vergrößern sich durch die zusätzlichen Divergenz-Zustände alle
Trace-Mengen, die in der Präkongruenz \DRel{} betrachtet werden. Somit würde
die Untersuchung, ob die Relation erhalten bleibt, unter Hiding deutlich
aufwendiger werden. Deshalb soll dies nicht mehr in dieser Arbeit betrachtet
werden.
