\chapter{Verfeinerung für Error-, Ruhe- und Divergenz-Freiheit}

\section{Präkongruenz für Divergenz}

In diesem Kapitel soll die Menge der betrachteten Zustände noch einmal
erweitert werden. Somit werden dann Errors, Ruhe-Zustände und
Divergente-Zustände betrachtet. Es eignet sich also~\cite{Chilton2013} als
Quelle, da nun auch noch die Divergenz betrachtet wird. Diese wurde dort
gleichzeitig mit der Ruhe eingeführt und betrachtet. Da es sich nur um eine
Erweiterung der Präkongruenzen aus den letzten beiden Kapiteln handeln soll, wird
dabei ähnlich vorgegangen wie in den letzten beiden Kapiteln.\\
Wie bereits oben und im letzten Kapitel erwähnt wurden in~\cite{Chilton2013}
auch noch divergente Zustände als Fehler-Zustände betrachtet. Um zu klären, was
darunter verstanden wird, wird nun noch eine Definition für Divergenz gegeben.

\begin{Def}[Divergenz]
  Ein \emph{Divergenz-Zustand} ist ein Zustand in einem \EIO{}, der eine
  unendliche Folge an $\tau$s ausführen kann.%\\
  % Somit ist die Menge der Divergenz-Zustände in einem \EIO{} wie folgt formal
  % definiert: $Div := \{q\in Q\mid \forall i\in \mathbb{N}\; \exists q_i\in Q: q
  % \overset{\tau}{\Rightarrow} q_i~\mathrm{und}~\forall j\in N\backslash \{i\}:
  % q_i\neq q_j\}$.
\end{Def}

Die unendliche Folge an $\tau$s kann durch eine Schleife ausführbar sein, oder
durch einen Weg, der mit $\tau$s ausführbar ist, mit dem
unendliche viele Zustände durchlaufen werden. Es ist jedoch zu beachten, dass
ein Zustand, von dem aus unendlich viele Zustände durch $\tau$s erreichbar sind,
nicht divergent sein muss. Es ist auch möglich, dass dieser Zustand eine
unendliche Verzeigung hat und somit keine unendliche Folge an $\tau$s ausführen
kann.\\
Als Erreichbarkeitsbegriff wird wieder die lokale Erreichbarkeit verwendet.
Da das Divergieren eines Systems nicht mehr verhindert werden kann, sobald ein
divergenter Zustand lokal erreichbar ist, ist Divergenz als ähnlich
\glqq{}schlimm\grqq{} zu bewerten wie ein Error.

\begin{Def}[error-, ruhe- und divergenz-freie Kommunikation]
  Zwei \EIO{}s $S_1$ und $S_2$ kommunizieren \emph{error-, ruhe- und
  divergenz-frei}, wenn in ihre Parallelkomposition $S_{12}$ keine Errors,
  Ruhe-Zustände und Divergenz-Zustände lokal erreichbar sind.
\end{Def}

\begin{Def}[Divergenz-Verfeinerungs-Basisrelation]
\label{DefDivBasisrel}
Für \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur wird $S_1\DBRel S_2$
geschrieben, wenn ein Error, Ruhe-Zustand oder Divergenz-Zustand in $S_1$ nur
dann lokal erreichbar ist, wenn er auch in $S_2$ lokal erreichbar ist. Diese
\emph{Basisrelation} stellt eine \emph{Verfeinerung} bezüglich \emph{Error},
\emph{Ruhe} und \emph{Divergenz} dar.\\
\DCRel{} bezeichnet die \emph{vollständige abstrakte Präkongruenz} von \DBRel{}
bezüglich $\cdot\|\cdot$.
\end{Def}

Da nun die grundlegenden Definitionen für Divergenz festgehalten sind,
kann man sich nun einen Begriff für die Traces zu divergenten Zuständen
bilden. Da oben bereits festgehalten wurde, dass Divergenz als ähnlich
\glqq{}schlimmer\grqq{} Fehler anzusehen ist, wie Error und dass das Divergieren
eines Systems nicht mehr verhinderbar ist, sobald ein divergenter Zustand
erreichbar ist, kommt für die Divergenztraces wieder die $\prune$-Funktion zu
Einsatz. Da jedoch nur die Präkongruenz aus dem Error-Kapitel weiter verfeinert
werden soll, sollen keine neuen Traces entstehen, die nicht bereits in \EL{}
enthalten sind. Es kann also nicht möglich sein abgeschnittene Traces beliebig
Fortzusetzen. Deshalb wird hier die Menge der Fortgesetzten Traces durch einen
Schnitt mit der error-gefluteten Sprache \EL{} wieder auf die Traces
eingeschränkt, die bereits vorhanden sind.

\begin{Def}[Divergenztraces]
  Sei $S$ ein \EIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Divergenztraces}: $\StDT{}(S) := \{w\in\Sigma ^*\mid
      q_0 \overset{w}{\Rightarrow} q\in Div\}$,
    \item \emph{gekürzte Divergenztraces}: $\PrDT{}(S) :=
      \bigcup\{\prune{}(w)\mid w\in\StDT{}(S)\}$.
  \end{itemize}
\end{Def}

Da in~\cite{Chilton2013} bereits direkt Divergenz mit betrachtet wurde, wird
dort die Flutung der Traces so vorgenommen, dass $\ET\subseteq \DT\subseteq
\QT$ gilt. Dies soll auch hier in diesem Kapitel erreicht werden. Somit kann
zwar die Semantik aus dem Error-Kapitel übernommen werden, jedoch wird für die
Ruhe eine andere Semantik benötigt, die sich von der im letzten Kapitel
unterscheidet. Die Inklusionskette der Fehlertraces passt auch von der
Hierarchie her auf die Bewertung, als wie kritisch die einzelnen
Fehler für die Kommunikation zu bewerten sind.

\begin{Def}[Ruhe- und Divergenz-Semantik]
\label{DefRuheDivSemantik}
  Sei $S$ ein \EIO{}.
  \begin{itemize}
    \item Die Menge der \emph{error-gefluteten Divergenztraces} von $S$ ist\\
      $\DT{}(S) := (\cont{}(\PrDT{}(S))\cap \EL{}(S))\cup \ET{}(S)$.
    \item Die Menge der \emph{divergenz-gefluteten Ruhetraces} von $S$ ist\\
      $\QT{}(S) := \StQT{}(S)\cup \DT{}(S)$.
  \end{itemize}
  Für zwei \EIO{}s $S_1, S_2$ mit der gleichen Signatur schreibt man $S_1\DRel
  S_2$, wenn $S_1\ERel S_2$, $\DT{}_1\subseteq \DT{}_2$ und
  $\QT{}_1\subseteq \QT{}_2$ gilt.
\end{Def}

In der letzten Definition wurde wieder durch das Fluten eine
Informationsvermischung vorgenommen. Im Fall von \DT{} mit den Errortraces und
im Fall von \QT{} mit den Divergenztraces. Jedoch entstehen hier wie im letzten
Kapitel keine neuen Traces, die nicht bereits in der error-gefluteten Sprache
\EL{} aus den Error-Kapitel enthalten wären. Somit kann diese Sprache ohne
weitere Flutung verwendet werden. Es folgt, dass die Relation \DRel{} ebenso
wie \QRel{} eine Einschränkung der Relation \ERel{} ist.\\
Ebenso wie in Satz~\ref{satzQuiSemantik} wird im nächsten Satz nur der
Vollständigkeit halber der erste und letzte Punkt erwähnt der Beweis dazu
findet sich in Satz~\ref{satzErrorSemanik}.

\begin{satz}[Error-, Ruhe- und Divergenz-Semantik für Parallelkompostionen]
\label{satzDivSemantik}
  Für zwei komponierbare \EIO{}s $S_1, S_2$ und ihre Komposition
  $S_{12}$ gilt:
  \begin{enumerate}
    \item $\ET{}_{12}=\cont (\prune ((\ET{}_1\|\EL{}_2)\cup
      (\EL{}_1\|\ET{}_2)))$,
    \item $\DT{}_{12}= (\cont{}(\prune{}((\DT{}_1\|\EL{}_2)\cup
      (\EL{}_1\|\DT{}_2)))\cap \EL_{12})\cup \ET{}_{12}$,
    \item $\QT{}_{12}=(\QT{}_1\|\QT{}_2)\cup \DT{}_{12}$,
    \item $\EL{}_{12}=(\EL{}_1\|\EL{}_2)\cup \ET{}_{12}$.
  \end{enumerate}
\end{satz}

\begin{proof} Es wird hier nur der 2.\ und 3.\ Punkt bewiesen.

  2. \glqq{}$\subseteq$\grqq{}:\\
  Da beide Seiten unter \cont{} im Schnitt mit \EL{} abgeschlossen sind, genügt
  es ein präfix-minimales Element $w$ zu betrachten. Es muss hier unterschieden, ob $w\in
  \PrDT{}_{12}\backslash \ET{}_{12}$ oder $w\in \ET{}_{12}$ betrachtet wird. Im
  zweiten Fall ist das $w$ in der rechten Seite der Gleichung enthalten.
  Deshalb wird im weiteren Verlauf dieses Beweises davon ausgegangen, dass
  $w\in \PrDT{}_{12}\backslash \ET{}_{12}$ gilt, und es wird versucht zu
  zeigen, dass dieses $w$ ebenfalls in der rechten Seite enthalten ist. Aus der
  Definition~\ref{DefRuheDivSemantik} weiß man, dass ein $v\in O^*_{12}$
  existiert, so dass $(q_{01},q_{02}) \overset{w}{\Rightarrow} (q_1,q_2)
  \overset{v}{\Rightarrow} (q_1',q_2')$ mit $(q_1',q_2')\in Div_{12}$ gilt.
  Durch die Projektion auf die Transitionssysteme $S_1$ und $S_2$ erhält man
  $q_{01} \overset{w_1}{\Rightarrow} q_1 \overset{v_1}{\Rightarrow} q_1'$ und
  $q_{02} \overset{w_2}{\Rightarrow} q_2 \overset{v_2}{\Rightarrow} q_2'$ mit
  $w\in w_1\|w_2$ und $v\in v_1\|v_2$. Aus $(q_1',q_2')\in Div_{12}$ folgt,
  dass \oBdA{} $q_1'\in Div_1$ gilt, d.h.\ $w_1v_1\in \StDT{}_1\subseteq
  \DT{}_1$. Da $q_{02} \overset{w_2v_2}{\Rightarrow}$ gilt, erhält man
  $w_2v_2\in \EL_2$. Somit gilt insgesamt $wv\in \DT{}_1\|\EL{}_2$ und $w$ ist
  in der rechten Seite der Gleichung enthalten, da $v\in O_{12}^*$ gilt und
  somit $\prune{}(wv)=\prune{}(w)$.

  2. \glqq{}$\supseteq$\grqq{}:\\
  Es wird ebenso wie oben nur ein präfix-minimales $w$ betrachtet wegen den
  Abschlusses beider Seiten unter \cont{} im Schnitt mit \EL{}. Falls
  $w\in\ET{}_{12}$ gilt, ist dieses $w$ auch
  in der linken Seite der Gleichung enthalten. Somit wird für den Rest des
  Beweises dieser Inklusion davon ausgegangen, dass
  $w\in\prune{}((\DT{}_1\|\EL{}_2)\cup (\EL{}_1\|\DT{}_2))$ gilt. Dadurch lässt
  sich ein $v$ aus $O_{12}^*$ finden, sodass $wv\in (\DT{}_1\|\EL{}_2)\cup
  (\EL{}_1\|\DT{}_2)$ gilt. Es wird nun noch die Einschränkung vorausgesetzt,
  dass \oBdA{} $wv\in \DT{}_1\|\EL{}_2$ gilt, d.h.\ es existieren
  $w_1v_1\in\DT{}_1$ und $w_2v_2\in\EL{}_2$ mit $w\in w_1\|w_2$ und $v\in
  v_1\|v_2$.
  \begin{itemize}
    \item Fall 1 ($w_1v_1\in \ET{}_1 \vee w_2v_2\in \ET{}_2$): \OBdA{} gilt
      $w_1v_1\in\ET{}_1$. Es kann sich nun bei $w_2v_2$ um ein Error-,
      Divergenz-, Ruhe- oder um ein ausführbares Trace aus dem
      Transitionssystem handeln, es gilt jedoch in jedem Fall $w_2v_2\in\EL{}_2$.
      Somit kann der erste Punkt von Satz~\ref{satzErrorSemanik} angewendet
      werden und es folgt damit, dass $w\in\ET{}_{12}$ gilt und $w$ deshalb in
      der linken Seite der Gleichung enthalten ist.
    \item Fall 2 ($w_1v_1\in (\cont{}(\PrDT{}_1)\cap \EL_1)\backslash \ET{}_1
      \wedge w_2\in \EL{}_2\backslash \ET{}_2$): Es gilt in diesem Fall, dass
      ein Präfix $w_1'$ von $w_1v_1$ und ein $u\in O_1^*\subseteq O_{12}^*$
      existiert mit $q_{01} \overset{w_1'}{\Rightarrow} q_1
      \overset{u}{\Rightarrow} q_1'\in Div_1$ und $q_{02}
      \overset{w_2'}{\Rightarrow} q_2$ mit $w_2'$ das entsprechende Präfix von
      $w_2v_2$ das parallel zu $w_1'$ ausgeführt wird. An dieser Stelle kann
      nichts darüber gesagt werden, wie sich $S_2$ verhält, wenn $S_1$ das $u$
      ausführt.
      \begin{itemize}
        \item Fall 2a) \Big($q_2 \overset{u|_{\Sigma
          _2}}{\not{\hspace{-0.1cm}\Rightarrow}}$\Big): $S_2$ hat also nicht die
          Möglichkeit das $u$ gemeinsam mit $S_1$ auszuführen, es kommt also zu
          einem Kommunikationsfehler in der Parallelkomposition. Es existiert
          ein Präfix $t$ von $u|_{\Sigma _2}$ mit $w_2't\in\MIT{}_2$. Somit
          folgt insgesamt, da $v$ und $u$ in $O_{12}^*$ enthalten sind und
          \ET{} unter \cont{} abgeschlossen ist, dass $w\in\ET{}_{12}$ gilt.
          Das $w$ ist also in der linken Seite der Gleichung enthalten.
        \item Fall 2b) \big($q_2 \overset{u|_{\Sigma _2}}{\Rightarrow}
          q_2'$\big): Da
          $q_1'$ ein unendliche Folge an $\tau$s ausführen kann, ist dies auch
          für den zusammengesetzten Zustand von $q_1'$ und $q_2'$ in der
          Parallelkomposition möglich. Es gilt also für die Komposition
          $(q_{01},q_{02}) \overset{w'}{\Rightarrow} (q_1,q_2)
          \overset{u}{\Rightarrow} (q_1',q_2')\in Div_{12}$ und somit ist $w'u$
          mit $w'\in w_1'\|w_2'$ in $\StDT{}_{12}$ enthalten. Durch die
          parallel Ausführung von $u$ und $u|_{\Sigma _2}$ entstehen nur
          Outputs und es gilt auch $u\in u\|u|_{\Sigma _2}$. Es folgt also,
          dass $w'\in\PrDT{}_{12}$ gilt und da $w'$ ein Präfix von $w\in
          w_1\|w_2 \in \EL{}_1\|\EL{}_2$ ist und \DT{} unter \cont{} in den
          Traces der error-gefluteten Sprache \EL{} des Transitionssystems
          abgeschlossen ist dass $w\in\DT{}_{12}$ gilt.
      \end{itemize}
  \end{itemize}

  3. \glqq{}$\subseteq$\grqq{}:\\
  Diese Inklusionsrichtung kann analog zum Beweis der selben Inklusionsrichtung
  von Satz~\ref{satzQuiSemantik} gezeigt werden. Es muss dabei nur in der
  Argumentation die Menge $\ET{}_{12}$ durch die Menge $\DT{}_{12}$ ersetzt
  werden. Dadurch kann ebenso gefolgert werden, dass der erreichte Zustand
  $(q_1,q_2)$ kein Error-Zustand sein kann, da $\ET{}_{12}\subseteq \DT{}_{12}$
  gilt.

  3. \glqq{}$\supseteq$\grqq{}:\\
  Es muss wieder danach unterschieden werden, aus welcher Menge das betrachtete
  Element stammt. Falls $w$ ein Element von $\DT{}_{12}$ ist, so folgt die
  Zugehörigkeit zur linken Seite der Gleichung direkt. Somit wird für den
  weiteren Punkt dieses Beweises davon ausgegangen, dass $w\in \QT{}_1\|\QT_2$
  gilt. Für dieses $w$ soll dann gezeigt werden, dass es auch in $\QT_{12}$
  enthalten ist. Da $\QT_i=\StQT{}_i\cup \DT{}_i$ gilt, existieren für $w_1$
  und $w_2$ mit $w\in w_1\|w_2$ unterschiedliche Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in \DT{}_1 \vee w_2\in \DT{}_2$): \OBdA{} gilt $w_1\in
      \DT{}_1$. Es kann nun $w_2\in \StQT{}_2 \subseteq L_2$ gelten oder
      $w_2\in \DT{}_2\subseteq\EL{}_2$ und somit gilt auf jeden Fall $w_2\in
      \EL{}_2$. Daraus kann mit dem zweiten Punkt dieses Satzes gefolgert
      werden, dass $w\in \DT{}_{12}$ gilt und somit $w$ in der linken Seite der
      Gleichung enthalten ist.
    \item Fall 2 ($w_1\in \StQT{}_1\backslash \DT{}_1 \wedge w_2\in \StQT{}_2
      \backslash \DT{}_2$): Dieser Fall läuft analog zu Fall 2 der selben
      Inklusionsrichtung des Beweises von Satz~\ref{satzQuiSemantik}.
  \end{itemize}
\end{proof}

Analog wie in den beiden vorgegangenen Kapiteln, ergibt sich aus diesem Satz
als direkte Folgerung, dass es sich bei der Relation \DRel{} um eine
Präkongruenz handelt.

\begin{prop}[Divergenz-Präkongurenz]
\label{propDivPrae}
  \DRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{prop}

\begin{proof}
  Um zu zeigen, dass es sich bei \DRel{} um eine Präkongruenz handelt, muss
  nachgewiesen werden, dass $S_{31}\DRel{} S_{32}$ für jedes komponierbare
  System $S_3$ gilt, wenn $S_1\DRel{} S_2$ erfüllt ist.  D.h.\ es ist
  zu zeigen, dass auch $S_1\ERel{} S_2$, $\DT{}_1\subseteq \DT{}_2$ und
  $\QT{}_1\subseteq \QT{}_2$ sowohl $S_{31}\ERel{} S_{32}$,
  $\DT{}_{31}\subseteq \DT_{32}$ als auch $\QT{}_{31}\subseteq \QT{}_{32}$
  folgt. Dies ergibt sich wie in den Beweisen zu den
  Propositionen~\ref{propPraekongruenz} und~\ref{propQuiPrae} aus der Monotonie
  von $\cdot\|\cdot$ auf Sprachen wie folgt:
  \begin{itemize}
    \item $\begin{aligned}[t]
        S_{31}
        \overset{\mathrm{Proposition}~\ref{propPraekongruenz}}{%
        \overset{\mathrm{und}}{\overset{S_1\ERel{} S_2}{\ERel{}}}} S_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \DT{}_{31} &\overset{\ref{satzDivSemantik}~2.}{=}
        (\cont{}(\prune{}((\DT{}_3\|\EL{}_1) \cup (\EL{}_3\|\DT{}_1)))\cap
        \EL_{31}) \cup \ET{}_{31}\\
        &\hspace{-0.5cm}\overset{\ET{}_{31}\subseteq
      \ET{}_{32},}{\overset{\EL{}_{31}\subseteq
        \EL{}_{32},}{\overset{\EL{}_1\subseteq
      \EL{}_2}{\overset{\mathrm{und}}{\overset{\DT{}_1\subseteq
  \DT{}_2}{\subseteq}}}}} (\cont{}(\prune{}((\DT{}_3\|\EL{}_2) \cup
  (\EL{}_3\|\DT{}_2)))\cap \EL_{32}) \cup \ET{}_{32}\\
      &\overset{\ref{satzDivSemantik}~2.}{=} \DT{}_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QT{}_{31} &\overset{\ref{satzDivSemantik}~3.}{=} (\QT{}_3\|\QT{}_1)
        \cup \DT{}_{31}\\
        &\hspace{-0.5cm}\overset{\DT{}_{31}\subseteq
      \DT{}_{32},}{\overset{\mathrm{und}}{\overset{\QT{}_1\subseteq
      \QT{}_2}{\subseteq}}} (\QT{}_3\|\QT{}_2) \cup \DT{}_{32}\\
      &\overset{\ref{satzDivSemantik}~3.}{=} \QT{}_{32}.
    \end{aligned}$
  \end{itemize}
\end{proof}

Als nächstes soll nun eine Verfeinerungsrelation bezüglich guter Kommunikation
von Transitionssystemen im Sinne von error-, ruhe- und divergenz-freier
Kommunikation betrachtet werden. Es muss in diesem Lemma eine Veränderung zu
den analogen Lemmata aus den vorangegangen Kapiteln vorgenommen werden. Die
Einschränkung, dass $U$ ein Partner sein muss, kann nicht mehr beibehalten
werden, da die Strategie zur Vermeidung von Ruhe im Beweis aus dem letzten
Kapitel hier zu Divergenz führen würde. Somit werden für die Ruhe-Vermeidung in
diesem Kapitel Aktionen außerhalb der Menge $Synch$
benötigt. Jedoch müssten trotzdem nicht alle komponierbaren $U$ betrachtet
werden. Es kann eine Einschränkung gemacht werden, so dass $U$ fast ein
Partner ist. Um die Formulierungen im folgenden zu Vereinfachen, wird hierfür
nun ein neuer Begriff definiert.

\begin{Def}[fast Partner]
  Ein \EIO{} $S_1$ ist ein \emph{fast Partner} von einem \EIO{} $S_2$, wenn
  $I_1=O_2$ und $O_1=I_2\cup\{o\}$ mit $o\notin I_2\cup O_2$ gilt.
\end{Def}

Ein fast Partner $S_1$ von $S_2$ unterscheidet sich von einem Partner von $S_2$
nur um den Output $o$, der nicht in der Menge $Synch(S_1,S_2)$ enthalten ist.

\begin{lem}[Vereinerung mit Divergenz-Zuständen]
\label{lemDivVerfeinerung}
  Gegeben sind zwei \EIO{}s $S_1$ und $S_2$ mit der gleichen Signatur. Wenn
  $U\|S_1\DBRel{} U\|S_2$ für alle fast Partner $U$ gilt, dann folgt daraus
  $S_1\DRel{} S_2$.
\end{lem}

\begin{proof}
  Da davon ausgegangen wird, dass $S_1$ und $S_2$ die gleiche Signatur haben,
  definiert man $I:=I_1=I_2$ und $O:=O_1=O_2$. Für jeden fast Partner $U$ gilt
  $I_U=O$ und $O_U=I\cup\{o\}$ mit $o\notin I\cup O$.\\
  Um zu zeigen, dass die Relation $S_1\DRel S_2$ gilt, müssen die folgenden
  Punkte nachgewiesen werden:
  \begin{itemize}
    \item $S_1\ERel S_2$,
    \item $\DT{}_1\subseteq \DT{}_2$,
    \item $\QT{}_1\subseteq \QT{}_2$.
  \end{itemize}
  In den Lemmata~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} wurde
  bereits etwas Ähnliches gezeigt. Jedoch kann Aufgrund der unterschiedlichen
  Basisrelation, die zur Anwendung kommen nichts über dieses Lemma und dessen
  Gültigkeit ausgesagt werden. Es kann also in diesem Lemma eben so wie
  in~\ref{lemQuiVerfeinerung} aus der lokalen Erreichbarkeit eines Errors in
  $S_1'$ und dem relationalen Zusammenhang von $S_1'\DBRel S_2'$ nur
  geschlossen werden, dass in $S_2'$ auch ein Fehler lokal erreichbar ist,
  jedoch kann dieser Fehler hier ein Error, ein Ruhe-Zustand oder ein
  divergenter Zustand sein. Analog verhält es sich, wenn in $S_1'$ ein
  Divergenz-Zustand oder ein Ruhe-Zustand lokal erreichbar ist.\\
  Es muss also für den ersten Punkt folgendes nachgewiesen werden:
  \begin{itemize}
    \item $\ET{}_1\subseteq \ET{}_2$,
    \item $\EL{}_1\subseteq \EL{}_2$.
  \end{itemize}
  Es wird nun damit begonnen, den ersten Unterpunkt des ersten Beweispunktes zu
  zeigen, d.h.\ es wird unter der Voraussetzung, dass $U\|S_1\DBRel U\|S_2$
  gilt, gezeigt, dass $\ET{}_1\subseteq \ET{}_2$ gilt. Da beide \ET{}-Mengen
  unter \cont{} abgeschlossen sind, reicht es ein präfix-minimales Element
  $w\in\ET{}_1$ zu betrachten und zu zeigen, dass dieses $w$ oder eines seiner
  Präfixe in $\ET{}_2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Error in $S_1$. Für $U$ wird ein Transitionssystem verwendet, das nur aus
      dem Startzustand, einer Schleife für alle Inputs $x\in I_U$ und einer
      Schleife für $o$ besteht. Somit kann $S_1$ die im Prinzip gleichen
      Error-Zustände lokal erreichen wie $U\|S_1$. Es folgt also, dass in
      $U\|S_2$ ein Fehler lokal erreichbar ist. Es kann sich bei dem Fehler
      um einen Error oder \textcolor{red}{Divergenz} handeln, da es in der
      Komposition mit $U$ keine Ruhe-Zustände geben kann.
      \begin{itemize}
        \item Fall 1a) ($\varepsilon\in\ET{}(U\|S_2)$): Da $U$ keinen
          Error-Zustand und auch keine fehlenden Input-Möglichkeiten enthält,
          kann der Error nur von $S_2$ geerbt sein. Somit muss in $S_2$ ein
          Error-Zustand lokal erreichbar sein, d.h.\ es gilt $\varepsilon\in
          \PrET{}_2\subseteq \ET{}_2$.
        \textcolor{red}{\item Fall 1b)
            ($\varepsilon\in\DT{}(U\|S_2)\backslash\ET{}(U\|S_2)$): Da $U$ nicht
            unendliche viele Zustände hat und auch keine $\tau$-Schleifen
            besitzt, kann das divergenz Verhalten nur von $S_2$ geerbt sein. Es
            muss also in $S_2$ ein Divergenz-Zustand lokal erreichbar sein und
          somit gilt $\varepsilon\in\PrDT{}_2\subseteq \DT{}_2$.\lightning}
      \end{itemize}
    \item Fall 2 ($w=x_1\dots x_nx_{n+1}\in\Sigma{} ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgende fast Partner $U$ betrachtet (siehe
      auch Abbildung~\ref{UohneEmitO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_{n+1}\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i\leq n\}\\
                      &\cup\{(q_i,x,q_{n+1})\mid  x\in I_U\backslash\{x_{i+1}\},
          0\leq i\leq n\}\\
          &\cup\{(q_{n+1},x,q_{n+1})\mid  x\in I_U\}\\
          &\cup\{(q_i,o,q_n+1)\mid 0\leq i\leq n+1\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$q_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$q_{n+1}$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, o!$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, o!$} (n1)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (n1)
                (n) edge node [above, sloped] {$x?\in I_U, o!$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U, o!$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UohneEmitO}
      \end{center}
      \end{figure}
      Die Mengen der Divergenz- und Ruhe-Zustände des hier betrachteten $U$s
      sind leer. Da im Vergleiche zum Transitionssystem in
      Abbildung~\ref{UohneE} nur die $o$-Transitionen zu $q_{n+1}$ ergänzt
      wurden, ändert sich nichts an den Fällen 2a) und 2b). Die Begründungen,
      wieso in den beiden Fällen $\varepsilon\in \PrET{}(U\|S_1)$ gilt bleibt
      also analog zum Beweis von Lemma~\ref{lemVerfeinerung}. Durch die
      $o$-Transitionen wurde, genau wie im letzten Fall, nur erreicht, dass in
      einer Parallelkomposition mit $U$ keine Ruhe-Zustände möglich sind. Es
      kann also auch hier aus der lokalen Erreichbarkeit eines Errors
      in $U\|S_1$ auf die lokale Erreichbarkeit eines Errors oder
      \textcolor{red}{Divergenz-Zustandes} in $U\|S_2$ geschlossen werden.
      \begin{itemize}
        \item Fall 2a) ($\varepsilon\in\ET{}(U\|S_2)$):
          \begin{itemize}
            \item Fall 2a)i) (neuer Error): Da jeder Zustand von $U$ alle
              Inputs $x\in I_U=O$ zulässt, muss ein lokal erreichbarer Error der
              Form sein, dass ein Output $a\in O_U\backslash\{o\}$ von $U$
              möglich ist, der nicht mit einem passenden Input aus $S_2$
              synchronisiert werden kann. Durch die Konstruktion von $U$ ist in
              $q_{n+1}$ kein Output außer $o$ möglich. Ein neuer Error muss
              also die Form $(q_i,q')$ haben mit $i\leq n, q'
              \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und
              $x_{i+1}\in O_U\backslash\{o\}$. Durch Projektion erhält man dann
              $q_{02} \overset{x_1\dots x_i}{\Rightarrow} q'
              \overset{x_{i+1}}{\not{\hspace{-0.1cm}\rightarrow}}$ und damit
              gilt $x_1\dots x_{i+1}\in \MIT{}_2\subseteq \ET{}_2$. Somit ist
              ein Präfix von $w$ in $\ET{}_2$ enthalten.
            \item Fall 2a)ii) (geerbter Error): $U$ hat $x_1\dots x_iu$
              ausgeführt mit $u\in (O\cup\{o\})^*$ und ebenso hat $S_2$ den
              Weg $x_1\dots x_iu|_{\Sigma _2}$ ausgeführt. Durch dies hat $S_2$ einen
              Zustand aus $E_2$ erreicht, da von $U$ kein Error geerbt werden
              kann. Es gilt dann $\prune{}(x_1\dots x_iu|_{\Sigma _2})=
              \prune{}(x_1\dots x_i)\in\PrET{}_2\subseteq \ET{}_2$. Da
              $x_1\dots x_i$ ein Präfix von $w$ ist, führt auch in diesem Fall
              ein Präfix von $w$ zu einem Error.
          \end{itemize}
        \textcolor{red}{\item Fall 2b) ($\varepsilon\in\DT{}(U\|S_2)\backslash\ET{}(U\|S_2)$):
          Da $U$ nicht unendliche viele Zustände hat und auch keine
          $\tau$-Schleifen besitzt, kann das divergenz Verhalten nur von $S_2$
          geerbt sein. $U$ hat $x_1\dots x_iu$ ausgeführt mit $u\in (O\cup
          \{o\})^*$ und ebenso hat $S_2$ den Weg $x_1\dots x_iu|_{\Sigma _2}$
          ausgeführt. Durch dies hat $S_2$ einen Zustand aus $Div_2$
          erreicht. Es gilt dann $\prune{}(x_1\dots x_iu|_{\Sigma
          _2})\prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \DT{}_2$, da
          $u|_{\Sigma _2}$ in $O^*$ enthalten ist. Da $x_1\dots x_i$ ein Präfix
          von $w$ ist, führt in diesem Fall ein Präfix von $w$ zu einem
        divergenten Zustand.\lightning}
      \end{itemize}
  \end{itemize}

  Nun wird mit dem zweiten Unterpunkt des ersten Beweispunktes begonnen. Genau
  wie in den Beweisen zu~\ref{lemVerfeinerung} und~\ref{lemQuiVerfeinerung} ist
  hier jedoch auf Grund des bereits geführten Beweisteils nur noch
  $L_1\backslash \ET{}_1\subseteq \EL{}_2$ zu zeigen. Es wird also für ein
  beliebig gewähltes $w\in L_1\backslash \ET{}_1$ gezeigt, dass es auch in
  $\EL{}_2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Ebenso wie in~\ref{lemVerfeinerung}
      und~\ref{lemQuiVerfeinerung} gilt auch hier, dass $\varepsilon$ immer in
      $\EL{}_2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Die Konstruktion des fast
      Partners $U$ weicht wie im letzten Beweisteil nur durch die
      $o$-Transition im Transitionssystems vom Beweis zu
      Lemma~\ref{lemVerfeinerung} ab. Somit ist der fast Partner $U$ dann wie
      folgt definiert (siehe dazu auch Abbildung~\ref{UmitEundO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_n,q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\{q_n\}$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid 0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid x\in I_U\backslash\{x_{i+1}\},0\leq
          i < n\}\\
          &\cup\{(q_i,o ,q)\mid 0\leq i\leq n\}\\
          &\cup\{(q,x ,q)\mid x\in I_U\cup \{o\}\}.
              \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$q_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$q_n\in E_U$};
          \node (q) at ($(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, o!$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, o!$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                       edge [dashed] (q)
                (n1) edge node {$x_n$} (n)
                     edge node [below, sloped] {$x?\neq x_n, o!$} (q)
                (q) edge [loop below] node {$x?\in I_U, o!$} (q)
                (n) edge [bend left] node {$o!$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$, $q_n$
          ist der einzige Error-Zustand}
\label{UmitEundO}
      \end{center}
      \end{figure}
      Durch die $o$-Transitionen an den Zuständen wird wie oben vermieden, dass
      es in einer Komposition mit $U$ und auch in $U$ selbst Ruhe-Zustände
      gibt. Da $q_{01} \overset{w}{\Rightarrow} q_1'$ gilt, kann man schließen,
      dass $U\|S_1$ einen lokal erreichbaren geerbten Error hat. Somit muss
      $U\|S_2$ ebenfalls einen lokal erreichbaren Fehler haben. Wie oben
      bereits erwähnt, kann es sich bei dem Fehler nicht um Ruhe handeln.
      \begin{itemize}
        \item Fall 2a) (neuer Error aufgrund von $x_i\in O_U\backslash\{o\}$
          und $q_{02} \overset{x_1\dots x_{i-1}}{\Rightarrow} q_2'
          \overset{x_i}{\not{\hspace{-0.1cm}\rightarrow}}$): Es gilt $x_1\dots
          x_i\in \MIT{}_2$ und somit $w\in\EL{}_2$. Anzumerken ist, dass nur
          auf diesem Weg Outputs von $U$ aus $Synch$ möglich sind, deshalb gilt
          es keine anderen Outputs von $U$, die zu einem neuen Error führen
          könnten.
      \end{itemize}
      Die restlichen Fälle sind analog zu Lemma~\ref{lemVerfeinerung} möglich.
      Somit gilt für alle Fälle (2a) bis 2d)), dass $w$ in $\EL{}_2$ enthalten
      ist.
      \begin{itemize}
        \item Fall 2e) (Divergenz und kein neuer Error): Da $U$ keine
          Möglichkeit hat zu divergieren, muss diese Möglichkeit von $S_2$
          geerbt sein. Es gilt dann $q_{02} \overset{x_1\dots
          x_iu}{\Rightarrow} q'\in Div_2$ für $i\geq 0$ und $u\in O^*$. Somit
          ist $x_1\dots x_iu\in\StDT{}_2$ und damit $\prune{}(x_1\dots x_iu)=
          \prune{}(x_1\dots x_i)\in\PrDT{}_2\subseteq \DT{}_2$. Da in $U$ $w$
          ausführbar ist und es zu keinem neuen Error in $U\|S_2$ kommt, muss
          $w$ auch in $S_2$ ausführbar sein. Also folgt, dass $w$ in $\DT{}_2
          \subseteq \EL{}_2$ enthalten ist, da \DT{} unter \cont{} im Schnitt
          mit \EL{} abgeschlossen ist.
      \end{itemize}
  \end{itemize}

  Als nächstes wird der zweite Beweispunkt gezeigt. Also die Inklusion
  $\DT{}_1\subseteq \DT{}_2$, die jedoch analog zu der Inklusion der
  error-gefluteten Sprache auf $(\cont{}(\PrDT{}_1)\cap
  \EL{}_1)\backslash\ET{}_1 \subseteq \DT{}_2$ eingeschränkt werden kann.\\
  Somit wird für ein präfix-minimales $w\in \PrDT{}_1\backslash \ET{}_1$
  gezeigt, dass es auch in $\DT{}_2$ enthalten ist.\\
  Durch die Definition der Menge \PrDT{} kann man schließen, dass ein $v\in
  O^*$ existiert mit $wv\in \StDT{}_1$.
  \begin{itemize}
  \item Fall 1 ($wv=\varepsilon$): In $S_1$ ist ein Divergenz-Zustand intern
    erreichbar, jedoch ist kein Error-Zustand lokal erreichbar, da
    $\varepsilon\notin \ET{}_1$ gilt. Für den fast Partner $U$ wird ein
    Transitionssystem verwendet, dass nur aus dem Startzustand mit einer
    $o$-Schleife besteht. Somit folgt, dass auch in $U\|S_1$ ein
    Divergenz-Zustand lokal erreichbar ist und da $U\|S_1\DRel U\|S_2$ gilt,
    muss auch in $U\|S_2$ ein Fehler lokal erreichbar sein. Da in einer
    Parallelkomposition mit $U$ keine Ruhe möglich ist, kann es sich bei dem
    Fehler nur um Error oder Divergenz handeln. Da jedoch $\DT(S) =
    \PrDT{}(S)\cup \ET{}(S)$ gilt, folgt, dass $w$ in $\DT{}_2$ enthalten ist.
  \item Fall 2 ($w=x_1\dots x_n, v=x_{n+1}\dots x_{n+l}$ mit $n+l\geq 1$): Es
    wird der folgende fast Partner $U$ betrachtet (siehe auch
    Abbildung~\ref{UfuerDTmitO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_{n+l}, q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i< n+l\}\\
                      &\cup\{(q_i,x,q)\mid  x\in (I_U\cup
          \{o\})\backslash\{x_{i+1}\}, 0\leq i< n+l\}\\
                      &\cup\{(q_{n+l},x,q)\mid x\in I_U\cup\{o\}\}\\
                      &\cup\{(q,x,q)\mid x\in I_U\cup\{o\}\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$q_{n+l}$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, o!$} (q)
                (1) edge node {$x_2$} (dots)
                    edge [below, sloped] node {$x?\neq x_2, o!$} (q)
                (dots) edge node {$x_{n+l}$} (n)
                       edge [dashed] (q)
                (n) edge [bend left] node [below,sloped] {$x?\in I_U, o!$} (q)
                (q) edge [loop below] node {$x?\in I_U, o!$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UfuerDTmitO}
      \end{center}
      \end{figure}
    Da es in $U$ keine ruhigen Zustände gibt, kann es auch in
    Parallelkomposition mit $U$ keine Ruhe-Zustände geben. Da vom Startzustand
    von $U$ das Wort $wv$ ausführbar ist und in $S_1$ mit diesem Wort ein
    Divergenz-Zustand erreicht wird, ist auch in $U\|S_1$ $wv$ in den strikten
    Divergenztraces enthalten. Da für jedes $w'$ aus \ET{} auch jedes Präfix
    von $w'$ in \ET{} enthalten ist, dass durch entfernen von Outputs entsteht,
    gilt immer noch $wv\notin \ET{}_1$ und somit kann weder von $S_1$ noch von
    $U$ ein Error auf dem Weg $wv$ geerbt werden. Es muss ein Fehler in
    $U\|S_2$ lokal erreichbar sein, da in $U\|S_1$ durch $wv$ ein
    Divergenz-Zustand erreichbar ist und $w$ nur aus synchronisierten Aktionen
    besteht und $I_U\cap I=\emptyset$ gilt und somit $wv\in O_{U\|S_1}^*$
    folgt. Bei dem lokal erreichbaren Fehler in $U\|S_2$ kann es sich um Error
    oder Divergenz handeln.
    \begin{itemize}
      \item Fall 2a) ($\varepsilon\in \ET{}(U\|S_2)$): Der lokal erreichbare
        Fehler in $U\|S_2$ ist ein Error. Es kann somit auch möglich sein, das
        $wv$ nicht ausführbar ist und es in der Parallelkomposition somit
        zu einem Kommunikationsfehler gekommen ist. Es ist jedoch auch möglich,
        dass der Error von $S_2$ geerbt wird. Es ist also wegen des ersten
        Punktes von Lemma~\ref{lemVerfeinerung} und da nur auf dem Weg $wv$ in
        $U$ Fehler durch Synchronisation möglich sind, bereits ein Präfix von
        $wv$ in $\ET{}_2$ enthalten und da $v\in O^*$ gilt, ist sogar ein
        Präfix von $w$ in $\ET{}_2$ enthalten. Somit gilt auch $w\in\ET{}_2
        \subseteq \DT{}_2$, da \ET{} unter \cont{} abgeschlossen ist.
      \item Fall 2b) ($\varepsilon\in \PrDT{}(U\|S_2)\backslash
        \ET{}(U\|S_2)$): Es ist also nur ein divergenter Zustand in $U\|S_2$
        lokal erreichbar und kein Error. Da $U$ keine Divergenz-Möglich\-keiten
        hat, muss der divergente Zustand von $S_2$ geerbt sein. $U$ hat
        $x_1\dots x_iu$ ausgeführt mit $u\in(O\cup\{o\})^*$ und ebenso hat
        $S_2$ den Weg $x_1\dots x_iu|_{\Sigma _2}$ ausgeführt. Durch dies hat
        $S_2$ einen Zustand aus $Div _2$ erreichen. Es gilt dann
        $\prune{}(x_1\dots x_iu|_{\Sigma _2})\prune{}(x_1\dots x_i)\in
        \PrDT{}_2\subseteq\DT{}_2$. $x_1\dots x_i$ ist ein Präfix von $wv$. In
        $U$ ist das Wort $wv$ ausführbar, da $wv\in O_{U\|S_1}^*=O_{U\|S_2}^*$
        und $\varepsilon\notin \ET{}(U\|S_2)$, muss $wv$ auch in $S_2$
        ausführbar sein. Da $v\in O^*$ gilt, und \DT{} unter \cont{} in \EL{}
        abgeschlossen ist, gilt $w\in \DT{}_2$.
    \end{itemize}
  \end{itemize}

  So bleibt nun nur noch der letzte Beweispunkt zu zeigen, d.h.\ die Inklusion
  $\QT{}_1\subseteq \QT{}_2$. Diese Inklusion kann jedoch noch, anlog zum
  Beweis der Inklusion der error-gefluteten Sprachen und der Divergenztraces,
  weiter eingeschränkt werden. Da bereits bekannt ist, dass
  $\DT{}_1\subseteq\DT{}_2$ gilt, muss nur noch $\StQT{}_1\backslash
  \DT{}_1\subseteq \QT{}_2$ gezeigt werden.\\
  Es wird ein $w\in \StQT{}_1\backslash\DT{}_1$ gewählt und gezeigt, dass
  dieses auch in $\QT{}_2$ enthalten ist.\\
  Durch die Wahl des $w$s wird vom Startzustand von $S_1$ durch das Wort $w$
  ein ruhiger Zustand erreichbar. Dies hat nur Auswirkungen auf die
  Parallelkomposition $U\|S_1$, wenn in $U$ ebenfalls ein Ruhe-Zustand durch
  $w$ erreichbar ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es ist ein Ruhe-Zustand intern erreichbar
      in $S_1$, da jedoch $\varepsilon\notin \DT{}_1$ gilt, ist kein
      Divergenz-Zustand lokal erreichbar. Für $U$ wird ein Transitionssystem
      verwendet, das nur aus dem Startzustand ohne Transitionsmöglichkeiten
      besteht. Somit ist auch in $U$ ein Ruhe-Zustand lokal erreichbar. Es
      folgt also mit Lemma~\ref{lemRuheParallelkomp}, dass auch in $U\|S_1$ ein
      Ruhe-Zustand lokal erreichbar ist. Es muss also auch in $U\|S_2$ ein
      Fehler lokal erreichbar sein. Bei diesem Fehler-Zustand kann es sich nun
      um einen Error, Divergenz-Zustand oder um einen Ruhe-Zustand handeln,
      dies ist jedoch Aufgrund der Definition der Menge \QT{} nicht relevant.
      Da für $U$ keine Transitionen möglich sind, kann nur $\varepsilon$ ein
      striktes Ruhetrace sein, falls es sich bei dem Fehler in $U\|S_2$ um
      einen lokal erreichbaren Ruhe-Zustand handelt. Somit folgt in beiden
      Fällen, dass $w$ in $\QT{}_2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n\in \Sigma ^+$ mit $n\geq 1$): Es wird der
      folgende fast Partner $U$ betrachtet (siehe auch
      Abbildung~\ref{UohneEmitIundO}):
      \begin{itemize}
        \item $Q_U=\{q_0,q_1,\dots ,q_n, q\}$,
        \item $q_{0U}=q_0$,
        \item $E_U=\emptyset$,
        \item $\begin{aligned}[t]
            \delta _U=&\{(q_i,x_{i+1},q_{i+1})\mid  0\leq i< n\}\\
                      &\cup\{(q_i,x,q)\mid  x\in (I_U\cup
          \{o\})\backslash\{x_{i+1}\}, 0\leq i< n\}\\
                      &\cup\{(q_n,x,q)\mid x\in I_U\}\\
                      &\cup\{(q,x,q)\mid x\in I_U\cup\{o\}\}.
        \end{aligned}$
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]
          \node (0) {$q_0$};
          \node (1) [right of=0] {$q_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots, rectangle, dashed, draw] {$q_n\in Qui_U$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$q$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, o!$} (q)
                (1) edge node {$x_2$} (dots)
                    edge [below, sloped] node {$x?\neq x_2, o!$} (q)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (q)
                (n) edge [bend left] node [below,sloped] {$x?\in I_U$} (q)
                (q) edge [loop below] node {$x?\in I_U, o!$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_i$ steht für alle $x\in I_U\backslash\{x_i\}$}
\label{UohneEmitIundO}
      \end{center}
      \end{figure}
      Der Zustand $q_n$ aus $U$ ist der einzige ruhige Zustand in $U$.
      Es gilt wegen Lemma~\ref{lemRuheParallelkomp}, dass auch in der
      Parallelkomposition $U\|S_1$ ein Ruhe-Zustand mit $w$ erreicht wird. Da
      es sich bei allen in $w$ befindlichen Aktionen um synchronisierte
      Aktionen handelt und $I_U\cap I=\emptyset$, folgt $w\in O_{U\|S_1}^*$ und
      $w\in \StQT{}(U\|S_1)$. Es kann also in der Parallelkomposition durch $w$
      ein Ruhe-Zustand lokal erreicht werden. Da $w\notin \DT{}_1$ gilt, kann
      auf dem Weg, der mit $w$ im Transitionssystem $S_1$ zurück gelegt wird
      kein Divergenz-Zustand lokal erreicht werden. Es kann also weder von
      $S_1$ noch von $U$ Divergenz auf diesem Weg geerbt werden. Da ein
      Ruhe-Zustand in $U\|S_1$ lokal erreichbar ist, muss auch ein Fehler in
      $U\|S_2$ lokal erreichbar sein. Hier kann jedoch zunächst keine Aussage
      darüber getroffen werden, ob das $w$ ausführbar ist und ob es sich bei
      dem Fehler um Error, Ruhe oder Divergenz handelt.
      \begin{itemize}
        \item Fall 2a) ($\varepsilon\in \EL{}(U\|S_2)$): Der lokal erreichbare
          Fehler ist ein Error. Das $w$ muss somit nicht ausführbar sein. Da
          nur auf dem Trace $w$ in $U$ Sychornisa\-tions-Fehler möglich sind und
          wegen des ersten Punktes von Lemma~\ref{lemVerfeinerung}, ist ein
          Präfix von $w$ in $\ET{}_2$ enthalten. Da die Menge \ET{} unter
          \cont{} abgeschlossen ist, gilt auch $w\in \ET{}_2\subseteq \DT{}_2
          \subseteq \QT{}_2$.
        \item Fall 2b) ($\varepsilon\in \DT{}(U\|S_2)\backslash
          \EL{}(U\|S_2)$): Es handelt sich bei dem lokal erreichbaren Fehler um
          Divergenz. Der Fehler muss von $S_2$ geerbt sein, da $U$ keine
          Divergenz-Möglichkeiten hat. Es gilt also, dass bereits in $S_2$ ein
          Präfix von $w$ in $\DT{}_2$ enthalten ist, wegen des Beweises des
          zweiten Punktes aus diesem Lemma. Da $w$ durch die Sychchonisation in
          $U\|S_1$ und $U\|S_2$ nur aus Outputs besteht und $\varepsilon\notin
          \ET{}(U\|S_2)$ gilt, folgt aus der Ausführbarkeit von $w$ in $U$ die
          Ausführbarkeit von $w$ in $S_2$. Somit reicht der Abschluss unter
          \cont{} in Schnitt mit \EL{} aus um in diesem Fall zu folgern, dass
          $w\in \DT{}_2\subseteq \QT{}_2$ gilt.
        \item Fall 2c) (Ruhe-Zustand lokal erreichbar in $U\|S_2$ und
          $\varepsilon\notin \DT{}(U\|S_2)$): Da in $U$ nur durch $w$ ein
          ruhiger Zustand erreicht werden kann, muss es sich bei dem lokal
          erreichbaren Ruhe-Zustand in $U\|S_2$ um einen handeln, der mit $w$
          erreicht werden kann. Mit Lemma~\ref{lemRuheParallelkomp} kann somit
          gefolgert werden, dass auch in $S_2$ ein Ruhe-Zustand mit $w$
          erreichbar sein muss. Es gilt also $w\in \StQT{}_2\subseteq \QT{}_2$.
      \end{itemize}
  \end{itemize}
\end{proof}

% Der folgenden Satz hält fest, dass \DRel{} die gröbste Präkongruenz bezüglich
% $\cdot\|\cdot$ charakterisiert, die in \DBRel{} enthalten ist.

% \begin{satz}[Full Abstractness für Divergenz-Semantik]
% \label{satzDivFullAbst}
%   Seinen $S_1$ und $S_2$ zwei \EIO{}s mit derselben Signatur. Dann gilt $S_1
%   \DCRel{} S_2\Leftrightarrow S_1\DRel{} S_2$, insbesondere ist \DRel{} eine
%   Präkongruenz.
% \end{satz}

% \begin{proof}
%   \glqq{}$\Leftarrow$\grqq{}: Nach Definition gilt $w\in\QT{}(S)$ mit $w\in
%   O^*$, genau dann wenn in $S$ ein Divergenz-Zustand, ein Ruhe-Zustand oder ein
%   Error-Zustand lokal erreichbar ist. $S_1\DRel S_2$ impliziert, dass
%   $w\in\QT{}_2$ gilt, wenn $w\in\QT{}_1$ gilt. Somit ist ein Divergenz-Zustand,
%   ein Ruhe-Zustand oder ein Error-Zustand nur dann in $S_1$ lokal erreichbar,
%   wenn auch ein solcher in $S_2$ lokal erreichbar ist. Daraus folgt, dass
%   $S_1\DBRel S_2$ gilt. Somit ist \DRel{} in \DBRel{} enthalten. In
%   Proposition~\ref{propDivPrae} wurde festgestellt, dass \DRel{} eine
%   Präkongruenz ist. Da jedoch \DCRel{} nach Definition die gröbste Präkongruenz
%   bezüglich $\cdot\|\cdot$ ist, die in \DBRel{} enthalten ist, muss \DRel{} in
%   \DCRel{} enthalten sein. Es folgt also aus $S_1\DRel S_2$,
%   dass auch der relationale Zusammenhang $S_1\DCRel S_2$ gilt.

%   \glqq{}$\Rightarrow$\grqq{}: Durch die Definition von \DCRel{} als
%   Präkongruenz in~\ref{DefDivBasisrel} folgt aus $S_1\DCRel{} S_2$, dass
%   $U\|S_1\DCRel U\|S_2$ für alle EIOs $U$ gilt, die mit $S_1$ komponierbar sind.
%   Somit folgt auch die Gültigkeit von $U\|S_1\DBRel U\|S_2$ für alle diese EIOs
%   $U$. Mit Lemma~\ref{lemDivVerfeinerung} folgt dann $S_1\QRel{} S_2$.
% \end{proof}

% Es wurde somit, wie in den letzten beiden Kapiteln, eine Kette an Folgerungen
% gezeigt, die sich zu einem Ring schließen. Jedoch ändert sich an der Begründung
% für einen der Folgepfeile etwas, da in Lemma~\ref{lemDivVerfeinerung} $U$ kein
% Partner mehr ist, sondern nur ein fast Partner. Diese Folgerungskette ist in
% Abbildung~\ref{FolgerungsketteDiv} dargestellt.

% \begin{figure}[h!tbp]
%   \begin{center}
%     \begin{tikzpicture}
%       \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
%         S_1\DRel S_2 & S_1\DCRel S_2 \\
%         \substack{\forall~\mathrm{fast}~\mathrm{Partner}~U:\\U\|S_1\DBRel
%         U\|S_2} & \substack{\forall~\mathrm{komponierbaren}~U:\\U\|S_1\DBRel
%       U\|S_2} \\};
%         \draw[-implies, double, double distance=1mm]
%           (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
%             Satz~\ref{satzDivFullAbst}} (m-1-2);
%         \draw[-implies, double, double distance=1mm]
%           (m-1-2) -- node [right] {Definition von \DCRel{}
%           in~\ref{DefDivBasisrel}} (m-2-2);
%         \draw[-implies, double, double distance=1mm]
%           (m-2-1) -- node [left]
%           {Lemma~\ref{lemDivVerfeinerung}} (m-1-1);
%         \draw[-implies, double, double distance=1mm]
%         (m-2-2) -- node [below]
%         {$\substack{U~\mathrm{fast}~\mathrm{Partner}\\\Downarrow\\U~\mathrm{komponierbar}}$}
%         (m-2-1);
%     \end{tikzpicture}
%     \caption{Folgerungskette}
% \label{FolgerungsketteDiv}
%   \end{center}
% \end{figure}

% Aus Satz~\ref{satzDivFullAbst} und Lemma~\ref{lemDivVerfeinerung} erhält man
% das folgende Korollar. Angenommen man definiert, dass $S_1$ $S_2$ verfeinern
% soll, genau dann wenn für alle fast Partner \EIO{}s $U$, für die $S_2$ error-,
% ruhe- und divergenz-frei mit $U$ kommuniziert, folgt, dass $S_1$ ebenfalls
% error-, ruhe- und divergenz-frei mit $U$ kommuniziert. Dann wird auch diese
% Verfeinerung durch \DRel{} charakterisiert.

% \begin{kor}
%   Es gilt: $S_1\DRel{} S_2 \Leftrightarrow U\|S_1\DBRel{} U\|S_2$ für alle
%   komponierbaren $U$.
% \end{kor}

% \section{Hiding und Divergenz-Freiheit}

% Da durch den Internalisierungsoperator Outputs in $\tau$s umgewandelt werden,
% hat das Hiding auf die Divergenz-Eigenschaft eine recht große Auswirkung. Die
% Menge der divergenten Zustände kann sich somit durch das Internalisieren
% vergrößern. Es kann ein Zustand divergent werden, wenn von diesem bereits
% lokal ein divergenter Zustand aus erreichbar war oder wenn er eine unendliche
% Folge von Aktionen aus $X\cup\{\tau\}$ ausführen konnte, jedoch nur endlich
% viele davon $\tau$s waren. Somit kann die Basisrelation für Divergenz auf jeden
% Fall nicht erhalten bleiben unter Internalisierung.
